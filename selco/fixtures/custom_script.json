[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Issue", 
  "modified": "2017-10-28 12:38:35.366811", 
  "name": "Issue-Client", 
  "script": "/*To set naming series when branch is choosen for the first time */\ncur_frm.add_fetch(\"branch\", \"customer_complaint_naming_series\", \"naming_series\");\ncur_frm.add_fetch(\"service_area\", \"selco_cse_service_area\", \"selco_service_area_name\");\n\n\n/*To set Branch eMail ID when branch is choosen for the first time */\ncur_frm.add_fetch(\"branch\", \"selco_branch_email_id\", \"selco_branch_email_id\");\ncur_frm.add_fetch(\"branch\", \"selco_service_branch_email_id\", \"selco_service_branch_email_id\");\n\n\n/*To set naming series when the value in branch is changed*/\nfrappe.ui.form.on(\"Issue\", \"selco_branch\",\n    function(frm) {\ncur_frm.add_fetch(\"selco_branch\", \"customer_complaint_naming_series\", \"naming_series\");\n\nif ( cur_frm.doc.naming_series == null )\n{\nwindow.location.reload();\nmsgprint(\"Please set the correct naming series for the branch.\");\n       throw \"Not allowed\";\n}\n})\n\ncur_frm.add_fetch(\"selco_customer_name\", \"selco_customer_contact_number\", \"selco_customer_contact_number\");\ncur_frm.add_fetch(\"selco_customer_name\", \"selco_customer_name\", \"selco_customer_full_name\");\ncur_frm.add_fetch(\"selco_complaint_handled_by\", \"selco_service_person_name\", \"selco_service_person_name\");\n\n/*To 'Make Fields Read Only' once the workflow state changes to anything other than 'Complaint Drafted'*/\nfrappe.ui.form.on(\"Issue\", \"refresh\",\n    function(frm) {\nif ( cur_frm.doc.selco_workflow_state == \"Complaint Open\" || cur_frm.doc.selco_workflow_state == \"Complaint Assigned To CSE\" || cur_frm.doc.selco_workflow_state == \"Complaint Cancelled\" || cur_frm.doc.selco_workflow_state == \"Complaint Attended By CSE - Still Open\" || cur_frm.doc.selco_workflow_state == \"Complaint Escalated To SBM\" || cur_frm.doc.selco_workflow_state == \"Complaint Closed By Branch\" || cur_frm.doc.selco_workflow_state == \"Complaint Closed By CSD\" || cur_frm.doc.selco_workflow_state == \"Warranty Claim Format Raised - WC\" || cur_frm.doc.selco_workflow_state == \"Dispatch Pending From Godown\" || cur_frm.doc.selco_workflow_state == \"Dispatched From Godown\")\n{\nfrm.set_df_property(\"date\", \"read_only\",1);\nfrm.set_df_property(\"selco_branch\", \"read_only\",1);\nfrm.set_df_property(\"subject\", \"read_only\",1);\nfrm.set_df_property(\"selco_description_of_complaint\", \"read_only\",1);\nfrm.set_df_property(\"selco_customer_name\", \"read_only\",1);\nfrm.set_df_property(\"selco_customer_full_name\", \"read_only\",1);\n\nfrm.set_df_property(\"selco_customer_contact_number\", \"read_only\",1);\n//frm.set_df_property(\"selco_customer_address\", \"read_only\",1);\nfrm.set_df_property(\"selco_complaint_priority\", \"read_only\",1);\nfrm.set_df_property(\"selco_warranty_applicable\", \"read_only\",1);\nfrm.set_df_property(\"selco_type_of_system\", \"read_only\",1);\nfrm.set_df_property(\"selco_capacity\", \"read_only\",1);\n}\n})\n\n/*To 'Make Fields Read Only' once the workflow state changes to 'closed by branch' or 'closed by CSD'*/\nfrappe.ui.form.on(\"Issue\", \"refresh\",\n    function(frm) {\nif ( cur_frm.doc.selco_workflow_state == \"Complaint Closed By CSD\" || cur_frm.doc.selco_workflow_state == \"Complaint Closed By Branch\" || cur_frm.doc.selco_workflow_state == \"Dispatch Pending From Godown\")\n{\nfrm.set_df_property(\"selco_ics_number\", \"read_only\",1);\nfrm.set_df_property(\"selco_category_of_complaint\", \"read_only\",1);\nfrm.set_df_property(\"selco_faulty_component\", \"read_only\",1);\nfrm.set_df_property(\"selco_service_record_number\", \"read_only\",1);\nfrm.set_df_property(\"selco_branch_remarks\", \"read_only\",1);\nfrm.set_df_property(\"selco_sbm_name_if_involved\", \"read_only\",1);\n\nfrm.set_df_property(\"selco_ics_date\", \"read_only\",1);\nfrm.set_df_property(\"selco_complaint_handled_by\", \"read_only\",1);\nfrm.set_df_property(\"selco_component_vendor\", \"read_only\",1);\nfrm.set_df_property(\"selco_record_date\", \"read_only\",1);\nfrm.set_df_property(\"selco_service_charges_collected\", \"read_only\",1);\nfrm.set_df_property(\"selco_sbm_remarks\", \"read_only\",1);\n}\n})\n\nfrappe.ui.form.on(\"Issue\", \"selco-customer_name\", function(frm) {\n    cur_frm.set_query(\"selco_customer_address\", function() {\n        return {\n            \"filters\": {\n                \"customer\": frm.doc.selco_customer_name\n            }\n        };\n    });\n});\n\nfrappe.ui.form.on(\"Issue\", \"selco_customer_address\", function(frm, cdt, cdn) {\n        return frm.call({\n            method: \"erpnext.utilities.doctype.address.address.get_address_display\",\n            args: {\n                \"address_dict\": frm.doc.selco_customer_address\n            },\n            callback: function(r) {\n            if(r.message) {\n           /*  console.log(r.message);*/                  \n             frappe.model.set_value(cdt,cdn,\"detail_address\", r.message);\n            /* $(frm.fields_dict.detail_address.wrapper).html(r.message) */  }\n        }\n        });\n    \n})\n\nfrappe.ui.form.on(\"Issue\", \"refresh\", function (frm, cdt, cdn) {\n  cur_frm.set_query(\"selco_customer_name\", function () {\n    return {\n      query: \"erpnext.controllers.queries.customer_query\",\n      searchfield: \"selco_customer_contact_number\"\n    }\n  });\n});\n\nfrappe.ui.form.on(\"Issue\", \"refresh\", function (frm, cdt, cdn) {\n  cur_frm.set_query(\"selco_customer_name\", function () {\n    return {\n      query: \"erpnext.controllers.queries.customer_query\",\n      searchfield: \"selco_landline_mobile_2\"\n    }\n  });\n});\n\n\n\n\nfrappe.ui.form.on(\"Issue\", \"refresh\",\n    function(frm) {\nif ( cur_frm.doc.selco_workflow_state == \"Complaint Closed By CSD\" || cur_frm.doc.selco_workflow_state == \"Complaint Rejected By CSD\" )\n{\nfrm.set_df_property(\"selco_remarks\", \"read_only\",1);\nfrm.set_df_property(\"selco_special_budget\", \"read_only\",1);\n}\n})\n\n\nfrappe.ui.form.on(\"Issue\", \"validate\", function(frm, cdt, cdn) {\ncur_frm.doc.selco_sms_number = cur_frm.doc.selco_customer_contact_number + \"@sms.textlocal.in\";\n})\n\nfrappe.ui.form.on(\"Issue\", \"validate\", function(frm) {\nif ( cur_frm.doc.selco_workflow_state == \"Complaint Drafted\" )\n{\nif ( cur_frm.doc.naming_series == \"ISS-\" )\n{\n        msgprint(\"Complaint is not saved.Please select the branch again!!\");\n        validated = false;\n}\n}\n})\n\nfrappe.ui.form.on(\"Issue\", \"validate\",\n    function(frm) {\nif ( cur_frm.doc.selco_workflow_state == \"Complaint Closed By Branch\" )\n{\ncur_frm.doc.selco_sms_counter_1 = cur_frm.doc.selco_sms_counter_1 +1 ;\n}\n})\n\n\n\n\n\n\n\n\n\n\n\n\nfrappe.ui.form.on(\"Issue\", \"refresh\", function(frm) {\ncur_frm.fields_dict.selco_customer_name.new_doc = quick_entry_customer;\ncur_frm.fields_dict.selco_customer_address.new_doc = quick_entry_address;\n})\n\n\n\nquick_entry_address = function(){\nconsole.log(\"Overrided\");\n    frappe._from_link = this;\n    quick_entry(\"Address\",\n    function(){},\n    {\n        \"address_type\": \"Billing\",\n                \"branch\": cur_frm.doc.selco_branch,\n                \"customer\": cur_frm.doc.selco_customer_name,\n                \"country\" : \"India\"\n    });\n}\n\nquick_entry_customer = function(){\nconsole.log(\"Overrided\");\n    frappe._from_link = this;\n    quick_entry(\"Customer\",\n    function(){},\n    {\n                \"branch\": cur_frm.doc.selco_branch\n    });\n}\n\n\n/* cur_frm.fields_dict.Service Record Details Issue.grid.toggle_reqd\n    (\"reason_for_not_collecting_the_amount\", doc.selco_service_amount=0)\n\nfrappe.ui.form.on('Service Record Details Issue', {\n    reason_for_not_collecting_the_amount_add: function(frm) {\nconsole.log(\"Clicked on amount\");\n    }\n});\n\n\nfrappe.ui.form.on(\"Service Record Details Issue\", \"service_amount\", function(frm, cdt, cdn){\n    console.log(\"Clicked on amount\");\n cur_frm.fields_dict.service_record_details.grid.toggle_reqd\n    (\"reason_for_not_collecting_the_amount\", 1)\n\n})*/\n\n/*\nfrappe.ui.form.on(\"Issue\", \"validate\", function(frm, cdt, cdn) {\n    for (i = 0; i < cur_frm.doc.service_record_details.length; i++) {\n        if (cur_frm.doc.selco_service_record_details[i].service_amount == 0 && !cur_frm.doc.selco_service_record_details[i].reason_for_not_collecting_the_amount) {\n            frappe.throw(\"Please enter the reason for not collecting amount\");\n        }\n    }\n}) */\n\n\nfrappe.ui.form.on(\"Issue\", \"refresh\", function(frm) {\n   {\nvar workflow_states = ['Complaint Open','Complaint Assigned To CSE','Complaint Escalated To SBM']\nif (workflow_states.indexOf(cur_frm.doc.workflow_state) != -1)\n{\n      cur_frm.add_custom_button(__(\"Raise Warranty Claim\"),\n        cur_frm.cscript.raise_Warranty_Claim);\n    }\n}\n})\n\ncur_frm.cscript.raise_Warranty_Claim = function()\n{\nfrappe.route_options = {\n\"complaint_number\": cur_frm.doc.name\n};\nfrappe.new_doc(\"Warranty Claim\");\n}\n\n\n\n\n\n\n\n\n\nquick_entry = function(doctype, success, fields_map={}) {\n    frappe.model.with_doctype(doctype, function() {\n        var mandatory = [];\n\n        if (!fields_map == {}) {\n            $.each(fields_map, function(k,v) {\n                doc_field = frappe.meta.get_docfield(doctype, k)\n                mandatory.push(doc_field);\n            });\n        } else {\n            mandatory = $.map(frappe.get_meta(doctype).fields,\n            function(d) { return (d.reqd || d.bold && !d.read_only) ? d : null });\n        }\n\n        var meta = frappe.get_meta(doctype);\n        var doc = frappe.model.get_new_doc(doctype, null, null, true);\n\n        /*if(meta.quick_entry != 1) {\n            var d = frappe.model.make_new_doc_and_get_name(doctype);\n            d = locals[doctype][d];\n            $.each(fields_map, function(fieldname, fieldvalue) {\n                d[fieldname] = fieldvalue;\n            });\n            frappe.set_route('Form', doctype, d.name);\n            return;\n        }*/\n\n        var dialog = new frappe.ui.Dialog({\n            title: __(\"New {0}\", [doctype]),\n            fields: mandatory,\n        });\n\n        var update_doc = function() {\n            var data = dialog.get_values(true);\n            $.each(data, function(key, value) {\n                if(key==='__name') {\n                    dialog.doc.name = value;\n                } else {\n                    if(!is_null(value)) {\n                        dialog.doc[key] = value;\n                    }\n                }\n            });\n            return dialog.doc;\n        }\n\n        var open_doc = function() {\n            dialog.hide();\n            update_doc();\n            frappe.set_route('Form', doctype, doc.name);\n        }\n\n        dialog.doc = doc;\n\n        // refresh dependencies etc\n        dialog.refresh();\n\n        dialog.set_primary_action(__('Save'), function() {\n            if(dialog.working) return;\n            var data = dialog.get_values();\n\n            if(data) {\n                dialog.working = true;\n                values = update_doc();\n                frappe.call({\n                    method: \"frappe.client.insert\",\n                    args: {\n                        doc: values\n                    },\n                    callback: function(r) {\n                        dialog.hide();\n                        // delete the old doc\n                        frappe.model.clear_doc(dialog.doc.doctype, dialog.doc.name);\n                        var doc = r.message;\n                        if(success) {\n                            success(doc);\n                        }\n                        frappe.ui.form.update_calling_link(doc.name);\n                    },\n                    error: function() {\n                        open_doc();\n                    },\n                    always: function() {\n                        dialog.working = false;\n                    },\n                    freeze: true\n                });\n            }\n        });\n\n        var $link = $('<div class=\"text-muted small\" style=\"padding-left: 10px; padding-top: 15px;\">\\\n            Ctrl+enter to save | <a class=\"edit-full\">Edit in full page</a></div>').appendTo(dialog.body);\n\n        $link.find('.edit-full').on('click', function() {\n            // edit in form\n            open_doc();\n        });\n\n        // ctrl+enter to save\n        dialog.wrapper.keydown(function(e) {\n            if((e.ctrlKey || e.metaKey) && e.which==13) {\n                if(!frappe.request.ajax_count) {\n                    // not already working -- double entry\n                    dialog.get_primary_btn().trigger(\"click\");\n                }\n            }\n        });\n\n        dialog.show();\n\n        //Set value and visibility if field map exists.\n        if (fields_map != {}) {\n            $.each(dialog.fields_dict, function(fieldname, field) {\n                field.set_input(fields_map[fieldname]);\n            });\n        } else {\n            // set defaults\n            $.each(dialog.fields_dict, function(fieldname, field) {\n                field.doctype = doc.doctype;\n                field.docname = doc.name;\n                if(!is_null(doc[fieldname])) {\n                    field.set_input(doc[fieldname]);\n                }\n            });\n        }\n    });\n}\n\t", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Payment Entry", 
  "modified": "2017-11-04 15:59:02.572026", 
  "name": "Payment Entry-Client", 
  "script": "//cur_frm.add_fetch(\"branch\", \"collection_account\", \"paid_to\"); \ncur_frm.add_fetch(\"party\", \"customer_name\", \"selco_party_name\"); \n\n\nfrappe.ui.form.on(\"Payment Entry\", \"selco_financing_institution\", function(frm) {\nconsole.log(\"Hello\");\n\n    cur_frm.set_query(\"selco_financing_institution_branch\", function() {\n        return {\n            \"filters\": {\n                \"selco_financing_institution\": frm.doc.selco_financing_institution\n            }\n        };\n    });\n});\n\n\nfrappe.ui.form.on(\"Payment Entry\", \"refresh\", function(frm) {\n\n//cur_frm.doc.mode_of_payment = \"Bank\";\n\n    cur_frm.set_query(\"mode_of_payment\", function() {\n        return {\n\n\t\tfilters: [\n\t\t\t['Mode of Payment', 'mode_of_payment', 'in', 'Bank,Cash']\n\t\t]\n}\n        });\n\n    });\n\n\nfrappe.ui.form.on(\"Payment Entry\", \"refresh\", function(frm) {\n\ncur_frm.fields_dict['references'].grid.get_field('reference_name').get_query = function(doc) {\nif ( cur_frm.doc.payment_type == \"Receive\")\n{\nreturn {\n\n            \"filters\": {\n                \"customer\": cur_frm.doc.selco_party\n            }\n\t}\n\n}\n\nif ( cur_frm.doc.payment_type == \"Pay\")\n{\nreturn {\n\n            \"filters\": {\n                \"supplier\": cur_frm.doc.selco_party\n            }\n\t}\n\n}\n\n\n}\n});\n\n\n\nfrappe.ui.form.on(\"Payment Entry\", \"refresh\", function(frm) {\n\ncur_frm.fields_dict['references'].grid.get_field('reference_doctype').get_query = function(doc) {\nif ( cur_frm.doc.payment_type == \"Receive\")\n{\nreturn {\n\n            \"filters\": {\n                \"name\": \"Sales Invoice\"\n            }\n\t}\n\n}\n\nif ( cur_frm.doc.payment_type == \"Pay\")\n{\nreturn {\n\n            \"filters\": {\n                \"name\": \"Purchase Invoice\"\n            }\n\t}\n\n}\n\n\n}\n});\n\n\n\nfrappe.ui.form.on(\"Payment Entry\", \"refresh\", function(frm) {\nif (cur_frm.doc.__islocal == 1)\n{\nif (frappe.user_info().email == \"bangalore_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Bangalore Service Branch\";\ncur_frm.set_df_property(\"branch\", \"read_only\", true);\n} else if (frappe.user_info().email == \"kundapura_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Kundapur Service Branch\";\ncur_frm.set_df_property(\"branch\", \"read_only\", true);\n}\n}\n})\n\nfrappe.ui.form.on(\"Payment Entry\", \"cash_or_bank\", function(frm, cdt, cdn) {\nif (cur_frm.doc.cash_or_bank == \"Cash\")\n{\ncur_frm.doc.selco_financed = \"NO\";\ncur_frm.doc.reference_no = \"Cash\";\ncur_frm.set_df_property(\"reference_no\", \"read_only\", true);\n\nvar d = locals[cdt][cdn];\nfrappe.call({\n\t\"method\": \"frappe.client.get\",\n\targs: {\n\t\tdoctype: \"Branch\",\n\t\tname: d.branch\n\t},\n\tcallback: function (data) {\n\t\tfrappe.model.set_value(d.doctype, d.name, \"paid_to\",data.message.collection_account_cash);\n\t\t}\n})\n\n} \n\n\n\nif (cur_frm.doc.cash_or_bank == \"Cheque/DD\" || cur_frm.doc.cash_or_bank == \"Online-NEFT/RTGS\" )\n{\ncur_frm.doc.reference_no = \"\";\n\nvar d = locals[cdt][cdn];\nfrappe.call({\n\t\"method\": \"frappe.client.get\",\n\targs: {\n\t\tdoctype: \"Branch\",\n\t\tname: d.branch\n\t},\n\tcallback: function (data) {\n\t\tfrappe.model.set_value(d.doctype, d.name, \"paid_to\",data.message.collection_account);\n\t\t}\n})\ncur_frm.set_df_property(\"reference_no\", \"read_only\", false);\ncur_frm.set_df_property(\"reference_no\", \"reqd\", true);\ncur_frm.set_df_property(\"selco_cheque_issuing_bank\", \"read_only\", false);\ncur_frm.set_df_property(\"selco_cheque_issuing_bank\", \"reqd\", true);\n}\n})\n\nfrappe.ui.form.on(\"Payment Entry\", \"financed\", function(frm, cdt, cdn) {\nif (cur_frm.doc.selco_financed == \"YES\")\n{\ncur_frm.set_df_property(\"selco_financing_institution\", \"read_only\", false);\ncur_frm.refresh_field(\"selco_financing_institution\");\ncur_frm.set_df_property(\"selco_financing_institution_branch\", \"read_only\", false);\ncur_frm.set_df_property(\"selco_financing_institution\", \"reqd\", true);\ncur_frm.set_df_property(\"selco_financing_institution_branch\", \"reqd\", true);\n} else\n{\ncur_frm.set_df_property(\"selco_financing_institution\", \"read_only\", true);\ncur_frm.set_df_property(\"selco_financing_institution_branch\", \"read_only\", true);\ncur_frm.set_df_property(\"selco_financing_institution\", \"reqd\", false);\ncur_frm.set_df_property(\"selco_financing_institution_branch\", \"reqd\", false);\n}\n})\n\nfrappe.ui.form.on(\"Payment Entry\", \"refresh\", function(frm) {\nif (cur_frm.doc.__islocal == 1)\n{\nif (frappe.user_info().email == \"bangalore_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Bangalore Service Branch\";\ncur_frm.set_df_property(\"branch\", \"read_only\", true);\n} else if (frappe.user_info().email == \"kundapura_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Kundapur Service Branch\";\ncur_frm.set_df_property(\"branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"puttur_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Puttur Service Branch\";\ncur_frm.set_df_property(\"branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"hassan_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Hassan Service Branch\";\ncur_frm.set_df_property(\"branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"bellary_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Ballari Service Branch\";\ncur_frm.set_df_property(\"branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"shimoga_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Shivamogga Service Branch\";\ncur_frm.set_df_property(\"branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"chitradurga_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Chitradurga Service Branch\";\ncur_frm.set_df_property(\"branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"dharwad_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Dharwad Service Branch\";\ncur_frm.set_df_property(\"branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"vijayapura_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Vijayapura Service Branch\";\ncur_frm.set_df_property(\"branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"mysore_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Mysore Service Branch\";\ncur_frm.set_df_property(\"branch\", \"read_only\", true);\n}\n}\n})\n\nfrappe.ui.form.on(\"Payment Entry\", \"refresh\", function (frm, cdt, cdn) {\n  cur_frm.set_query(\"party\", function () {\n    return { \n      query: \"erpnext.controllers.queries.customer_query\",\n      searchfield: \"selco_customer_contact_number\"\n    }\n  });\n});\n\nfrappe.ui.form.on(\"Payment Entry\", \"refresh\", function(frm) {\n    {\n        cur_frm.add_custom_button(__(\"Create New Customer\"), cur_frm.cscript.create_new_customer);\n    }\n})\n\n\n\ncur_frm.cscript.create_new_customer = function() {\n    var cust_name = \"\";\n    console.log(\"clicked on New Customer\");\n    var d = new frappe.ui.Dialog({\n        title: __(\"Create New Customer\"),\n        fields: [{\n                \"fieldname\": \"branch\",\n                \"fieldtype\": \"Link\",\n                \"label\": __(\"Branch\"),\n                options: \"Branch\",\n                reqd: 1,\n                default : cur_frm.doc.branch\n            },\n            {\n                \"fieldname\": \"customer_group\",\n                \"fieldtype\": \"Link\",\n                \"label\": __(\"Customer Group\"),\n                options: \"Customer Group\",\n                reqd: 1,\n\n            },\n\n            {\n                \"fieldname\": \"customer_name\",\n                \"fieldtype\": \"Data\",\n                \"label\": __(\"Full Name\"),\n                reqd: 1,\n\n            },\n            {\n                \"fieldname\": \"customer_contact_number\",\n                \"fieldtype\": \"Data\",\n                \"label\": __(\"Customer Contact Number\"),\n\n            },\n            {\n                \"fieldname\": \"landline_mobile_2\",\n                \"fieldtype\": \"Data\",\n                \"label\": __(\"Landline / Mobile 2\"),\n\n            },\n\n            {\n                \"fieldname\": \"gender\",\n                \"fieldtype\": \"Select\",\n                \"label\": __(\"Gender\"),\n                \"default\": [\"Male\"],\n                \"options\": \"Male\\nFemale\"\n\n            },\n\n            {\n                \"fieldname\": \"electrification_status\",\n                \"fieldtype\": \"Select\",\n                \"label\": __(\"Electrification Status\"),\n                \"options\": \"Electrified - Rural\\nElectrified - Semi Urban\\nElectrified - Urban\\nElectrified - Migrant\\nElectrified - Tribal\\nUnelectrified - Rural\\nUnelectrified - Semi Urban\\nUnelectrified - Urban\\nUnelectrified - Migrant\\nUnelectrified - Tribal\"\n            },\n\n\n\n            {\n                fieldname: \"fetch\",\n                \"label\": __(\"Create New Customer\"),\n                \"fieldtype\": \"Button\"\n            }\n\n        ]\n    });\n\n    d.get_input(\"fetch\").on(\"click\", function() {\n        var values = d.get_values();\n        if (values.electrification_status) {\n            var local_es = values.electrification_status\n        } else {\n            local_es = \"\"\n        }\n\n        if (values.landline_mobile_2) {\n            var local_land = values.landline_mobile_2\n        } else {\n            local_land = \"\"\n        }\n\n        if (values.customer_contact_number) {\n            var local_mob = values.customer_contact_number\n        } else {\n            local_mob = \"\"\n        }\n\n\n\n\n        frappe.call({\n            \"method\": \"selco.selco.doctype.selco_customizations.selco_customizations.selco_create_customer\",\n            \"args\": {\n                \"branch\": values.branch,\n                \"customer_group\": values.customer_group,\n                \"customer_name\": values.customer_name,\n                \"customer_contact_number\": local_mob,\n                \"landline_mobile_2\": local_land,\n                \"gender\": values.gender,\n                \"electrification_status\": local_es\n            },\n            callback: function(r) {\n                console.log(r);\n                d.hide();\n                cust_name = r.message[0]\n                cust_name_str = r.message[1]\n\n                cur_frm.set_value(\"party\", cust_name);\n                cur_frm.set_value(\"party_name\", cust_name_str);\n\n            }\n        });\n\n    })\n    d.show();\n}\n\nfrappe.ui.form.on(\"Payment Entry\", \"refresh\", function(frm) {\ncur_frm.set_query(\"selco_cheque_issuing_bank\", function() {\nconsole.log(\"Hrlllooo\");\n    return {\n        filters: [\n            ['Financing Institution', 'name', '!=', 'SKDRDP']\n        ]\n    };\n});\n})\n\n\nfrappe.ui.form.on(\"Payment Entry\", \"refresh\", function(frm) {\n    {\n        cur_frm.add_custom_button(__(\"Add New Address\"), cur_frm.cscript.add_new_address);\n    }\n})\ncur_frm.cscript.add_new_address = function() {\n    var d = new frappe.ui.Dialog({\n        title: __(\"Add New Address\"),\n        fields: [{\n                \"fieldname\": \"branch\",\n                \"fieldtype\": \"Link\",\n                \"label\": __(\"Branch\"),\n                options: \"Branch\",\n                reqd: 1,\n                default : cur_frm.doc.branch\n\n             },\n             {\n                \"fieldname\": \"address_type\",\n               \"fieldtype\": \"Select\",\n                \"label\": __(\"Address Type\"),\n                default : \"Billing\",\n               \"options\": \"Billing\\n Shipping\\n Office\\n Personal\\n Plant\\n Postal\\n Shop\\n Subsidiary\\n Warehouse\\n Other\"\n                 },\n\n              {\n                \"fieldname\": \"address_line1\",\n                \"fieldtype\": \"Data\",\n                \"label\": __(\"Address Line 1\"),\n                reqd: 1,\n\n            },\n\n\n            {\n                \"fieldname\": \"address_line2\",\n                \"fieldtype\": \"Data\",\n                \"label\": __(\"Address Line 2\"),\n                reqd: 1,\n\n            },\n\n\n              {\n                \"fieldname\": \"city\",\n                \"fieldtype\": \"Data\",\n                \"label\": __(\"City/Town\"),\n                 reqd: 1,\n              },\n             {\n                \"fieldname\": \"district\",\n               \"fieldtype\": \"Select\",\n                \"label\": __(\"District\"),\n               \"options\": \"Bagalkote \\n Belgaum \\n Bellary\\n Bengaluru Rural\\n Bengaluru\\n Bidar\\nChamarajanagar\\nChikkaballapur\\nChikkamagaluru\\nChitradurga\\nDakshina Kannada\\nDavanagere\\nDharwad\\nGadag\\nHassan\\nHaveri\\nHyderabad\\nKalaburagi\\nKarwar\\nKasaragod\\nKodau\\nKolar\\nKoppal\\nMandya\\nMysuru\\nPudukottai\\nRaichur\\nRamanagara\\nShivamogga\\nSolapur\\nTumakuru\\nUdupi\\nUttara Kannada\\nVijayapura\\nYadgir\\nMunger\\nPatna\\nThane\\nNandurbar\\nAriyalur\\nChennai\\nCoimbatore\\nCuddalore\\nDindigul\\nErode\\nKanchipuram\\nKanyakumari\\nKarur\\nMadurai\\nNagapattinam\\nNamakkal\\nRamanahapuram\\nSalem\\nSivagangai\\nThanjavur\\nTheni\\nThiruppur\\nTrichi\\nViridhunagar\\nNilgiris\\nDharmapuri\",\n             reqd: 1\n                 },\n\n             {\n                \"fieldname\": \"country\",\n                \"fieldtype\": \"Link\",\n                \"label\": __(\"Country\"),\n                options: \"Country\",\n                default : \"India\",\n                reqd: 1,\n\n            },\n         {\n                \"fieldname\": \"customer\",\n                \"fieldtype\": \"Link\",\n                \"label\": __(\"Customer\"),\n                options: \"Customer\",\n                reqd: 1,\n                default : cur_frm.doc.party\n\n\n            },\n\n\n            {\n                fieldname: \"fetch\",\n                \"label\": __(\"Add New Address\"),\n                \"fieldtype\": \"Button\"\n            }\n\n        ]\n    });\n  \n  d.get_input(\"fetch\").on(\"click\", function() {\n              var values = d.get_values();\n              frappe.call({\n                  \"method\": \"selco.selco.doctype.selco_customizations.selco_customizations.selco_add_new_address\",\n                  \"args\": {\n                      \"branch\": values.branch,\n                      \"address_type\": values.address_type,\n\t              \t\"address_line1\": values.address_line1,\n                      \"address_line2\": values.address_line2,\n                      \"city\": values.city,\n                      \"district\": values.district,\n                      \"country\": values.country,\n                      \"customer\": values.customer\n                  },\n                  callback: function(r) {\n                      d.hide();\n\t\t\taddress_name = r.message[0]\n                        address_display = r.message[0]\ncur_frm.set_value(\"selco_recipient_address_link\",r.message[0]);\ncur_frm.set_value(\"selco_recipient_address\",r.message[1]);\n\n\n                  }\n\n              })\n              })\n\n              d.show();\n          }\n\n\n          \n       \n\n             \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Stock Entry", 
  "modified": "2017-11-04 15:24:50.553531", 
  "name": "Stock Entry-Client", 
  "script": "cur_frm.add_fetch(\"branch\", \"selco_branch_email_id\", \"selco_branch_email_id\");\n\n\nfrappe.ui.form.on(\"Stock Entry\", \"selco_supplier_or_customer\", function(frm) {\nif ((cur_frm.doc.selco_supplier_or_customer == \"Customer\")\n&& (cur_frm.doc.selco_type_of_stock_entry==\"Rejection In\"))\n{\ncur_frm.set_df_property(\"items\", \"read_only\", false);\n}\nelse if ((cur_frm.doc.selco_supplier_or_customer == \"Customer\")\n&& (cur_frm.doc.selco_type_of_stock_entry==\"Rejection Out\"))\n{\ncur_frm.set_df_property(\"items\", \"read_only\", true);\n}\nelse if ((cur_frm.doc.selco_supplier_or_customer == \"Supplier\") && (cur_frm.doc.selco_type_of_stock_entry==\"Rejection In\"))\n{\ncur_frm.set_df_property(\"rejection_out_id\", \"reqd\", true);\ncur_frm.set_df_property(\"items\", \"read_only\", true);\n}\nelse if ((cur_frm.doc.selco_supplier_or_customer == \"Supplier\") && (cur_frm.doc.selco_type_of_stock_entry==\"Rejection Out\"))\n{\ncur_frm.set_df_property(\"items\", \"read_only\", false);\n}\n\n})\n\n\n\nfrappe.ui.form.on('Stock Entry', 'selco_supplier_or_customer_id', function(frm, cdt, cdn) {\n     var d = frappe.model.get_doc(cdt, cdn);\n     frappe.call({\n        method: \"frappe.client.get_value\",\nargs: {\ndoctype: d.supplier_or_customer,\nfieldname: d.supplier_or_customer=='Customer' ? 'customer_name' : 'supplier_name',\nfilters: { name: d.supplier_or_customer_id },\n},\ncallback: function(r, rt) {\nif(r.message) {\nif (d.selco_supplier_or_customer == \"Customer\")\n{\nfrappe.model.set_value(d.doctype, d.name, 'supplier_or_customer_name', r.message.customer_name);\n}\nelse if (d.supplier_or_customer == \"Supplier\")\n{\nfrappe.model.set_value(d.doctype, d.name, 'supplier_or_customer_name', r.message.supplier_name);\n}\nconsole.log(\"callback executed!!\");\n}\n}\n    })\n})\n\n\n\n\n\n\n\n\n\nfrappe.ui.form.on(\"Stock Entry\", \"selco_type_of_stock_entry\", function(frm) {\ncur_frm.set_df_property(\"selco_type_of_stock_entry\", \"read_only\", true);\ncur_frm.clear_table(\"items\");\ncur_frm.set_df_property(\"items\", \"read_only\", true);\ncur_frm.set_df_property(\"rejection_out_id\", \"reqd\", false);\n\nif (cur_frm.doc.selco_type_of_stock_entry == \"GRN\")\n{\ncur_frm.set_df_property(\"items\", \"read_only\", true);\ncur_frm.set_value('purpose', \"Material Transfer\")\ncur_frm.set_value('selco_inward_or_outward', \"Inward\")\n}\nelse if (cur_frm.doc.selco_type_of_stock_entry == \"Outward DC\")\n{\ncur_frm.set_value('purpose', \"Material Transfer\")\ncur_frm.set_value('selco_inward_or_outward', \"Outward\")\ncur_frm.set_df_property(\"selco_being_dispatched_to\", \"reqd\", true);\n}\nelse if (cur_frm.doc.selco_type_of_stock_entry == \"BOM\")\n{\ncur_frm.set_value('purpose', \"Repack\")\ncur_frm.set_value('selco_inward_or_outward', \"\")\ncur_frm.doc.selco_type_of_material = \"Good Stock\";\ncur_frm.doc.selco_inward_or_outward = \"\";\ncur_frm.set_df_property(\"selco_type_of_material\", \"read_only\", true);\ncur_frm.set_df_property(\"items\", \"read_only\", false);\n\n}\nelse if (cur_frm.doc.selco_type_of_stock_entry == \"Rejection In\")\n{\ncur_frm.set_value('purpose', \"Material Receipt\")\ncur_frm.set_value('selco_inward_or_outward', \"\")\ncur_frm.doc.selco_type_of_material = \"Repair Stock\";\ncur_frm.set_df_property(\"selco_type_of_material\", \"read_only\", true);\ncur_frm.set_df_property(\"selco_supplier_or_customer\", \"reqd\", true);\ncur_frm.set_df_property(\"selco_supplier_or_customer_id\", \"reqd\", true);\n\n}\nelse if (cur_frm.doc.selco_type_of_stock_entry == \"Rejection Out\")\n{\ncur_frm.set_value('purpose', \"Material Issue\")\ncur_frm.set_value('selco_inward_or_outward', \"\")\ncur_frm.doc.selco_type_of_material = \"Repair Stock\";\ncur_frm.set_df_property(\"selco-type_of_material\", \"read_only\", true);\ncur_frm.set_df_property(\"selco_supplier_or_customer\", \"reqd\", true);\ncur_frm.set_df_property(\"selco_supplier_or_customer_id\", \"reqd\", true);\n}\n});\n\n \n\nfrappe.ui.form.on(\"Stock Entry\", \"selco-inward_or_outward\", function(frm, cdt, cdn) {\nif (cur_frm.doc.selco_inward_or_outward == \"Inward\")\n{\ncur_frm.clear_table(\"items\");\ncur_frm.set_df_property(\"items\", \"read_only\", true);\n} else\n{\ncur_frm.set_df_property(\"items\", \"read_only\", false);\n}\n})\n\nfrappe.ui.form.on(\"Stock Entry\", \"purpose\", function(frm) {\nif(cur_frm.doc.purpose==\"Material Issue\")\n{\n\ncur_frm.clear_table(\"items\");\ncur_frm.set_df_property(\"items\", \"read_only\", true);\n\n    cur_frm.set_query(\"selco_rejection_in_id\", function() {\n        return {\n            \"filters\": {\n                \"supplier_or_customer_id\": frm.doc.selco_supplier_or_customer_id,\n                \"purpose\": \"Material Receipt\",\n                \"docstatus\":1\n            }\n        };\n    });\n}\n});\n\nfrappe.ui.form.on(\"Stock Entry\", \"purpose\", function(frm, cdt, cdn) {\nrefresh_field(\"selco_type_of_material\");\nif (cur_frm.doc.purpose == \"Repack\")\n{\ncur_frm.doc.selco_type_of_material = \"Good Stock\";\ncur_frm.doc.selco_inward_or_outward = \"\";\ncur_frm.set_df_property(\"selco_type_of_material\", \"read_only\", true);\n} else if ( (cur_frm.doc.purpose == \"Material Receipt\"))\n{\ncur_frm.doc.selco_type_of_material = \"Repair Stock\";\ncur_frm.set_df_property(\"selco_type_of_material\", \"read_only\", true);\ncur_frm.set_df_property(\"selco_supplier_or_customer\", \"reqd\", true);\ncur_frm.set_df_property(\"selco_supplier_or_customer_id\", \"reqd\", true);\n} else if(cur_frm.doc.purpose == \"Material Issue\")\n{\ncur_frm.doc.selco_type_of_material = \"Repair Stock\";\ncur_frm.set_df_property(\"selco_type_of_material\", \"read_only\", true);\ncur_frm.set_df_property(\"selco_supplier_or_customer\", \"reqd\", true);\ncur_frm.set_df_property(\"selco_supplier_or_customer_id\", \"reqd\", true);\n} \nelse if (cur_frm.doc.purpose == \"Material Transfer\")\n{\ncur_frm.set_df_property(\"selco_type_of_material\", \"read_only\", false);\nrefresh_field(\"selco_type_of_material\");\n}\n})\n\nfrappe.ui.form.on(\"Stock Entry\", \"to_warehouse\", function(frm, cdt, cdn) {\n\tvar d = locals[cdt][cdn];\n\tfrappe.call({\n\t\t\"method\": \"frappe.client.get\",\n\t\targs: {\n\t\t\tdoctype: \"Warehouse\",\n\t\t\tname: d.to_warehouse\n\t\t},\n\t\tcallback: function (data) {\n\t\t\tfrappe.model.set_value(d.doctype, d.name, \"branch_address_link\",data.message.address);\n\n\t\t}\n\t})\n})\n\nfrappe.ui.form.on(\"Stock Entry\", \"branch_address_link\", function(frm, cdt, cdn) {\n        return frm.call({\n            method: \"erpnext.utilities.doctype.address.address.get_address_display\",\n            args: {\n                \"address_dict\": frm.doc.branch_address_link\n            },\n            callback: function(r) {\n            if(r.message) {\n             frappe.model.set_value(cdt,cdn,\"branch_address\", r.message);\n        }\n        }});\n     \n})\n\n\nfrappe.ui.form.on(\"Stock Entry\", \"refresh\", function(frm) {\n    cur_frm.set_query(\"selco_supplier_or_customer\", function() {\n        return {\n            \"filters\": {\n                \"name\":[\"in\", [\"Customer\", \"Supplier\"]]\n\n            }\n        };\n})\n    });\n\n\n\nfrappe.ui.form.on(\"Stock Entry\", \"selco_get_items_from_supplier_reference\", function(frm,cdt,cdn) {\nconsole.log(\"Button Clicked\");\ncur_frm.set_df_property(\"items\", \"read_only\", true);\n\t\t\tfrappe.call({\t\t\t\t    \"method\":\"selco.selco.doctype.selco_customizations.selco_customizations.get_items_from_outward_stock_entry\",\n\t\t\t\targs:{ selco_doc_num : cur_frm.doc.suppliers_ref,selco_branch : cur_frm.doc.branch},\n\t\t\t\tcallback: function (data) {\ncur_frm.doc.from_warehouse = data.message.from_warehouse;\ncur_frm.doc.to_warehouse = data.message.to_warehouse;\ncur_frm.clear_table(\"items\");\nfor (i = 0; i < data.message.dc.items.length; i++) { \nvar newrow = frappe.model.add_child(cur_frm.doc,\"Stock Entry Detail\", \"items\");\nnewrow.item_code = data.message.dc.items[i].item_code;\nnewrow.qty = data.message.dc.items[i].qty;\nnewrow.uom = data.message.dc.items[i].uom;\nnewrow.transfer_qty = data.message.dc.items[i].transfer_qty;\nnewrow.conversion_factor = data.message.dc.items[i].conversion_factor;\nrefresh_field(\"items\");\nrefresh_field(\"from_warehouse\");\nrefresh_field(\"to_warehouse\");\n\n}\n}\n})\n});\n\n\n\nfrappe.ui.form.on(\"Stock Entry\", \"selco_get_items_from_rejection_in\", function(frm,cdt,cdn) {\nconsole.log(\"Button Clicked\");\ncur_frm.set_df_property(\"items\", \"read_only\", true);\n\t\t\tfrappe.call({\t\t\t\t    \"method\":\"selco.selco.doctype.selco_customizations.selco_customizations.selco_get_items_from_rejection_in\",\n\t\t\t\targs:{ selco_rej_in : cur_frm.doc.selco_rejection_in_id,selco_branch : cur_frm.doc.branch},\n\t\t\t\tcallback: function (data) {\ncur_frm.doc.from_warehouse = data.message.from_warehouse;\ncur_frm.clear_table(\"items\");\nfor (i = 0; i < data.message.dc.items.length; i++) { \nvar newrow = frappe.model.add_child(cur_frm.doc,\"Stock Entry Detail\", \"items\");\nnewrow.item_code = data.message.dc.items[i].item_code;\nnewrow.qty = data.message.dc.items[i].qty;\nnewrow.uom = data.message.dc.items[i].uom;\nnewrow.transfer_qty = data.message.dc.items[i].transfer_qty;\nnewrow.conversion_factor = data.message.dc.items[i].conversion_factor;\nrefresh_field(\"items\");\nrefresh_field(\"from_warehouse\");\nrefresh_field(\"to_warehouse\");\n\n}\n}\n})\n});\n\n\n\nfrappe.ui.form.on(\"Stock Entry\", \"refresh\", function(frm) {\n   {\n      cur_frm.add_custom_button(__(\"Get Items from IBM\"),\n        cur_frm.cscript.get_items_from_ibm1);\n    }\n})\n\n cur_frm.cscript.get_items_from_ibm1 = function()\n{\ncur_frm.clear_table(\"items\");\n  var d = new frappe.ui.Dialog({\n    title: __(\"Get Items from IBM\"),\n    fields: [\n      {\"fieldname\":\"ibm\", \"fieldtype\":\"Link\", \"label\":__(\"IBM\"),\n        options:\"Material Request\", reqd: 1, get_query: function(){\n          //return {filters: { workflow_state:\"Approved - IBM\",branch:cur_frm.doc.branch}}\n          //return {filters: { workflow_state:[\"in\", [\"Approved - IBM\", \"Partially Dispatched From Godown - IBM\"]] ,branch:cur_frm.doc.branch}}\n          return {filters: {branch:cur_frm.doc.branch}}\n        }},\n      {fieldname:\"fetch\", \"label\":__(\"Get Items from IBM\"), \"fieldtype\":\"Button\"}\n    ]\n  });\n  d.get_input(\"fetch\").on(\"click\", function() {\n    var values = d.get_values();\n    console.log(values.ibm)\n    if(!values) return;\n    frappe.call({\n      \"method\": \"frappe.client.get\",\n      args: {\n        doctype: \"Material Request\",\n        name:values.ibm\n      },\n      callback: function (data) {\n        if (data.message) {\n        for (i=0;i<data.message.items.length;i++)\n        {\n        var newrow = frappe.model.add_child(cur_frm.doc,\"Stock Entry Detail\", \"items\");\n        newrow.item_code=data.message.items[i].item_code;\n        newrow.item_name=data.message.items[i].item_name;\n        newrow.qty=data.message.items[i].qty;\n        newrow.transfer_qty=data.message.items[i].qty;\n        newrow.uom=data.message.items[i].uom;\n        newrow.stock_uom=data.message.items[i].uom;\n        newrow.conversion_factor=1;\n        }\n        }\n        refresh_field(\"items\");\n        d.hide();\n    }\n    })\n\n  });\n  d.show();\n}\n\nfrappe.ui.form.on(\"Stock Entry\", \"selco_supplier_or_customer\", function(frm) {\n    {\n\n        if (cur_frm.doc.selco_type_of_stock_entry == \"Rejection In\" && cur_frm.doc.selco_supplier_or_customer == \"Supplier\") {\n            cur_frm.add_custom_button(__(\"Get Items From Rejection Out\"), cur_frm.cscript.get_items_from_rejection_out);\n        } else if (cur_frm.doc.selco_type_of_stock_entry == \"Rejection Out\" && cur_frm.doc.selco_supplier_or_customer == \"Customer\") {\n            cur_frm.add_custom_button(__(\"Get Items From Rejection In\"), cur_frm.cscript.selco_get_items_from_rejection_in);\n        }\n    }\n})\n\n\ncur_frm.cscript.get_items_from_rejection_in = function()\n{\nconsole.log(\"clicked on rejection in\");\n\n  var d = new frappe.ui.Dialog({\n      title: __(\"Get Items from Rejection In\"),\n      fields: [{\n              \"fieldname\": \"rejection_in\",\n              \"fieldtype\": \"Link\",\n              \"label\": __(\"Rejection In\"),\n              options: \"Stock Entry\",\n              reqd: 1,\n              get_query: function() {\n\n                  return {\n                      filters: {\n                          type_of_stock_entry: \"Rejection In\",branch:cur_frm.doc.branch,supplier_or_customer_id:cur_frm.doc.supplier_or_customer_id,docstatus:1\n                      }\n                  }\n              }\n          },\n          {\n              fieldname: \"fetch\",\n              \"label\": __(\"Get Items from Rejection In\"),\n              \"fieldtype\": \"Button\"\n          }\n      ]\n  });\n  d.get_input(\"fetch\").on(\"click\", function() {\n    var values = d.get_values();\n    console.log(values.rejection_in)\n    if(!values) return;\n    frappe.call({\n      \"method\": \"frappe.client.get\",\n      args: {\n        doctype: \"Stock Entry\",\n        name:values.rejection_in\n      },\n      callback: function (data) {\n        if (data.message) {\n        for (i=0;i<data.message.items.length;i++)\n        {\n         console.log(data.message.items[i]);\n         var newrow = frappe.model.add_child(cur_frm.doc,\"Stock Entry Detail\", \"items\");\nnewrow.item_code = data.message.items[i].item_code;\nnewrow.qty = data.message.items[i].qty - data.message.items[i].reference_rej_in_or_rej_quantity;\nnewrow.uom = data.message.items[i].uom;\nnewrow.transfer_qty = data.message.items[i].transfer_qty;\nnewrow.conversion_factor = data.message.items[i].conversion_factor;\nnewrow.reference_rej_in_or_rej_ot = data.message.name;\n\n        }\n        }\n        refresh_field(\"items\");\n        d.hide();\n    }\n    })\n\n  });\n  d.show();\n\n\n}\n\ncur_frm.cscript.get_items_from_rejection_out = function()\n{\nconsole.log(\"clicked on rejection out\");\n\n  var d = new frappe.ui.Dialog({\n      title: __(\"Get Items from Rejection Out\"),\n      fields: [{\n              \"fieldname\": \"rejection_out\",\n              \"fieldtype\": \"Link\",\n              \"label\": __(\"Rejection Out\"),\n              options: \"Stock Entry\",\n              reqd: 1,\n              get_query: function() {\n\n                  return {\n                      filters: {\n                          type_of_stock_entry: \"Rejection Out\",branch:cur_frm.doc.branch,supplier_or_customer_id:cur_frm.doc.supplier_or_customer_id,docstatus:1\n                      }\n                  }\n              }\n          },\n          {\n              fieldname: \"fetch\",\n              \"label\": __(\"Get Items from Rejection Out\"),\n              \"fieldtype\": \"Button\"\n          }\n      ]\n  });\n  d.get_input(\"fetch\").on(\"click\", function() {\n    var values = d.get_values();\n    console.log(values.rejection_out)\n    if(!values) return;\n    frappe.call({\n      \"method\": \"frappe.client.get\",\n      args: {\n        doctype: \"Stock Entry\",\n        name:values.rejection_out\n      },\n      callback: function (data) {\n        if (data.message) {\n        for (i=0;i<data.message.items.length;i++)\n        {\n         console.log(data.message.items[i]);\n         var newrow = frappe.model.add_child(cur_frm.doc,\"Stock Entry Detail\", \"items\");\nnewrow.item_code = data.message.items[i].item_code;\nnewrow.qty = data.message.items[i].qty - data.message.items[i].reference_rej_in_or_rej_quantity;\nnewrow.uom = data.message.items[i].uom;\nnewrow.transfer_qty = data.message.items[i].transfer_qty;\nnewrow.conversion_factor = data.message.items[i].conversion_factor;\nnewrow.reference_rej_in_or_rej_ot = data.message.name;\n\n        }\n        }\n        refresh_field(\"items\");\n        d.hide();\n    }\n    })\n\n  });\n  d.show();\n\n\n}\nfrappe.ui.form.on(\"Stock Entry\", \"refresh\", function(frm) {\nif (cur_frm.doc.__islocal == 1)\n{\nif (frappe.user_info().email == \"southgodown@selco-india.com\")\n{\ncur_frm.doc.branch = \"Manipal Godown\";\ncur_frm.set_df_property(\"branch\", \"read_only\", true);\n} else if (frappe.user_info().email == \"northgodown@selco-india.com\")\n{\ncur_frm.doc.branch = \"Dharwad Godown\";\ncur_frm.set_df_property(\"branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"bangalore_godown@selco-india.com\")\n{\ncur_frm.doc.branch = \"Bangalore Godown\";\ncur_frm.set_df_property(\"branch\", \"read_only\", true);\n}\n}\n})", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Journal Entry", 
  "modified": "2017-11-07 12:24:48.515580", 
  "name": "Journal Entry-Client", 
  "script": "/*To set naming series when branch is choosen for the first time */\ncur_frm.add_fetch(\"branch\", \"receipt_naming_series\", \"naming_series\"); \n\n/*To set naming series when the value in branch is changed\nfrappe.ui.form.on(\"Journal Entry\", \"branch\",\n    function(frm) {\ncur_frm.add_fetch(\"branch\", \"receipt_naming_series\", \"naming_series\");\n\nif ( cur_frm.doc.naming_series == null )\n{\nwindow.location.reload();\nmsgprint(\"Please set the correct naming series for the branch.\");\n       throw \"Not allowed\";\n}\n})*/\nfrappe.ui.form.on(\"Journal Entry\", \"validate\", function(frm) {\nif (user_roles.indexOf(\"SELCO Lead Accountant\")!=-1 && cur_frm.doc.voucher_type==\"Write Off Entry\")\n frappe.throw(\"You are not allowed to raise the journal entry of type write off!!\");\n})\n\n\nfrappe.ui.form.on(\"Journal Entry\", \"refresh\", function(frm) {\n{\nif(!cur_frm.doc.__islocal)\n//frappe.model.add_child(cur_frm.doc, \"Journal Entry Account\", 'accounts')\n//refresh_field(\"accounts\");\ncur_frm.set_df_property(\"voucher_type\", \"read_only\", true);\n}\n})\n\nfrappe.ui.form.on(\"Journal Entry\", \"voucher_type\", function(frm, cdt, cdn) {\nconsole.log(\"voucher type\");\nif(cur_frm.doc.voucher_type == \"Payment Entry - HO - SBI\" && cur_frm.doc.selco_branch == \"Head Office\")\n{\ncur_frm.doc.naming_series = \"SBI/HO/17-18/\";\nconsole.log(\"SBI\");\nrefresh_field(\"naming_series\");\n}\nelse if (cur_frm.doc.voucher_type == \"Journal Entry - HO - FD\" && cur_frm.doc.selco_branch == \"Head Office\")   \n{\ncur_frm.doc.naming_series = \"FD/HO/17-18/\";\n} \nelse if (cur_frm.doc.voucher_type == \"Opening Entry - HO - SELCO\" && cur_frm.doc.selco_branch == \"Head Office\")   \n{\ncur_frm.doc.naming_series = \"OPNS/HO/17-18/\";\n} \n})\n\n\nfrappe.ui.form.on(\"Journal Entry\", \"refresh\", function(frm) {\nif (cur_frm.doc.__islocal == 1)\n{\nif (frappe.user_info().email == \"bangalore_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Bangalore Service Branch\";\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n} else if (frappe.user_info().email == \"kundapura_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Kundapur Service Branch\";\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"puttur_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Puttur Service Branch\";\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"hassan_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Hassan Service Branch\";\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"bellary_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Ballari Service Branch\";\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"shimoga_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Shivamogga Service Branch\";\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"chitradurga_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Chitradurga Service Branch\";\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"dharwad_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Dharwad Service Branch\";\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"vijayapura_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Vijayapura Service Branch\";\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"mysore_service_center@selco-india.com\")\n{\ncur_frm.doc.branch = \"Mysore Service Branch\";\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}\n}\n})\n\nfrappe.ui.form.on(\"Journal Entry\", \"voucher_type\", function(frm, cdt, cdn) {\nif(cur_frm.doc.voucher_type == \"Commission Journal\" && cur_frm.doc.selco_branch == \"Head Office\")\n{\ncur_frm.doc.naming_series = \"CJ/HO/17-18/\";\nrefresh_field(\"naming_series\");\n}\n})\n\n\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Lead", 
  "modified": "2017-11-07 12:32:50.396488", 
  "name": "Lead-Client", 
  "script": "/*To set naming series when branch is choosen for the first time */\ncur_frm.add_fetch(\"selco_branch\", \"lead_naming_series\", \"naming_series\"); \n\n/*To set naming series when the value in branch is changed*/\nfrappe.ui.form.on(\"Lead\", \"selco_branch\",\n    function(frm) {\ncur_frm.add_fetch(\"selco_branch\", \"lead_naming_series\", \"naming_series\");\n\nif ( cur_frm.doc.naming_series == null )\n{\nwindow.location.reload();\nmsgprint(\"Please set the correct naming series for the branch.\");\n       throw \"Not allowed\";\n}\n})\n\nfrappe.ui.form.on(\"Lead\", \"refresh\", function(frm) {\ncur_frm.set_query(\"source\", function() {\n    return {\n        filters: [\n            ['Lead Source', 'name', 'in', 'Generated By Sales Person,Demo,Customers Visit To Branch,Service Camp,Others,Toll Free Number,Direct - Project Manager,Branch - Project Manager,SELCO Foundation,SKDRDP,Business Associate']\n        ]\n    }\n})\n});\n\nfrappe.ui.form.on(\"Lead\", \"selco_project_enquiry\",function(frm) \n{\ncur_frm.set_df_property(\"selco_area\", \"reqd\", true);\n})", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Purchase Order", 
  "modified": "2017-11-07 13:06:26.234510", 
  "name": "Purchase Order-Client", 
  "script": "/*To set naming series when branch is choosen for the first time */\ncur_frm.add_fetch(\"selco__godown\", \"po_naming_series\", \"naming_series\"); \n\ncur_frm.add_fetch(\"selco__godown\", \"selco_godown_email\", \"selco_godown_email\"); \n\nfrappe.ui.form.on(\"Purchase Order\", \"selco_godown_address\", function(frm, cdt, cdn) {\n        return frm.call({\n            method: \"erpnext.utilities.doctype.address.address.get_address_display\",\n            args: {\n                \"address_dict\": frm.doc.selco_godown_address\n            },\n            callback: function(r) {\n            if(r.message) {\n           /*  console.log(r.message);*/                   \n             frappe.model.set_value(cdt,cdn,\"selco_godown_address_details\", r.message);\n            /* $(frm.fields_dict.detail_address.wrapper).html(r.message) */  }\n        }\n        });\n     \n})\n\n\ncur_frm.add_fetch(\"supplier\", \"selco_gstin\", \"selco_suppliers_gstin\"); \ncur_frm.add_fetch(\"supplier\", \"suppliers_vat_tin\", \"selco_suppliers_vat_tin\"); \n\n\ncur_frm.add_fetch(\"supplier\", \"credit_days\", \"selco_mode_terms_of_payment\");\n\ncur_frm.add_fetch(\"supplier\", \"terms_and_conditions\", \"tc_name\");\n\ncur_frm.add_fetch(\"godown\", \"address\", \"selco_godown_address\");\n\n\n\n\nfrappe.ui.form.on(\"Purchase Order\", \"validate\", function(frm) \n{\nvar advance_local = cur_frm.doc.base_rounded_total * ( cur_frm.doc.selco_advance_percentage_1 / 100 ) ;\nadvance_local = Math.floor(advance_local);\nvar balance_local = cur_frm.doc.base_rounded_total - advance_local ;\n\ncur_frm.set_value(\"selco_advance_details_currency\",advance_local);\ncur_frm.set_value(\"selco_balance_details_currency\",balance_local);\n})\n\n\nfrappe.ui.form.on(\"Purchase Order\", \"refresh\",\n    function(frm) {\nif ( cur_frm.doc.selco_workflow_state == \"AGM Approval Pending - PO\" || cur_frm.doc.selco_workflow_state == \"Logistics Manager Approval Pending - PO\" || cur_frm.doc.selco_workflow_state == \"Accounts Approval Pending - PO\")\n{\ncur_frm.fields.forEach(function(l){ cur_frm.set_df_property(l.df.fieldname, \"read_only\", 1); })\n\n\nvar df = frappe.meta.get_docfield(\"Purchase Order Item\", \"item_code\", cur_frm.doc.name);\ndf.read_only = 1;\nvar df = frappe.meta.get_docfield(\"Purchase Order Item\", \"item_name\", cur_frm.doc.name);\ndf.read_only = 1;\nvar df = frappe.meta.get_docfield(\"Purchase Order Item\", \"schedule_date\", cur_frm.doc.name);\ndf.read_only = 1;\nvar df = frappe.meta.get_docfield(\"Purchase Order Item\", \"expected_delivery_date\", cur_frm.doc.name);\ndf.read_only = 1;\nvar df = frappe.meta.get_docfield(\"Purchase Order Item\", \"description\", cur_frm.doc.name);\ndf.read_only = 1;\nvar df = frappe.meta.get_docfield(\"Purchase Order Item\", \"qty\", cur_frm.doc.name);\ndf.read_only = 1;\nvar df = frappe.meta.get_docfield(\"Purchase Order Item\", \"uom\", cur_frm.doc.name);\ndf.read_only = 1;\nvar df = frappe.meta.get_docfield(\"Purchase Order Item\", \"conversion_factor\", cur_frm.doc.name);\ndf.read_only = 1;\nvar df = frappe.meta.get_docfield(\"Purchase Order Item\", \"price_list_rate\", cur_frm.doc.name);\ndf.read_only = 1;\nvar df = frappe.meta.get_docfield(\"Purchase Order Item\", \"discount_percentage\", cur_frm.doc.name);\ndf.read_only = 1;\nvar df = frappe.meta.get_docfield(\"Purchase Order Item\", \"rate\", cur_frm.doc.name);\ndf.read_only = 1;\n\n\n\n}\n})\n\nfrappe.ui.form.on(\"Purchase Order\", \"refresh\", function(frm) {\n    cur_frm.set_query(\"godown\", function() {\n        return {\n            \"filters\": {\n                \"type\": \"Godown\"\n            }\n        };\n    });\n});\n\nfrappe.ui.form.on(\"Purchase Order Item\",\"item_code\",function(frm,cdt,cdn){\nvar d = locals[cdt][cdn];\nd.warehouse = cur_frm.doc.selco_godown;\nfrm.set_df_property(\"selco_godown\", \"read_only\",1);\n});\n\nfrappe.ui.form.on(\"Purchase Order\",\"validate\",function(frm,cdt,cdn){\nop = cur_frm.doc.items\nfor(var i=0; i < op.length; i++) {\nif(op[i].warehouse == cur_frm.doc.selco_godown){\n} else\n{\nconsole.log(\"error message\");\nfrappe.throw(\"Please choose same warehouse for all items\");\n}\n}\n});\n\nfrappe.ui.form.on(\"Purchase Order\", \"validate\", function(frm) \n{\ncur_frm.doc.supplier_name_custom = cur_frm.doc.supplier_name;\n})", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Purchase Receipt", 
  "modified": "2017-11-07 13:31:52.824354", 
  "name": "Purchase Receipt-Client", 
  "script": "\n/*\nfrappe.ui.form.on(\"Purchase Receipt\", \"refresh\", function(frm) {\n\tif(frm.doc.godown) {\n\t\tfrm.call({\n\t\t\tmethod: \"frappe.client.get_value\",\n\t\t\targs: {\n\t\t\t\tdoctype: \"Warehouse\",\n\t\t\t\tfieldname: \"mrn_naming_series\",\n\t\t\t\tfilters: { name: frm.doc.godown },\n\t\t\t},\n\t\t\tcallback: function(r, rt) {\n\t\t\t\tif(r.message) {\n\t\t\t\t\tfrm.set_value(\"naming_series\", r.message.mrn_naming_series);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n})\n*/\n\n\nfrappe.ui.form.on(\"Purchase Receipt\", \"godown\", function(frm) {\n\tif(frm.doc.godown) {\n\t\tfrm.call({\n\t\t\tmethod: \"frappe.client.get_value\",\n\t\t\targs: {\n\t\t\t\tdoctype: \"Warehouse\",\n\t\t\t\tfieldname: \"mrn_naming_series\",\n\t\t\t\tfilters: { name: frm.doc.godown },\n\t\t\t},\n\t\t\tcallback: function(r, rt) {\n\t\t\t\tif(r.message) {\n\t\t\t\t\tfrm.set_value(\"naming_series\", r.message.mrn_naming_series);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n})\n\n\nfrappe.ui.form.on(\"Purchase Receipt\",\"validate\",function(frm,cdt,cdn){\n\nfor(var i=0; i < cur_frm.doc.items.length; i++) \n{\ncur_frm.doc.items[i].warehouse = cur_frm.doc.godown; \n}\n\n\ncur_frm.clear_table(\"purchase_receipt_item_print\");\ncur_frm.refresh()\nvar flag=0;\n\nvar newrow = frappe.model.add_child(cur_frm.doc,\"Purchase Receipt Item Print\", \"selco_purchase_receipt_item_print\");\nnewrow.selco_item_code = cur_frm.doc.items[0].selco_item_code\nnewrow.selco_item_name = cur_frm.doc.items[0].selco_item_name\nnewrow.selco_received_quantity = cur_frm.doc.items[0].selco_received_qty\nnewrow.selco_accepted_quantity = cur_frm.doc.items[0].selco_qty\nnewrow.selco_rejected_quantity = cur_frm.doc.items[0].selco_rejected_qty\nnewrow.selco_rate = cur_frm.doc.items[0].selco_rate\n\nfor (i = 1; i < cur_frm.doc.items.length; i++) { \nfor (j = 0; j < cur_frm.doc.selco_purchase_receipt_item_print.length; j++) { \nif (cur_frm.doc.items[i].selco_item_code == cur_frm.doc.selco_purchase_receipt_item_print[j].selco_item_code && cur_frm.doc.items[i].selco_item_name == cur_frm.doc.selco_purchase_receipt_item_print[j].selco_item_name)\n{\nflag = 1;\ncur_frm.doc.selco_purchase_receipt_item_print[j].selco_received_quantity = cur_frm.doc.selco_purchase_receipt_item_print[j].selco_received_quantity+cur_frm.doc.items[i].selco_received_qty;\ncur_frm.doc.selco_purchase_receipt_item_print[j].selco_accepted_quantity = cur_frm.doc.selco_purchase_receipt_item_print[j].selco_accepted_quantity +cur_frm.doc.items[i].selco_qty;\ncur_frm.doc.selco_purchase_receipt_item_print[j].selco_rejected_quantity = cur_frm.doc.selco_purchase_receipt_item_print[j].selco_rejected_quantity +cur_frm.doc.items[i].selco_rejected_qty;\nrefresh_field(\"selco_purchase_receipt_item_print\");\n}\n}\nif(flag != 1)\n{\nvar newrow = frappe.model.add_child(cur_frm.doc,\"Purchase Receipt Item Print\", \"selco_purchase_receipt_item_print\");\nnewrow.selco_item_code = cur_frm.doc.items[i].selco_item_code\nnewrow.selco_item_name = cur_frm.doc.items[i].selco_item_name\nnewrow.selco_received_quantity = cur_frm.doc.items[i].selco_received_qty\nnewrow.selco_accepted_quantity = cur_frm.doc.items[i].selco_qty\nnewrow.selco_rejected_quantity = cur_frm.doc.items[i].selco_rejected_qty}\nnewrow.selco_rate = cur_frm.doc.items[i].selco_rate\nflag=0;\n}\n\n\n\n});\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Customer", 
  "modified": "2017-11-07 14:35:01.642889", 
  "name": "Customer-Client", 
  "script": "/*To set naming series when branch is choosen for the first time */\ncur_frm.add_fetch(\"selco_branch\", \"customer_naming_series\", \"naming_series\"); \n\n/*To set naming series when the value in branch is changed*/\nfrappe.ui.form.on(\"Lead\", \"selco_branch\",\n    function(frm) {\ncur_frm.add_fetch(\"selco_branch\", \"customer_naming_series\", \"naming_series\");\n\nif ( cur_frm.doc.naming_series == null )\n{\nwindow.location.reload();\nmsgprint(\"Please set the correct naming series for customers in branch record.\");\n       throw \"Not allowed\";\n}\n})", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Delivery Note", 
  "modified": "2017-11-07 14:40:45.973666", 
  "name": "Delivery Note-Client", 
  "script": "/*To set naming series when branch is choosen for the first time */\ncur_frm.add_fetch(\"selco_branch\", \"delivery_note_naming_series\", \"naming_series\"); \n\n/*To set naming series when the value in branch is changed*/\nfrappe.ui.form.on(\"Delivery Note\", \"selco_branch\",\n    function(frm) {\ncur_frm.add_fetch(\"selco_branch\", \"delivery_note_naming_series\", \"naming_series\");\n\nif ( cur_frm.doc.naming_series == null )\n{\nwindow.location.reload();\nmsgprint(\"Please set the correct naming series for the branch.\");\n       throw \"Not allowed\";\n}\n})\n\nfrappe.ui.form.on(\"Delivery Note\", \"refresh\", function(frm) {\n   {\n      cur_frm.add_custom_button(__(\"Get Items from BOM\"),\n        cur_frm.cscript.get_items_from_bom2);\n    }\n})\n\ncur_frm.cscript.get_items_from_bom2 = function() {\n\nif (!cur_frm.doc.items[0].item_code) \n{\ncur_frm.clear_table(\"items\");\n}\n\n  var d = new frappe.ui.Dialog({\n    title: __(\"Get Items from BOM\"),\n    fields: [\n      {\"fieldname\":\"bom\", \"fieldtype\":\"Link\", \"label\":__(\"BOM\"),\n        options:\"Stock Entry\", reqd: 1, get_query: function(){\n          return {filters: { purpose:\"Repack\"}}\n        }},\n      {fieldname:\"fetch\", \"label\":__(\"Get Items from BOM\"), \"fieldtype\":\"Button\"}\n    ]\n  });\n  d.get_input(\"fetch\").on(\"click\", function() {\n    var values = d.get_values();\n    cur_frm.doc.imported_system = values.bom;\n    if(!values) return;\n    frappe.call({\n      \"method\": \"frappe.client.get\",\n      args: {\n        doctype: \"Stock Entry\",\n        name:values.bom\n      },\n      callback: function (data) {\n        if (data.message) {\n        for (i=0;i<data.message.items.length;i++)\n        {\n          if (data.message.items[i].t_warehouse)\n          {\n        var newrow = frappe.model.add_child(cur_frm.doc,\"Delivery Note Item\", \"items\");\n        newrow.item_code=data.message.items[i].item_code;\n        newrow.item_name=data.message.items[i].item_name;\n        newrow.qty=data.message.items[i].qty;\n        newrow.stock_uom=data.message.items[i].stock_uom;\n        newrow.description=data.message.items[i].description;\n        newrow.rate=11000;\n      }\n        //console.log(data.message.items[i]);\n        }\n\n        }\n        refresh_field(\"items\");\n        d.hide();\n    }\n    })\n\n  });\n  d.show();\n}", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Sales Invoice", 
  "modified": "2017-11-07 15:18:01.746807", 
  "name": "Sales Invoice-Client", 
  "script": "cur_frm.add_fetch(\"customer\", \"selco_customer_contact_number\",\"selco_customer_contact_number\");\ncur_frm.add_fetch(\"customer\", \"selco_customer_tin_number\",\"selco_customer_tin_number\");\ncur_frm.add_fetch(\"selco_sales_account\", \"sales_tax_template\",\"taxes_and_charges\");\n\n\n\n// frappe.ui.form.on(\"Stock Entry\", \"type_of_stock_entry\", function(frm) {\ncur_frm.set_df_property(\"type_of_stock_entry\", \"read_only\", true);\ncur_frm.clear_table(\"items\");\ncur_frm.set_df_property(\"items\", \"read_only\", true);\ncur_frm.set_df_property(\"rejection_in_id\", \"reqd\", false);\ncur_frm.set_df_property(\"rejection_out_id\", \"reqd\", false);\n\nif (cur_frm.doc.type_of_stock_entry == \"GRN\")\n{\ncur_frm.set_df_property(\"items\", \"read_only\", true);\ncur_frm.set_value('purpose', \"Material Transfer\")\ncur_frm.set_value('inward_or_outward', \"Inward\")\n}\nelse if (cur_frm.doc.type_of_stock_entry == \"Outward DC\")\n{\ncur_frm.set_value('purpose', \"Material Transfer\")\ncur_frm.set_value('inward_or_outward', \"Outward\")\ncur_frm.set_df_property(\"being_dispatched_to\", \"reqd\", true);\n}\nelse if (cur_frm.doc.type_of_stock_entry == \"BOM\")\n{\ncur_frm.set_value('purpose', \"Repack\")\ncur_frm.set_value('inward_or_outward', \"\")\ncur_frm.doc.type_of_material = \"Good Stock\";\ncur_frm.doc.inward_or_outward = \"\";\ncur_frm.set_df_property(\"type_of_material\", \"read_only\", true);\n\n}\nelse if (cur_frm.doc.type_of_stock_entry == \"Rejection In\")\n{\ncur_frm.set_value('purpose', \"Material Receipt\")\ncur_frm.set_value('inward_or_outward', \"\")\ncur_frm.doc.type_of_material = \"Repair Stock\";\ncur_frm.set_df_property(\"type_of_material\", \"read_only\", true);\ncur_frm.set_df_property(\"supplier_or_customer\", \"reqd\", true);\ncur_frm.set_df_property(\"supplier_or_customer_id\", \"reqd\", true);\n\n}\nelse if (cur_frm.doc.type_of_stock_entry == \"Rejection Out\")\n{\ncur_frm.set_value('purpose', \"Material Issue\")\ncur_frm.set_value('inward_or_outward', \"\")\ncur_frm.doc.type_of_material = \"Repair Stock\";\ncur_frm.set_df_property(\"type_of_material\", \"read_only\", true);\ncur_frm.set_df_property(\"supplier_or_customer\", \"reqd\", true);\ncur_frm.set_df_property(\"supplier_or_customer_id\", \"reqd\", true);\n\n    cur_frm.set_query(\"rejection_in_id\", function() {\n        return {\n            \"filters\": {\n                \"supplier_or_customer_id\": frm.doc.supplier_or_customer_id,\n                \"purpose\": \"Material Receipt\",\n                \"docstatus\":1\n            }\n        };\n    });\n\n\n}\n});//\n\n\n\n\n\nfrappe.ui.form.on(\"Sales Invoice\", \"selco_type_of_invoice\",\n    function(frm) {\nif ( cur_frm.doc.selco_type_of_invoice == \"System Sales Invoice\" )\n{\ncur_frm.set_df_property(\"selco_service_bill_no\", \"reqd\", true);\n} else if( cur_frm.doc.selco_type_of_invoice == \"Spare Sales Invoice\" )\n{\ncur_frm.set_df_property(\"selco_service_bill_no\", \"reqd\", false);\n}\nelse if (cur_frm.doc.selco_type_of_invoice == \"Service Bill\")\n{\ncur_frm.set_df_property(\"selco_service_bill_no\", \"reqd\", false);\n}\n})\n\nfrappe.ui.form.on(\"Sales Invoice\", \"refresh\", function(frm) {\n    cur_frm.set_query(\"selco_service_bill_no\", function() {\n        return {\n            \"filters\": {\n                \"customer\": frm.doc.customer,\n                \"selco_type_of_invoice\": \"Service Bill\",\n                \"docstatus\":1\n            }\n        };\n    });\n});\n\n\nfrappe.ui.form.on(\"Sales Invoice\", \"selco_type_of_invoice\", function(frm) {\n\nif ( cur_frm.doc.selco_type_of_invoice == \"Service Bill\")\n{\ncur_frm.fields_dict['items'].grid.get_field('item_code').get_query = function(doc) {\nreturn {\n\n\t\tfilters: [\n                         ['item_group', 'in', 'Installation Charges,AMC,Service Charges']\n\t\t\t\n\t\t]\n\t}\n}\n}\n});\n\n\n\nfrappe.ui.form.on(\"Sales Invoice\", \"selco_type_of_invoice\", function(frm) {\n    if (cur_frm.doc.selco_type_of_invoice == \"Service Bill\") {\n        cur_frm.set_query(\"selco_sales_account\", function() {\n            return {\n                \"filters\": {\n                    \"parent_account\": [\"in\", [\"Karnataka Service - SELCO\",\"Tamilnadu Service - SELCO\",\"Interstate Service - SELCO\"]]\n                }\n            };\n        });\n    }\n\n else if ((cur_frm.doc.selco_type_of_invoice == \"System Sales Invoice\") || (cur_frm.doc.selco_type_of_invoice == \"Spare Sales Invoice\"))\n{\n        cur_frm.set_query(\"selco_sales_account\", function() {\n            return {\n                \"filters\": {\n                    \"parent_account\": [\"in\", [\"Karnataka Sales - SELCO\"]]\n                }\n            };\n        });\n    }\n    \nelse if(cur_frm.doc.selco_type_of_invoice == \"Bill of Sale\")\n{\n        cur_frm.set_query(\"selco_sales_account\", function() {\n            return {\n                \"filters\": {\n                    \"parent_account\": [\"in\", [\"Interstate Sales - SELCO\"]]\n                }\n            };\n        });\n    }\n \n\n\n\n\n\nif ((cur_frm.doc.selco_type_of_invoice == \"System Sales Invoice\") || (cur_frm.doc.selco_type_of_invoice == \n\"Spare Sales Invoice\")) {\n    cur_frm.set_query(\"selco_sales_account\", function() {\n        return {\n            \"filters\": {\n                \"parent_account\": [\"in\", [\"Karnataka Sales - SELCO\"]]\n            }\n        };\n    });\n}\n\n});\n\nfrappe.ui.form.on(\"Sales Invoice\", \"validate\", function(frm) {\nfor (i=0;i<cur_frm.doc.taxes.length;i++)\n{\nif (cur_frm.doc.taxes[i].account_head == \"Discount Karnataka 14.5% - SELCO\")\n{\n//frappe.msgprint(\"Discount!!\");\nif(cur_frm.doc.taxes[i].tax_amount>0)\n{\ncur_frm.doc.taxes[i].tax_amount = cur_frm.doc.taxes[i].tax_amount * -1;\n}\n}\n}\n});\n\n\nfrappe.ui.form.on(\"Sales Invoice\", \"validate\", function(frm) {\nif (user_roles.indexOf(\"SELCO Lead Accountant\")!=-1 && cur_frm.doc.selco_type_of_invoice==\"Write Off\")\n frappe.throw(\"You are not allowed to raise the invoice of type write off!!\");\n})\n\n\n\nfrappe.ui.form.on(\"Sales Invoice\", \"refresh\", function(frm) {\nif (frm.doc.__islocal)\n{\nif (cur_frm.doc.is_return == 1)\n{\nfrm.set_value(\"selco_service_bill_no\", \"\");\nfrm.refresh_field(\"selco_service_bill_no\");\n}\n}\n})\n\n\nfrappe.ui.form.on(\"Sales Invoice\", \"refresh\", function(frm) {\ncur_frm.fields_dict.customer.new_doc = quick_entry_customer;\ncur_frm.fields_dict.customer_address.new_doc = quick_entry_address;\n})\n\n\nquick_entry_address = function(){\nconsole.log(\"Overrided\");\n\tfrappe._from_link = this;\n\tquick_entry(\"Address\", \n\tfunction(){}, \n\t{ \n\t\t\"address_type\": \"Billing\",\n                \"branch\": cur_frm.doc.branch,\n                \"customer\": cur_frm.doc.customer,\n                \"country\" : \"India\"\n\t});\n}\n\nquick_entry_customer = function(){\nconsole.log(\"Overrided\");\n\tfrappe._from_link = this;\n\tquick_entry(\"Customer\", \n\tfunction(){}, \n\t{ \n                \"branch\": cur_frm.doc.branch\n\t});\n}\n\nfrappe.ui.form.on(\"Sales Invoice\", \"refresh\", function(frm) {\nif (cur_frm.doc.__islocal == 1)\n{\nif (frappe.user_info().email == \"bangalore_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Bangalore Service Branch\";\ncur_frm.set_df_property(\"branch\", \"read_only\", true);\n} else if (frappe.user_info().email == \"kundapura_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Kundapur Service Branch\";\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"puttur_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Puttur Service Branch\";\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"hassan_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Hassan Service Branch\";\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"bellary_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Ballari Service Branch\";\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"shimoga_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Shivamogga Service Branch\";\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"chitradurga_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Chitradurga Service Branch\";\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"dharwad_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Dharwad Service Branch\";\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"vijayapura_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Vijayapura Service Branch\";\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"mysore_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Mysore Service Branch\";\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}\n}\n})\n\nfrappe.ui.form.on(\"Sales Invoice\", \"refresh\", function (frm, cdt, cdn) {\n  cur_frm.set_query(\"customer\", function () {\n    return { \n      query: \"erpnext.controllers.queries.customer_query\",\n      searchfield: \"selco_customer_contact_number\"\n    }\n  });\n});\n\nquick_entry = function(doctype, success, fields_map={}) {\n\tfrappe.model.with_doctype(doctype, function() {\n\t\tvar mandatory = [];\n\n\t\tif (!fields_map == {}) {\n\t\t\t$.each(fields_map, function(k,v) {\n\t\t\t\tdoc_field = frappe.meta.get_docfield(doctype, k)\n\t\t\t\tmandatory.push(doc_field);\n\t\t\t});\n\t\t} else {\n\t\t\tmandatory = $.map(frappe.get_meta(doctype).fields,\n\t\t\tfunction(d) { return (d.reqd || d.bold && !d.read_only) ? d : null });\n\t\t}\n\n\t\tvar meta = frappe.get_meta(doctype);\n\t\tvar doc = frappe.model.get_new_doc(doctype, null, null, true);\n\n\t\t/*if(meta.quick_entry != 1) {\n\t\t\tvar d = frappe.model.make_new_doc_and_get_name(doctype);\n\t\t\td = locals[doctype][d];\n\t\t\t$.each(fields_map, function(fieldname, fieldvalue) {\n\t\t\t\td[fieldname] = fieldvalue;\n\t\t\t});\n\t\t\tfrappe.set_route('Form', doctype, d.name);\n\t\t\treturn;\n\t\t}*/\n\n\t\tvar dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"New {0}\", [doctype]),\n\t\t\tfields: mandatory,\n\t\t});\n\n\t\tvar update_doc = function() {\n\t\t\tvar data = dialog.get_values(true);\n\t\t\t$.each(data, function(key, value) {\n\t\t\t\tif(key==='__name') {\n\t\t\t\t\tdialog.doc.name = value;\n\t\t\t\t} else {\n\t\t\t\t\tif(!is_null(value)) {\n\t\t\t\t\t\tdialog.doc[key] = value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn dialog.doc;\n\t\t}\n\n\t\tvar open_doc = function() {\n\t\t\tdialog.hide();\n\t\t\tupdate_doc();\n\t\t\tfrappe.set_route('Form', doctype, doc.name);\n\t\t}\n\n\t\tdialog.doc = doc;\n\n\t\t// refresh dependencies etc\n\t\tdialog.refresh();\n\n\t\tdialog.set_primary_action(__('Save'), function() {\n\t\t\tif(dialog.working) return;\n\t\t\tvar data = dialog.get_values();\n\n\t\t\tif(data) {\n\t\t\t\tdialog.working = true;\n\t\t\t\tvalues = update_doc();\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"frappe.client.insert\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoc: values\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tdialog.hide();\n\t\t\t\t\t\t// delete the old doc\n\t\t\t\t\t\tfrappe.model.clear_doc(dialog.doc.doctype, dialog.doc.name);\n\t\t\t\t\t\tvar doc = r.message;\n\t\t\t\t\t\tif(success) {\n\t\t\t\t\t\t\tsuccess(doc);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfrappe.ui.form.update_calling_link(doc.name);\n\t\t\t\t\t},\n\t\t\t\t\terror: function() {\n\t\t\t\t\t\topen_doc();\n\t\t\t\t\t},\n\t\t\t\t\talways: function() {\n\t\t\t\t\t\tdialog.working = false;\n\t\t\t\t\t},\n\t\t\t\t\tfreeze: true\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tvar $link = $('<div class=\"text-muted small\" style=\"padding-left: 10px; padding-top: 15px;\">\\\n\t\t\tCtrl+enter to save | <a class=\"edit-full\">Edit in full page</a></div>').appendTo(dialog.body);\n\n\t\t$link.find('.edit-full').on('click', function() {\n\t\t\t// edit in form\n\t\t\topen_doc();\n\t\t});\n\n\t\t// ctrl+enter to save\n\t\tdialog.wrapper.keydown(function(e) {\n\t\t\tif((e.ctrlKey || e.metaKey) && e.which==13) {\n\t\t\t\tif(!frappe.request.ajax_count) {\n\t\t\t\t\t// not already working -- double entry\n\t\t\t\t\tdialog.get_primary_btn().trigger(\"click\");\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tdialog.show();\n\n\t\t//Set value and visibility if field map exists.\n\t\tif (fields_map != {}) {\n\t\t\t$.each(dialog.fields_dict, function(fieldname, field) {\n\t\t\t\tfield.set_input(fields_map[fieldname]);\n\t\t\t});\n\t\t} else {\n\t\t\t// set defaults\n\t\t\t$.each(dialog.fields_dict, function(fieldname, field) {\n\t\t\t\tfield.doctype = doc.doctype;\n\t\t\t\tfield.docname = doc.name;\n\t\t\t\tif(!is_null(doc[fieldname])) {\n\t\t\t\t\tfield.set_input(doc[fieldname]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n}\n\nfrappe.ui.form.on(\"Journal Entry\", \"refresh\", function(frm) {\nif (cur_frm.doc.__islocal == 1)\n{\nif (frappe.user_info().email == \"bangalore_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Bangalore Service Branch\";\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n} else if (frappe.user_info().email == \"kundapura_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Kundapur Service Branch\";\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"puttur_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Puttur Service Branch\";\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"hassan_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Hassan Service Branch\";\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"bellary_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Ballari Service Branch\";\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"shimoga_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Shivamogga Service Branch\";\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"chitradurga_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Chitradurga Service Branch\";\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"dharwad_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Dharwad Service Branch\";\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"vijayapura_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Vijayapura Service Branch\";\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"mysore_service_center@selco-india.com\")\n{\ncur_frm.doc.selco_branch = \"Mysore Service Branch\";\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}\n}\n})", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Sales Order", 
  "modified": "2017-11-07 15:25:01.711977", 
  "name": "Sales Order-Client", 
  "script": "/*To set naming series when branch is choosen for the first time */\ncur_frm.add_fetch(\"selco_branch\", \"sales_order_naming_series\", \"naming_series\"); \n\n/*To set naming series when the value in branch is changed*/\nfrappe.ui.form.on(\"Sales Order\", \"selco_branch\",\n    function(frm) {\ncur_frm.add_fetch(\"selco_branch\", \"sales_order_naming_series\", \"naming_series\");\n\nif ( cur_frm.doc.naming_series == null )\n{\nwindow.location.reload();\nmsgprint(\"Please set the correct naming series for the branch.\");\n       throw \"Not allowed\";\n}\n})", 
  "script_type": "Client"
 }
]