[
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Issue",
  "modified": "2020-09-25 15:33:57.683638",
  "name": "Issue-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "/*To set naming series when branch is choosen for the first time */\ncur_frm.add_fetch(\"selco_service_area\", \"selco_cse_service_area\", \"selco_service_area_name\");\n\n\n/*To set Branch eMail ID when branch is choosen for the first time */\ncur_frm.add_fetch(\"selco_branch\", \"selco_branch_email_id\", \"selco_branch_email_id\");\ncur_frm.add_fetch(\"selco_branch\", \"selco_service_branch_email_id\", \"selco_service_branch_email_id\");\ncur_frm.add_fetch(\"selco_branch\", \"selco_customer_complaint_naming_series\", \"naming_series\");\n\ncur_frm.add_fetch(\"selco_customer_id\", \"selco_customer_contact_number\", \"selco_customer_contact_number\");\ncur_frm.add_fetch(\"selco_customer_id\", \"customer_name\", \"selco_customer_full_name\");\n\n\n\ncur_frm.add_fetch(\"selco_customer_id\",\"selco_landline_mobile_2\",\"selco_customer_contact_number_landline\");\ncur_frm.add_fetch(\"selco_complaint_handled_by\", \"service_person_name\", \"selco_service_person_name\");\n\n/*To 'Make Fields Read Only' once the workflow state changes to anything other than 'Complaint Drafted'*/\nfrappe.ui.form.on(\"Issue\", \"refresh\",\n    function(frm) {\nif ( cur_frm.doc.workflow_state == \"Complaint Open\" || cur_frm.doc.workflow_state == \"Complaint Assigned To CSE\" || cur_frm.doc.workflow_state == \"Complaint Cancelled\" || cur_frm.doc.workflow_state == \"Complaint Attended By CSE - Still Open\" || cur_frm.doc.workflow_state == \"Complaint Escalated To SBM\" || cur_frm.doc.workflow_state == \"Complaint Closed By Branch\" || cur_frm.doc.workflow_state == \"Complaint Closed By CSD\" || cur_frm.doc.workflow_state == \"Warranty Claim Format Raised - WC\" || cur_frm.doc.workflow_state == \"Dispatch Pending From Godown\" || cur_frm.doc.workflow_state == \"Dispatched From Godown\")\n{\nfrm.set_df_property(\"selco_complaint_received_date\", \"read_only\",1);\nfrm.set_df_property(\"selco_branch\", \"read_only\",1);\nfrm.set_df_property(\"subject\", \"read_only\",1);\nfrm.set_df_property(\"selco_description_of_complaint\", \"read_only\",1);\nfrm.set_df_property(\"selco_customer_id\", \"read_only\",1);\nfrm.set_df_property(\"selco_customer_full_name\", \"read_only\",1);\n\nfrm.set_df_property(\"selco_customer_contact_number\", \"read_only\",1); frm.set_df_property(\"selco_customer_address\", \"read_only\",1);\nfrm.set_df_property(\"selco_complaint_priority\", \"read_only\",1);\nfrm.set_df_property(\"selco_warranty_applicable\", \"read_only\",1);\nfrm.set_df_property(\"selco_type_of_system\", \"read_only\",1);\nfrm.set_df_property(\"selco_capacity\", \"read_only\",1);\nfrm.set_df_property(\"selco_warranty_claim_number\", \"read_only\",1);\n}\n});\n\n/*To 'Make Fields Read Only' once the workflow state changes to 'closed by branch' or 'closed by CSD'*/\nfrappe.ui.form.on(\"Issue\", \"refresh\",\n    function(frm) {\nif ( cur_frm.doc.workflow_state == \"Complaint Closed By CSD\" || cur_frm.doc.workflow_state == \"Complaint Closed By Branch\" || cur_frm.doc.workflow_state == \"Dispatch Pending From Godown\")\n{\nfrm.set_df_property(\"selco_ics_number\", \"read_only\",1);\nfrm.set_df_property(\"selco_category_of_complaint\", \"read_only\",1);\nfrm.set_df_property(\"selco_faulty_complaint\", \"read_only\",1);\nfrm.set_df_property(\"selco_service_record_number\", \"read_only\",1);\nfrm.set_df_property(\"selco_branch_remarks\", \"read_only\",1);\nfrm.set_df_property(\"selco_sbm_name_if_involved\", \"read_only\",1);\nfrm.set_df_property(\"selco_component_charges\", \"read_only\",1);\n\nfrm.set_df_property(\"selco_ics_date\", \"read_only\",1);\nfrm.set_df_property(\"selco_complaint_handled_by\", \"read_only\",1);\nfrm.set_df_property(\"selco_faulty_component_vendor\", \"read_only\",1);\nfrm.set_df_property(\"selco_record_date\", \"read_only\",1);\nfrm.set_df_property(\"selco_service_charges_collected\", \"read_only\",1);\nfrm.set_df_property(\"selco_sbm_remarks\", \"read_only\",1);\n}\n})\n\nfrappe.ui.form.on(\"Issue\", \"selco_customer_id\", function(frm) {\n\tif (!frm.doc.selco_customer_id) { return 0; }\n    frappe.call({\n\t    method: \"frappe.contacts.doctype.address.address.get_default_address\",\n\t    args: {\n\t\t\tdoctype:\"Customer\",\n\t\t\tname: frm.doc.selco_customer_id\n\t\t}\n\t}).done(function(r){\n\t\tif(r.message) {\n       \t\tfrm.set_value(\"selco_customer_address\", r.message);\n        }\n\t}).error(function(err){\n\t\tfrappe.show_alert(__(\"Unable to load default address.\"));\n\t});\n});\n\n\nfrappe.ui.form.on(\"Issue\", \"selco_customer_address\", function(frm, cdt, cdn) {\n\tfrappe.call({\n\t\tmethod: \"frappe.contacts.doctype.address.address.get_address_display\",\n        args: {\n            \"address_dict\": frm.doc.selco_customer_address\n        },\n\t}).done(function(r){\n\t\tif(r.message) {\n       \t\tfrm.set_value(\"selco_detail_address\", r.message);\n        }\n\t}).error(function(err){\n\t\tfrappe.show_alert(__(\"Unable to load address display.\"));\n\t});\n});\n\n\nfrappe.ui.form.on(\"Issue\", \"refresh\", function (frm, cdt, cdn) {\n  cur_frm.set_query(\"selco_customer_id\", function () {\n    return {\n      query: \"erpnext.controllers.queries.customer_query\",\n      searchfield: \"selco_customer_contact_number\"\n    }\n  });\n});\n\nfrappe.ui.form.on(\"Issue\", \"refresh\",\n    function(frm) {\nif ( cur_frm.doc.workflow_state == \"Complaint Closed By CSD\" || cur_frm.doc.workflow_state == \"Complaint Rejected By CSD\" )\n{\nfrm.set_df_property(\"selco_remarks\", \"read_only\",1);\nfrm.set_df_property(\"selco_special_budget\", \"read_only\",1);\n}\n})\n\n\nfrappe.ui.form.on(\"Issue\", \"validate\", function(frm, cdt, cdn) {\ncur_frm.doc.selco_sms_number = cur_frm.doc.selco_customer_contact_number + \"@sms.textlocal.in\";console.log(cur_frm.doc.selco_sms_number);\n})\n\nfrappe.ui.form.on(\"Issue\", \"validate\",\n    function(frm) {\nif ( cur_frm.doc.workflow_state == \"Complaint Closed By Branch\" )\n{\ncur_frm.doc.selco_sms_counter_1 = cur_frm.doc.selco_sms_counter_1 +1 ;\n}\n})\n\n\n\n\nfrappe.ui.form.on(\"Issue\", \"refresh\", function(frm) {\n   {\nvar workflow_states = ['Complaint Open','Complaint Assigned To CSE','Complaint Escalated To SBM','Complaint Attended By CSE - Still Open']\nif (workflow_states.indexOf(cur_frm.doc.workflow_state) != -1)\n{\n      cur_frm.add_custom_button(__(\"Raise Warranty Claim\"),\n        cur_frm.cscript.raise_Warranty_Claim);\n    }\n}\n})\n\ncur_frm.cscript.raise_Warranty_Claim = function()\n{\nfrappe.route_options = {\n\"selco_complaint_number\": cur_frm.doc.name\n};\nfrappe.new_doc(\"Warranty Claim\");\n}\n\nfrappe.ui.form.on(\"Issue\", \"refresh\", function(frm) {\ncur_frm.fields_dict.selco_customer_id.new_doc = quick_entry_customer;\n//cur_frm.fields_dict.selco_customer_address.new_doc = quick_entry_address;\n})\nvar quick_entry_address = function(){\nconsole.log(\"Overrided\");\n    frappe._from_link = this;\n    quick_entry(\"Address\",\n    function(){},\n    {\n        \"address_type\": \"Billing\",\n                \"selco_branch\": cur_frm.doc.selco_branch,\n                \"selco_customer_id\": cur_frm.doc.selco_customer_id,\n                \"country\" : \"India\",\n                \n    });\n}\n\nvar quick_entry_customer = function(){\n    frappe._from_link = this;\n    frappe.db.get_value(\"Branch\", cur_frm.doc.selco_branch, \"selco_customer_naming_series\", function(r) {\n    \tquick_entry(\"Customer\",\n\t    function(){},\n\t\t    {\n\t\t        \"selco_branch\": cur_frm.doc.selco_branch,\n\t\t        \"naming_series\": r.selco_customer_naming_series \n\t\t    }\n\t    );\n    });\n}\n\n\nvar quick_entry = function(doctype, success, fields_map={}) {\n\tfrappe.model.with_doctype(doctype, function() {\n\t\tvar mandatory = [];\n\n\t\tif (!fields_map == {}) {\n\t\t\t$.each(fields_map, function(k,v) {\n\t\t\t\tdoc_field = frappe.meta.get_docfield(doctype, k)\n\t\t\t\tmandatory.push(doc_field);\n\t\t\t});\n\t\t} else {\n\t\t\tmandatory = $.map(frappe.get_meta(doctype).fields,\n\t\t\tfunction(d) { return (d.reqd || d.bold && !d.read_only) ? d : null });\n\t\t}\n\n\t\tvar meta = frappe.get_meta(doctype);\n\t\tvar doc = frappe.model.get_new_doc(doctype, null, null, true);\n\n\t\t/*if(meta.quick_entry != 1) {\n\t\t\tvar d = frappe.model.make_new_doc_and_get_name(doctype);\n\t\t\td = locals[doctype][d];\n\t\t\t$.each(fields_map, function(fieldname, fieldvalue) {\n\t\t\t\td[fieldname] = fieldvalue;\n\t\t\t});\n\t\t\tfrappe.set_route('Form', doctype, d.name);\n\t\t\treturn;\n\t\t}*/\n\n\t\tvar dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"New {0}\", [doctype]),\n\t\t\tfields: mandatory,\n\t\t});\n\n\t\tvar update_doc = function() {\n\t\t\tvar data = dialog.get_values(true);\n\t\t\t$.each(data, function(key, value) {\n\t\t\t\tif(key==='__name') {\n\t\t\t\t\tdialog.doc.name = value;\n\t\t\t\t} else {\n\t\t\t\t\tif(!is_null(value)) {\n\t\t\t\t\t\tdialog.doc[key] = value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn dialog.doc;\n\t\t}\n\n\t\tvar open_doc = function() {\n\t\t\tdialog.hide();\n\t\t\tupdate_doc();\n\t\t\tfrappe.set_route('Form', doctype, doc.name);\n\t\t}\n\n\t\tdialog.doc = doc;\n\n\t\t// refresh dependencies etc\n\t\tdialog.refresh();\n\n\t\tdialog.set_primary_action(__('Save'), function() {\n\t\t\tif(dialog.working) return;\n\t\t\tvar data = dialog.get_values();\n\n\t\t\tif(data) {\n\t\t\t\tdialog.working = true;\n\t\t\t\tvalues = update_doc();\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"frappe.client.insert\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoc: values\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tdialog.hide();\n\t\t\t\t\t\t// delete the old doc\n\t\t\t\t\t\tfrappe.model.clear_doc(dialog.doc.doctype, dialog.doc.name);\n\t\t\t\t\t\tvar doc = r.message;\n\t\t\t\t\t\tif(success) {\n\t\t\t\t\t\t\tsuccess(doc);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfrappe.ui.form.update_calling_link(doc.name);\n\t\t\t\t\t},\n\t\t\t\t\terror: function() {\n\t\t\t\t\t\topen_doc();\n\t\t\t\t\t},\n\t\t\t\t\talways: function() {\n\t\t\t\t\t\tdialog.working = false;\n\t\t\t\t\t},\n\t\t\t\t\tfreeze: true\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tvar $link = $('<div class=\"text-muted small\" style=\"padding-left: 10px; padding-top: 15px;\">\\\n\t\t\tCtrl+enter to save | <a class=\"edit-full\">Edit in full page</a></div>').appendTo(dialog.body);\n\n\t\t$link.find('.edit-full').on('click', function() {\n\t\t\t// edit in form\n\t\t\topen_doc();\n\t\t});\n\n\t\t// ctrl+enter to save\n\t\tdialog.wrapper.keydown(function(e) {\n\t\t\tif((e.ctrlKey || e.metaKey) && e.which==13) {\n\t\t\t\tif(!frappe.request.ajax_count) {\n\t\t\t\t\t// not already working -- double entry\n\t\t\t\t\tdialog.get_primary_btn().trigger(\"click\");\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tdialog.show();\n\n\t\t//Set value and visibility if field map exists.\n\t\tif (fields_map != {}) {\n\t\t\t$.each(dialog.fields_dict, function(fieldname, field) {\n\t\t\t\tfield.set_input(fields_map[fieldname]);\n\t\t\t});\n\t\t} else {\n\t\t\t// set defaults\n\t\t\t$.each(dialog.fields_dict, function(fieldname, field) {\n\t\t\t\tfield.doctype = doc.doctype;\n\t\t\t\tfield.docname = doc.name;\n\t\t\t\tif(!is_null(doc[fieldname])) {\n\t\t\t\t\tfield.set_input(doc[fieldname]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n}\n\n\nfrappe.ui.form.on(\"Issue\", \"refresh\",\n    function(frm) {\n\n\tcur_frm.set_query(\"service_person\", \"selco_service_record\", function(doc, cdt, cdn) {\n\t\tvar d = locals[cdt][cdn];\n\t\treturn{\n\t\t\tfilters: [\n\t\t\t\t['Service Person', 'disabled', 'in', '0'],\n\t\t\t]\n\t\t}\n\t});\n\n});\n\n//Added on 22-09-2020 by Poorvi\n\nfrappe.ui.form.on(\"Issue\", \"refresh\", function(frm) {\n   {\nvar workflow_states = ['Complaint Assigned To CSE']\nif (workflow_states.indexOf(cur_frm.doc.workflow_state) != -1)\n{\n      cur_frm.add_custom_button(__(\"Create Service Record\"),\n        cur_frm.cscript.raise_Service_Record);\n    }\n}\n})\n\ncur_frm.cscript.raise_Service_Record = function()\n{\nfrappe.route_options = {\n\"selco_complaint_number\": cur_frm.doc.name\n};\nfrappe.new_doc(\"Service Record\");\n}\n\n\n\n\n\n\n"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Payment Entry",
  "modified": "2020-10-03 11:41:59.835023",
  "name": "Payment Entry-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "//cur_frm.add_fetch(\"party\", \"customer_name\", \"party_name\"); \n\n\nfrappe.ui.form.on(\"Payment Entry\", \"selco_financing_institution\", function(frm) {\n    cur_frm.set_query(\"selco_financing_institution_branch\", function() {\n        return {\n            \"filters\": {\n                \"financing_institution\": frm.doc.selco_financing_institution\n            }\n        };\n    });\n});\n\n\nfrappe.ui.form.on(\"Payment Entry\", \"refresh\", function(frm) {\n    if (frm.doc.payment_type == \"Pay\") {\n        frm.set_df_property(\"selco_financed\", \"hidden\", 1);\n        frm.set_df_property(\"selco_financed\", \"reqd\", 0);\n        frm.set_df_property(\"selco_money_received_by\", \"hidden\", 1);\n        frm.set_df_property(\"selco_o_a_no\", \"hidden\", 1);\n        //frm.set_df_property(\"selco_o_a_date\", \"hidden\", 1);\n        frm.set_df_property(\"paid_amount\", \"label\", \"Paid Amount\");\n    } else {\n        frm.set_df_property(\"selco_financed\", \"hidden\", 0);\n        frm.set_df_property(\"selco_financed\", \"reqd\", 1);\n        frm.set_df_property(\"selco_money_received_by\", \"reqd\", 1);\n        frm.set_df_property(\"selco_o_a_no\", \"hidden\", 0);\n        //frm.set_df_property(\"selco_o_a_date\", \"hidden\", 0);\n        frm.set_df_property(\"paid_amount\", \"label\", \"Received Amount\");\n    }\n\n//cur_frm.doc.mode_of_payment = \"Bank\";\n\n    cur_frm.set_query(\"mode_of_payment\", function() {\n        return {\n            filters: [\n                ['Mode of Payment', 'mode_of_payment', 'in', 'Bank,Cash']\n            ]\n        };\n    });\n    cur_frm.fields_dict['references'].grid.get_field('reference_name').get_query = function(doc) {\n        if ( cur_frm.doc.payment_type == \"Receive\") {\n            return {\n                \"filters\": {    \n                    \"customer\": cur_frm.doc.party\n                }\n            };\n        }\n\n        if ( cur_frm.doc.payment_type == \"Pay\") {\n            return {\n                \"filters\": {\n                    \"supplier\": cur_frm.doc.party\n                }   \n            };\n        }\n    };\n    cur_frm.fields_dict['references'].grid.get_field('reference_doctype').get_query = function(doc) {\n        if ( cur_frm.doc.payment_type == \"Receive\") {\n            return {\n                \"filters\": {\n                    \"name\": \"Sales Invoice\"\n                }\n            };\n        }\n\n        if ( cur_frm.doc.payment_type == \"Pay\") {\n            return {\n                \"filters\": {\n                    \"name\": \"Purchase Invoice\"\n                }\n            };\n        }\n    };\n    if (cur_frm.doc.__islocal == 1) {\n        if (frappe.user_info().email == \"bangalore_service_center@selco-india.com\") {\n            cur_frm.set_value(\"selco_branch\", \"Bangalore Service Branch\");\n            //cur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n        } else if (frappe.user_info().email == \"kundapura_service_center@selco-india.com\") {\n            cur_frm.set_value(\"selco_branch\", \"Kundapur Service Branch\");\n            //cur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n        } else if (frappe.user_info().email == \"hassan_service_center@selco-india.com\") {\n            cur_frm.set_value(\"selco_branch\", \"Hassan Service Branch\");\n            //cur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n        } else if (frappe.user_info().email == \"bellary_service_center@selco-india.com\") {\n            cur_frm.set_value(\"selco_branch\", \"Bellary Service Branch\");\n            //cur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n        } else if (frappe.user_info().email == \"chitradurga_service_center@selco-india.com\") {\n            cur_frm.set_value(\"selco_branch\", \"Chitradurga Service Branch\");\n            //cur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n        } else if (frappe.user_info().email == \"dharwad_service_center@selco-india.com\") {\n            cur_frm.set_value(\"selco_branch\", \"Dharwad Service Branch\");\n            //cur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n        } else if (frappe.user_info().email == \"mysore_service_center@selco-india.com\") {\n            cur_frm.set_value(\"selco_branch\", \"Mysore Service Branch\");\n            //cur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n        } else if (frappe.user_info().email == \"puttur_service_center@selco-india.com\") {\n            cur_frm.set_value(\"selco_branch\", \"Puttur Service Branch\");\n            //cur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n        } else if (frappe.user_info().email == \"vijayapura_service_center@selco-india.com\") {\n            cur_frm.set_value(\"selco_branch\", \"Vijayapura Service Branch\");\n            //cur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n        } else if (frappe.user_info().email == \"shimoga_service_center@selco-india.com\") {\n            cur_frm.set_value(\"selco_branch\", \"Shivamogga Service Branch\");\n            //cur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n        } else if (frappe.user_info().email == \"kalaburagi_service_center@selco-india.com\") {\n            cur_frm.set_value(\"selco_branch\", \"Kalaburagi Service Branch\");\n            //cur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n        } \n    }\n    \n});\n\n\nfrappe.ui.form.on(\"Payment Entry\", \"selco_money_received_by\", function(frm, cdt, cdn) {\n    frm.set_value(\"paid_from_account_currency\", frappe.defaults.get_default(\"currency\"));\n    frm.set_value(\"paid_to_account_currency\", frappe.defaults.get_default(\"currency\"));\n\n    if (cur_frm.doc.selco_money_received_by == \"Cash\") {\n\n        //cur_frm.set_value(\"mode_of_payment\", \"Cash\");\n\n        cur_frm.set_value(\"selco_money_received_by\", \"Cash\");\n        cur_frm.set_value(\"selco_financed\", \"NO\");\n        cur_frm.set_value(\"reference_no\", \"Cash\");\n        cur_frm.set_value(\"reference_date\",cur_frm.doc.posting_date);\n        cur_frm.set_df_property(\"reference_no\", \"read_only\", true);\n\n        cur_frm.set_df_property(\"reference_no\", \"hidden\", 1);\n        cur_frm.set_df_property(\"reference_no\", \"reqd\", 0);\n        cur_frm.set_df_property(\"reference_date\", \"hidden\", 0);\n        cur_frm.set_df_property(\"reference_date\", \"reqd\", 0);\n        cur_frm.set_df_property(\"selco_cheque_issuing_bank\", \"read_only\", 1);\n        cur_frm.set_df_property(\"selco_cheque_issuing_bank\", \"reqd\", 0);\n\tfrm.set_df_property(\"transaction_references\", \"hidden\", 0);\n        var d = locals[cdt][cdn];\n        frappe.call({\n            \"method\": \"frappe.client.get\",\n            args: {\n                doctype: \"Branch\",\n                name: d.selco_branch\n            },\n            callback: function (data) {\n                frappe.model.set_value(d.doctype, d.name, \"paid_to\", data.message.selco_collection_account_cash);\n            }\n        });\n\n        // cur_frm.set_df_property(\"reference_no\", \"hidden\", true);\n        // cur_frm.set_df_property(\"selco_cheque_issuing_bank\", \"read_only\", true);\n        // cur_frm.set_df_property(\"selco_cheque_issuing_bank\", \"reqd\", false);\n        \n    }\n\n    if (cur_frm.doc.selco_money_received_by == \"Cheque/DD\" || cur_frm.doc.selco_money_received_by == \"Online-NEFT/RTGS\" ) {\n        cur_frm.set_value(\"reference_date\", undefined);\n        //cur_frm.set_value(\"accounting_currency\", \"INR\");\n        //cur_frm.set_value(\"mode_of_payment\", \"Bank\");\n        cur_frm.set_df_property(\"reference_no\", \"hidden\", 0);\n        cur_frm.set_df_property(\"reference_no\", \"reqd\", 1);\n        cur_frm.set_df_property(\"reference_no\", \"read_only\", false);\n        cur_frm.set_value(\"reference_no\", undefined);\n\n\tfrm.set_df_property(\"transaction_references\", \"hidden\", 0);\n        cur_frm.set_df_property(\"reference_date\", \"hidden\", 0);\n        cur_frm.set_df_property(\"reference_date\", \"reqd\", 1);\n        cur_frm.set_df_property(\"selco_cheque_issuing_bank\", \"read_only\", 0);\n        cur_frm.set_df_property(\"selco_cheque_issuing_bank\", \"reqd\", 1);\n\n        var d = locals[cdt][cdn];\n        frappe.call({\n            \"method\": \"frappe.client.get\",\n            args: {\n                doctype: \"Branch\",\n                name: d.selco_branch\n            },\n            callback: function (data) {\n                frappe.model.set_value(d.doctype, d.name, \"paid_to\", data.message.selco_collection_account);\n            }\n        });\n\n        // cur_frm.set_df_property(\"reference_no\", \"hidden\", false);\n        // cur_frm.set_df_property(\"reference_date\", \"hidden\", false);\n        // cur_frm.set_df_property(\"selco_cheque_issuing_bank\", \"read_only\", false);\n        // cur_frm.set_df_property(\"selco_cheque_issuing_bank\", \"reqd\", true);\n\n    }\n});\n\nfrappe.ui.form.on(\"Payment Entry\", \"selco_financed\", function(frm, cdt, cdn) {\n    if (cur_frm.doc.selco_financed == \"YES\") {\n        cur_frm.set_df_property(\"selco_financing_institution\", \"read_only\", false);\n        cur_frm.set_df_property(\"selco_financing_institution_branch\", \"read_only\", false);\n        cur_frm.set_df_property(\"selco_financing_institution\", \"reqd\", true);\n        cur_frm.set_df_property(\"selco_financing_institution_branch\", \"reqd\", true);\n    }else {\n        cur_frm.set_df_property(\"selco_financing_institution\", \"read_only\", true);\n        cur_frm.set_df_property(\"selco_financing_institution_branch\", \"read_only\", true);\n        cur_frm.set_df_property(\"selco_financing_institution\", \"reqd\", false);\n        cur_frm.set_df_property(\"selco_financing_institution_branch\", \"reqd\", false);\n    }\n    cur_frm.refresh_field(\"selco_financing_institution\");\n});\n\n//  frappe.ui.form.on(\"Payment Entry\", \"refresh\", function(frm) {\n// if (cur_frm.doc.__islocal == 1)\n//  {\n//  if (frappe.user_info().email == \"bangalore_service_center@selco-india.com\")\n//  {\n//  cur_frm.set_value(\"selco_branch\", \"Bangalore Service Branch\");\n//  cur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n//  } else if (frappe.user_info().email == \"kundapura_service_center@selco-india.com\")\n//  {\n//  cur_frm.set_value(\"selco_branch\", \"Kundapur Service Branch\");\n//  cur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n//  }else if (frappe.user_info().email == \"puttur_service_center@selco-india.com\")\n//  {\n//  cur_frm.set_value(\"selco_branch\", \"Puttur Service Branch\");\n//  cur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n//  }else if (frappe.user_info().email == \"hassan_service_center@selco-india.com\")\n//  {\n//  cur_frm.set_value(\"selco_branch\", \"Hassan Service Branch\");\n//  cur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n//  }else if (frappe.user_info().email == \"bellary_service_center@selco-india.com\")\n//  {\n//  cur_frm.set_value(\"selco_branch\", \"Ballari Service Branch\");\n//  cur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n//  }else if (frappe.user_info().email == \"shimoga_service_center@selco-india.com\")\n//  {\n//  cur_frm.set_value(\"selco_branch\", \"Shivamogga Service Branch\");\n//  cur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n//  }else if (frappe.user_info().email == \"chitradurga_service_center@selco-india.com\")\n//  {\n//  cur_frm.set_value(\"selco_branch\", \"Chitradurga Service Branch\");\n//  cur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n//  }else if (frappe.user_info().email == \"dharwad_service_center@selco-india.com\")\n//  {\n//  cur_frm.set_value(\"selco_branch\", \"Dharwad Service Branch\");\n//  cur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n//  }else if (frappe.user_info().email == \"vijayapura_service_center@selco-india.com\")\n//  {\n//  cur_frm.set_value(\"selco_branch\", \"Vijayapura Service Branch\");\n//  cur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n//  }else if (frappe.user_info().email == \"mysore_service_center@selco-india.com\")\n//  {\n//  cur_frm.set_value(\"selco_branch\", \"Mysore Service Branch\");\n//  cur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n//  }\n//  }\n//  })\n\n\nfrappe.ui.form.on(\"Payment Entry\", \"refresh\", function(frm) {\ncur_frm.set_query(\"selco_cheque_issuing_bank\", function() {\n    return {\n        filters: [\n            ['Financing Institution', 'name', '!=', 'SKDRDP']\n        ]\n    };\n});\n});\n\n\nfrappe.ui.form.on(\"Payment Entry\", \"payment_type\", function(frm) {\n    if (frm.doc.payment_type == \"Receive\"){\n        frm.set_df_property(\"selco_money_received_by\", \"hidden\", 0);\n        frm.set_df_property(\"selco_financed\", \"hidden\", 0);\n        frm.set_df_property(\"selco_financed\", \"reqd\", 1);\n        frm.set_df_property(\"selco_money_received_by\", \"reqd\", 1);\n        frm.set_df_property(\"selco_o_a_no\", \"hidden\", 0);\n        frm.set_df_property(\"selco_o_a_date\", \"hidden\", 0);\n        frm.set_df_property(\"paid_amount\", \"label\", \"Received Amount\");\n    } else {\n        frm.set_df_property(\"selco_financed\", \"hidden\", 1);\n        frm.set_df_property(\"selco_financed\", \"reqd\", 0);\n        frm.set_df_property(\"selco_money_received_by\", \"reqd\", 0);\n        frm.set_df_property(\"selco_money_received_by\", \"hidden\", 1);\n        frm.set_df_property(\"selco_o_a_no\", \"hidden\", 1);\n        frm.set_df_property(\"selco_o_a_date\", \"hidden\", 1);\n        frm.set_df_property(\"paid_amount\", \"label\", \"Paid Amount\");\n    }\n});\n\n\n\n\nfrappe.ui.form.on('Payment Entry', 'validate', function(frm) \n {\nif (cur_frm.doc.selco_money_received_by == \"Cheque/DD\" || cur_frm.doc.selco_money_received_by == \"Online-NEFT/RTGS\" ) {\n\n    if (frappe.datetime.str_to_obj(frm.doc.posting_date) < frappe.datetime.str_to_obj(frm.doc.reference_date)) \n   {\n        frappe.throw('Reference Date cannot be after Posting Date');\n        validated = false;\n    } \n }});\n\n\n\n\nfrappe.ui.form.on(\"Payment Entry\", { \n\tvalidate: function(frm) {\n\t\tif (!frm.is_new() && frm.doc.posting_date < frappe.datetime.add_days(frappe.datetime.nowdate(), -1192) && frm.doc.posting_date < frappe.datetime.add_days(frappe.datetime.nowdate(), -475) ) {\n\t\t\tfrappe.throw(\"User don't have permission to submit the back dated sales invoice, please contact to administrator\")\n\t\treturn false;\t\t\n\t\t}\n\t\telse if (!frm.is_new() && frm.doc.posting_date < frappe.datetime.add_days(frappe.datetime.nowdate(),-156) && frappe.user.has_role(['SELCO Lead Accountant']) ) {\n\t\t\tfrappe.throw(\"User don't have permission to submit the back dated Payment Entry, please contact Administrator\")\n\t\treturn false;\t\n\t\t\t\n\t\t\t\n\t\t}\n\n\t}\n})\n\n\n\nfrappe.ui.form.on(\"Payment Entry\", \"selco_financing_institution\", function(frm, cdt, cdn) {\n      \n    if (cur_frm.doc.selco_financing_institution == \"SKDRDP\")\n        {\n         cur_frm.set_df_property(\"selco_group_id\", \"reqd\", true);\n         cur_frm.set_df_property(\"selco_member_id\", \"reqd\", true);\n         cur_frm.set_df_property(\"selco_circle_name\", \"reqd\", true);\n         cur_frm.set_df_property(\"selco_seva_pratinidhi_area\", \"reqd\", true);\n         cur_frm.set_df_property(\"selco_unique_id\", \"reqd\", true);\n\n         \n        }\n        \n        else\n        {\n            cur_frm.set_df_property(\"selco_group_id\", \"reqd\", false);\n            cur_frm.set_df_property(\"selco_member_id\", \"reqd\", false);\n            cur_frm.set_df_property(\"selco_circle_name\", \"reqd\", false);\n            cur_frm.set_df_property(\"selco_seva_pratinidhi_area\", \"reqd\", false);\n             cur_frm.set_df_property(\"selco_unique_id\", \"reqd\", false);\n\n            \n        }\n\n        cur_frm.refresh_field(\"selco_financing_institution\");\n});\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Stock Entry",
  "modified": "2020-10-10 17:58:39.174248",
  "name": "Stock Entry-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "cur_frm.add_fetch(\"selco_branch\", \"selco_branch_email_id\", \"selco_branch_email_id\");\ncur_frm.add_fetch(\"item_code\", \"gst_hsn_code\", \"hsn_code\");\n\nfrappe.ui.form.on(\"Stock Entry\", \"refresh\", async function(frm) {\n\tif (cur_frm.doc.__islocal == 1) {\n\t\tif (frappe.user_info().email == \"southgodown@selco-india.com\") {\n\t\t\tawait cur_frm.set_value(\"selco_branch\", \"Manipal Godown\");\n\t\t\tcur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n\t\t} else if (frappe.user_info().email == \"northgodown@selco-india.com\") {\n\t\t\tawait cur_frm.set_value(\"selco_branch\", \"Dharwad Godown\"); \n\t\t\tcur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n\t\t} else if (frappe.user_info().email == \"bangalore_godown@selco-india.com\") {\n\t\t\tawait cur_frm.set_value(\"selco_branch\", \"Bangalore Godown\");\n\t\t\tcur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n\t\t}\n\t}\n\n\tcur_frm.set_query(\"selco_supplier_or_customer\", function() {\n\t\treturn {\n\t\t\t\"filters\": {\n\t\t\t\t\"name\":[\"in\", [\"Customer\", \"Supplier\"]]\n\t\t\t}\n\t\t};\n\t});\n\n\ttoggle_custom_buttons(frm);\n\n});\n\n\n\nfrappe.ui.form.on(\"Stock Entry\", \"selco_supplier_or_customer\", function(frm) {\nif ((cur_frm.doc.selco_supplier_or_customer == \"Customer\")\n&& (cur_frm.doc.stock_entry_type==\"Rejection In\"))\n{\ncur_frm.set_df_property(\"items\", \"read_only\", false);\n}\nelse if ((cur_frm.doc.selco_supplier_or_customer == \"Customer\")\n&& (cur_frm.doc.stock_entry_type==\"Rejection Out\"))\n{\ncur_frm.set_df_property(\"items\", \"read_only\", false);\n}\nelse if ((cur_frm.doc.selco_supplier_or_customer == \"Supplier\") && (cur_frm.doc.stock_entry_type==\"Rejection In\"))\n{\ncur_frm.set_df_property(\"rejection_out_id\", \"reqd\", true);\ncur_frm.set_df_property(\"items\", \"read_only\", false);\n}\nelse if ((cur_frm.doc.selco_supplier_or_customer == \"Supplier\") && (cur_frm.doc.stock_entry_type==\"Rejection Out\"))\n{\ncur_frm.set_df_property(\"items\", \"read_only\", false);\n}\n\n})\n\n\t\nfrappe.ui.form.on('Stock Entry', 'selco_supplier_or_customer_id', function(frm, cdt, cdn) {\n\t\t var d = frappe.model.get_doc(cdt, cdn);\n\t\t frappe.call({\n\t\t\t\tmethod: \"frappe.client.get_value\",\nargs: {\ndoctype: d.selco_supplier_or_customer,\nfieldname: d.selco_supplier_or_customer=='Customer' ? 'customer_name' : 'supplier_name',\nfilters: { name: d.selco_supplier_or_customer_id },\n},\ncallback: function(r, rt) {\nif(r.message) {\nif (d.selco_supplier_or_customer == \"Customer\")\n{\nfrappe.model.set_value(d.doctype, d.name, 'selco_supplier_or_customer_name', r.message.customer_name);\n}\nelse if (d.selco_supplier_or_customer == \"Supplier\")\n{\nfrappe.model.set_value(d.doctype, d.name, 'selco_supplier_or_customer_name', r.message.supplier_name);\n}\nconsole.log(\"callback executed!!\");\n}\n}\n\t\t})\n})\n\n \n\nfrappe.ui.form.on(\"Stock Entry\", \"selco_inward_or_outward\", function(frm, cdt, cdn) {\nif (cur_frm.doc.selco_inward_or_outward == \"Inward\")\n{\ncur_frm.clear_table(\"items\");\ncur_frm.set_df_property(\"items\", \"read_only\", true);\n} else\n{\ncur_frm.set_df_property(\"items\", \"read_only\", false);\n}\n})\n\nfrappe.ui.form.on(\"Stock Entry\", \"purpose\", function(frm) {\nif(cur_frm.doc.purpose==\"Material Issue\")\n{\n\ncur_frm.clear_table(\"items\");\n//cur_frm.set_df_property(\"items\", \"read_only\", true);\n\n\t\tcur_frm.set_query(\"selco_rejection_in_id\", function() {\n\t\t\t\treturn {\n\t\t\t\t\t\t\"filters\": {\n\t\t\t\t\t\t\t\t\"supplier_or_customer_id\": frm.doc.selco_supplier_or_customer_id,\n\t\t\t\t\t\t\t\t\"purpose\": \"Material Receipt\",\n\t\t\t\t\t\t\t\t\"docstatus\":1\n\t\t\t\t\t\t}\n\t\t\t\t};\n\t\t});\n}\n});\n\nfrappe.ui.form.on(\"Stock Entry\", \"purpose\", function(frm, cdt, cdn) {\nrefresh_field(\"selco_type_of_material\");\nif (cur_frm.doc.purpose == \"Repack\")\n{\ncur_frm.doc.selco_type_of_material = \"Good Stock\";\ncur_frm.doc.selco_inward_or_outward = \"\";\ncur_frm.set_df_property(\"selco_type_of_material\", \"read_only\", true);\n} else if ( (cur_frm.doc.stock_entry_type == \"Rejection In\"))\n{\ncur_frm.doc.selco_type_of_material = \"Repair Stock\";\ncur_frm.set_df_property(\"selco_type_of_material\", \"read_only\", true);\ncur_frm.set_df_property(\"selco_supplier_or_customer\", \"reqd\", true);\ncur_frm.set_df_property(\"selco_supplier_or_customer_id\", \"reqd\", true);\n} else if(cur_frm.doc.stock_entry_type == \"Rejection Out\")\n{\ncur_frm.doc.selco_type_of_material = \"Repair Stock\";\ncur_frm.set_df_property(\"selco_type_of_material\", \"read_only\", true);\ncur_frm.set_df_property(\"selco_supplier_or_customer\", \"reqd\", true);\ncur_frm.set_df_property(\"selco_supplier_or_customer_id\", \"reqd\", true);\n} \nelse if (in_list([\"Material Transfer\", \"Material Issue\", \"Material Receipt\"], cur_frm.doc.purpose))\n{\ncur_frm.set_df_property(\"selco_type_of_material\", \"read_only\", false);\nrefresh_field(\"selco_type_of_material\");\n}\n})\n\nfrappe.ui.form.on(\"Stock Entry\", \"to_warehouse\", function(frm, cdt, cdn) {console.log('p');\n\tvar d = locals[cdt][cdn];\n\tfrappe.call({\n\t\t\"method\": \"frappe.client.get\",\n\t\targs: {\n\t\t\tdoctype: \"Warehouse\",\n\t\t\tname: d.to_warehouse\n\t\t},\n\t\tcallback: function (data) { console.log('p');\n\t\t\tfrappe.model.set_value(d.doctype, d.name, \"selco_recipient_address_link\",data.message.address);\n\n\t\t}\n\t})\n})\n\nfrappe.ui.form.on(\"Stock Entry\", \"selco_recipient_address_link\", function(frm, cdt, cdn) {\n\treturn frm.call({\n\t\t\tmethod: \"frappe.contacts.doctype.address.address.get_address_display\",\n\t\t\targs: {\n\t\t\t\t\t\"address_dict\": frm.doc.selco_recipient_address_link\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.message) {\n\t\t\t\t frappe.model.set_value(cdt,cdn,\"selco_recipient_address\", r.message);\n\t\t\t\t}\n\t\t\t}\n\t});\n});\n\n\n\n\nfrappe.ui.form.on(\"Stock Entry\", \"selco_get_items_from_supplier_reference\", function(frm,cdt,cdn) {\nconsole.log(\"Button Clicked\");\ncur_frm.set_df_property(\"items\", \"read_only\", true);\n\t\t\tfrappe.call({           \"method\":\"selco.selco.selco_customizations.get_items_from_outward_stock_entry\",\n\t\t\targs:{ selco_doc_num : cur_frm.doc.selco_suppliers_ref,selco_branch : cur_frm.doc.selco_branch},\n\t\t\t\tcallback: function (data) {\ncur_frm.doc.from_warehouse = data.message.from_warehouse;\ncur_frm.doc.to_warehouse = data.message.to_warehouse;\ncur_frm.clear_table(\"items\");\nfor (var i = 0; i < data.message.dc.items.length; i++) { \nvar newrow = frappe.model.add_child(cur_frm.doc,\"Stock Entry Detail\", \"items\");\nnewrow.item_code = data.message.dc.items[i].item_code;\nnewrow.item_name = data.message.dc.items[i].item_name;\nnewrow.qty = data.message.dc.items[i].qty;\nnewrow.uom = data.message.dc.items[i].uom;\nnewrow.transfer_qty = data.message.dc.items[i].transfer_qty;\nnewrow.conversion_factor = data.message.dc.items[i].conversion_factor;\nrefresh_field(\"items\");\nrefresh_field(\"from_warehouse\");\nrefresh_field(\"to_warehouse\");\n\n}\n}\n})\n});\n\n\n\n\n\n cur_frm.cscript.get_items_from_ibm1 = function()\n{\n\tvar d = new frappe.ui.Dialog({\n\t\ttitle: __(\"Get Items from IBM\"),\n\t\tfields: [\n\t\t\t{\"fieldname\":\"ibm\", \"fieldtype\":\"Link\", \"label\":__(\"IBM\"),\n\t\t\t\toptions:\"Material Request\", reqd: 1, get_query: function(){\n\t\t\t\t\t//return {filters: { workflow_state:\"Approved - IBM\",branch:cur_frm.doc.branch}}\n\t\t\t\t\t//return {filters: { workflow_state:[\"in\", [\"Approved - IBM\", \"Partially Dispatched From Godown - IBM\"]] ,selco_branch:cur_frm.doc.selco_branch}}\n\t\t\t\t\treturn {filters: {selco_branch:cur_frm.doc.selco_being_dispatched_to}}\n\t\t\t\t}},\n\t\t\t{fieldname:\"fetch\", \"label\":__(\"Get Items from IBM\"), \"fieldtype\":\"Button\"}\n\t\t]\n\t});\n\td.get_input(\"fetch\").on(\"click\", function() {\n\t\tvar values = d.get_values();\n\t\tif(!values) return;\n\t\tfrappe.call({\n\t\t\t\"method\": \"frappe.client.get\",\n\t\t\targs: {\n\t\t\t\tdoctype: \"Material Request\",\n\t\t\t\tname:values.ibm\n\t\t\t},\n\t\t\tcallback: function (data) {\n\t\t\t\tif (data.message) {\n\t\t\t\tfor (var i=0;i<data.message.items.length;i++)\n\t\t\t\t{\n\t\t\t\tvar newrow = cur_frm.add_child(\"items\");\n\t\t\t\tnewrow.item_code=data.message.items[i].item_code;\n\t\t\t\tnewrow.item_name=data.message.items[i].item_name;\n\t\t\t\tnewrow.qty=data.message.items[i].qty;\n\t\t\t\tnewrow.transfer_qty=data.message.items[i].qty;\n\t\t\t\tnewrow.uom=data.message.items[i].uom;\n\t\t\t\tnewrow.stock_uom=data.message.items[i].uom;\n\t\t\t\tnewrow.conversion_factor=1;\n\t\t\t\t}\n\t\t\t\t}\n\t\t\t\trefresh_field(\"items\");\n\t\t\t\td.hide();\n\t\t}\n\t\t})\n\n\t});\n\td.show();\n}\n\nfrappe.ui.form.on(\"Stock Entry\", \"selco_supplier_or_customer\", function(frm) {\n\t\tif (cur_frm.doc.selco_type_of_stock_entry == \"Rejection In\" && cur_frm.doc.selco_supplier_or_customer == \"Supplier\") {\n\t\t\t\tcur_frm.add_custom_button(__(\"Get Items From Rejection Out\"), cur_frm.cscript.get_items_from_rejection_out);\n\t\t} else if (cur_frm.doc.selco_type_of_stock_entry == \"Rejection Out\" && cur_frm.doc.selco_supplier_or_customer == \"Customer\") {\n\t\t\t\tcur_frm.add_custom_button(__(\"Get Items From Rejection In\"), cur_frm.cscript.get_items_from_rejection_in);\n\t\t}\n});\n\n\ncur_frm.cscript.selco_get_items_from_rejection_in = function()\n{\n\tvar d = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Get Items from Rejection In\"),\n\t\t\tfields: [{\n\t\t\t\t\t\t\t\"fieldname\": \"rejection_in\",\n\t\t\t\t\t\t\t\"fieldtype\": \"Link\",\n\t\t\t\t\t\t\t\"label\": __(\"Rejection In\"),\n\t\t\t\t\t\t\toptions: \"Stock Entry\",\n\t\t\t\t\t\t\treqd: 1,\n\t\t\t\t\t\t\tget_query: function() {\n\t\t\t\t\t\t\t    return {\n\t\t\t\t\t\t\t        query: \"selco.selco.selco_customizations.get_incompleted_rejection_in_or_rejection_out\",\n\t\t\t\t\t\t\t        filters: {\n\t\t\t\t\t\t\t            stock_entry_type: \"Rejection In\",\n\t\t\t\t\t\t\t\t\t\tselco_branch: cur_frm.doc.selco_branch,\n\t\t\t\t\t\t\t\t\t\tselco_supplier_or_customer_id:cur_frm.doc.selco_supplier_or_customer_id,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t        }\n\t\t\t\t\t\t\t    }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\tfieldname: \"fetch\",\n\t\t\t\t\t\t\t\"label\": __(\"Get Items from Rejection In\"),\n\t\t\t\t\t\t\t\"fieldtype\": \"Button\"\n\t\t\t\t\t}\n\t\t\t]\n\t});\n\td.get_input(\"fetch\").on(\"click\", function() {\n\t\tvar values = d.get_values();\n\n\t\tif(!values) return;\n\t\tfrappe.call({\n\t\t\t\"method\": \"frappe.client.get\",\n\t\t\targs: {\n\t\t\t\tdoctype: \"Stock Entry\",\n\t\t\t\tname:values.rejection_in\n\t\t\t},\n\t\t\tcallback: function (data) {\n\t\t\t\tif (data.message) {\n\t\t\t\t    cur_frm.doc.items = [];\n\t\t\t\t    for (var i=0;i<data.message.items.length;i++)\n\t\t\t\t    {\n\t\t\t\t        let ste_qty = data.message.items[i].qty - data.message.items[i].reference_rej_in_or_rej_quantity;\n                        \n                        if (ste_qty) {\n                            var newrow = frappe.model.add_child(cur_frm.doc,\"Stock Entry Detail\", \"items\");\n                            newrow.item_code = data.message.items[i].item_code;\n                            newrow.qty = ste_qty;\n                            newrow.uom = data.message.items[i].uom;\n                            newrow.item_group = data.message.items[i].item_group;\n                            newrow.item_name = data.message.items[i].item_name;\n                            newrow.description = data.message.items[i].description;\n                            newrow.stock_uom = data.message.items[i].stock_uom;\n                            newrow.transfer_qty = data.message.items[i].transfer_qty;\n                            newrow.conversion_factor = data.message.items[i].conversion_factor;\n                            newrow.reference_rej_in_or_rej_ot = data.message.name;\n                            newrow.basic_rate = data.message.items[i].basic_rate;\n                            newrow.valuation_rate = data.message.items[i].valuation_rate;   \n                        }\n\t\t\t\t    }\n\t\t\t\t}\n\t\t\t\trefresh_field(\"items\");\n\t\t\t\td.hide();\n\t\t}\n\t\t})\n\n\t});\n\td.show();\n\n\n}\n\ncur_frm.cscript.get_items_from_rejection_out = function()\n{\n\tvar d = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Get Items from Rejection Out\"),\n\t\t\tfields: [{\n\t\t\t\t\t\t\t\"fieldname\": \"rejection_out\",\n\t\t\t\t\t\t\t\"fieldtype\": \"Link\",\n\t\t\t\t\t\t\t\"label\": __(\"Rejection Out\"),\n\t\t\t\t\t\t\toptions: \"Stock Entry\",\n\t\t\t\t\t\t\treqd: 1,\n\t\t\t\t\t\t\tget_query: function() {\n\t\t\t\t\t\t\t    return {\n\t\t\t\t\t\t\t        query: \"selco.selco.selco_customizations.get_incompleted_rejection_in_or_rejection_out\",\n\t\t\t\t\t\t\t        filters: {\n\t\t\t\t\t\t\t            stock_entry_type: \"Rejection Out\",\n\t\t\t\t\t\t\t\t\t\tselco_branch: cur_frm.doc.selco_branch,\n\t\t\t\t\t\t\t\t\t\tselco_supplier_or_customer_id:cur_frm.doc.selco_supplier_or_customer_id,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t        }\n\t\t\t\t\t\t\t    }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\tfieldname: \"fetch\",\n\t\t\t\t\t\t\t\"label\": __(\"Get Items from Rejection Out\"),\n\t\t\t\t\t\t\t\"fieldtype\": \"Button\"\n\t\t\t\t\t}\n\t\t\t]\n\t});\n\td.get_input(\"fetch\").on(\"click\", function() {\n\t\tvar values = d.get_values();\n\t\tconsole.log(values.rejection_out)\n\t\tif(!values) return;\n\t\tfrappe.call({\n\t\t\t\"method\": \"frappe.client.get\",\n\t\t\targs: {\n\t\t\t\tdoctype: \"Stock Entry\",\n\t\t\t\tname:values.rejection_out\n\t\t\t},\n\t\t\tcallback: function (data) {\n\t\t\t\tif (data.message) {\n\t\t\t\t    cur_frm.doc.items = [];\n\t\t\t\t    for (var i=0;i<data.message.items.length;i++)\n\t\t\t\t    {\n\t\t\t\t        let ste_qty = data.message.items[i].qty - data.message.items[i].reference_rej_in_or_rej_quantity;\n                        \n                        if (ste_qty) {\n                            var newrow = frappe.model.add_child(cur_frm.doc,\"Stock Entry Detail\", \"items\");\n                            newrow.item_code = data.message.items[i].item_code;\n                            newrow.qty = ste_qty;\n                            newrow.uom = data.message.items[i].uom;\n                            newrow.item_group = data.message.items[i].item_group;\n                            newrow.item_name = data.message.items[i].item_name;\n                            newrow.description = data.message.items[i].description;\n                            newrow.stock_uom = data.message.items[i].stock_uom;\n                            newrow.transfer_qty = data.message.items[i].transfer_qty;\n                            newrow.conversion_factor = data.message.items[i].conversion_factor;\n                            newrow.reference_rej_in_or_rej_ot = data.message.name;\n                            newrow.basic_rate = data.message.items[i].basic_rate;\n                            newrow.valuation_rate = data.message.items[i].valuation_rate;   \n                        }\n\t\t\t\t    }\n\t\t\t\t}\n\t\t\t\trefresh_field(\"items\");\n\t\t\t\td.hide();\n\t\t}\n\t\t})\n\n\t});\n\td.show();\n\n\n}\n\nfrappe.ui.form.on(\"Stock Entry\", \"from_warehouse\", function(frm) {\n\tget_warehouse_address(frm, frm.doc.from_warehouse, \"source_warehouse_address\");\n});\n\nfrappe.ui.form.on(\"Stock Entry\", \"to_warehouse\", function(frm) {\n\tget_warehouse_address(frm, frm.doc.to_warehouse, \"target_warehouse_address\");\n});\n\nfunction get_warehouse_address(frm, warehouse_name, field_to_set) {\n\tfrappe.call({\n\t\tmethod: \"selco.selco.selco_customizations.get_default_address_name_and_display\",\n\t\targs: {\n\t\t\t\"doctype\": \"Warehouse\",\n\t\t\t\"docname\": warehouse_name\n\t\t} \n\t}).done(function(r){\n\t\tconsole.log(r);\n\t\tif(r.message) {\n\t\t\tfrm.set_value(field_to_set, r.message.address_name);\n\t\t}\n\t}).error(function(err) {\n\t\tfrappe.show_alert(\"Unable to fetch address details\");\n\t\tconsole.log(err);\n\t});\n}\n\nfunction update_warehouse_in_items(frm, source_or_target, warehouse_name) {\n\tfrm.doc.items.forEach(function(item) {\n\t\tif (source_or_target == \"Source\" && item.s_warehouse === undefined) {\n\t\t\titem.s_warehouse = warehouse_name;\n\t\t} \n\t\tif (source_or_target == \"Target\" && item.t_warehouse === undefined) {\n\t\t\titem.t_warehouse = warehouse_name;\n\t\t} \n\t});\n\trefresh_field(\"items\")\n}\n\n\n\nfunction toggle_custom_buttons(frm) {\n\t\tif (!in_list([\"Rejection Out\", \"Rejection In\"], frm.doc.selco_type_of_stock_entry)) {\n\t\t\tif (!frm.custom_buttons[\"Get Items from IBM\"]) {\n\t\t\t\tfrm.add_custom_button(__(\"Get Items from IBM\"), cur_frm.cscript.get_items_from_ibm1);\n\t\t\t}\n\t\t} else {\n\t\t\tfrm.remove_custom_button(\"Get Items from IBM\");\n\t\t\tfrm.remove_custom_button(\"Make Material Request\");\n\t\t\tfrm.remove_custom_button(\"Purchase Invoice\", \"Get items from\");\n\t\t}  \n}\n\nfrappe.ui.form.on(\"Stock Entry\", {\n    setup: function(frm) {\n        frm.set_query('outgoing_stock_entry', function() {\n            return {\n                filters: [\n                    ['Stock Entry', 'docstatus', '=', 1],\n                    ['Stock Entry', 'per_transferred', '<','100'],\n                    ['Stock Entry', 'purpose', '=', 'Send to Warehouse'],\n                    ['Stock Entry', 'selco_being_dispatched_to', '=', frm.doc.selco_branch],\n                ]\n            }\n        });\n        \n    }\n    \n})\n\nfrappe.ui.form.on(\"Stock Entry\", { \n\tvalidate: function(frm) {\n\t\tif (!frm.is_new() && frm.doc.posting_date < frappe.datetime.add_days(frappe.datetime.nowdate(),-0) && frappe.user.has_role(['SELCO Service Branch Office Administrator' && 'SELCO Branch Office Administrator' && 'SELCO Service Basic' ]) ) {\n\t\t\tfrappe.throw(\"User don't have permission to submit the back dated Stock Entry, please contact to administrator\")\n\t\treturn false;\t\t\n\t\t}\n\t\telse if (!frm.is_new() && frm.doc.posting_date < frappe.datetime.add_days(frappe.datetime.nowdate(),-7) && frappe.user.has_role(['SELCO Lead Accountant' && 'System Manager']) ) {\n\t\t\tfrappe.throw(\"User don't have permission to submit the back dated Stock Entry, please contact to administrator\")\n\t\treturn false;\t\n\t\t\t\n\t\t\t\n\t\t}\n\n\t}\n})\n"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Journal Entry",
  "modified": "2020-10-03 11:53:07.723553",
  "name": "Journal Entry-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "/*To set naming series when branch is choosen for the first time */\ncur_frm.add_fetch(\"selco_branch\", \"selco_journal_entry_naming_series\", \"naming_series\"); \n\n//Made changes by frappe team\nfrappe.ui.form.on(\"Journal Entry Account\", {\n    party: function(frm, cdt, cdn) {\n        var child = locals[cdt][cdn];\n        if (child.party_type == 'Employee') {\n            frm.call({\n\t\t\t\tmethod: \"frappe.client.get_value\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: \"Employee\",\n\t\t\t\t\tfieldname: \"employee_name\",\n\t\t\t\t\tfilters: { name: child.party },\n\t\t\t\t},\n\t\t\t\tcallback: function(r, rt) {\n\t\t\t\t\tif(r.message) {\n\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"employee_name\", r.message.employee_name);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n        }\n        \n    },\n    \n    party_type: function(frm, cdt, cdn) {\n        var child = locals[cdt][cdn];\n        frappe.model.set_value(cdt, cdn, \"party\", \"\");\n    }\n})\n\nfrappe.ui.form.on(\"Journal Entry\", {\n    voucher_type: function(frm) {\n        if (in_list([\"Bank Entry\", \"Cash Entry\"], frm.doc.voucher_type) && frm.doc.__islocal && frm.doc.accounts \n            && frm.doc.accounts.length == 1 && !frm.doc.accounts[0].account) {\n            \n            var field = frm.doc.voucher_type == 'Bank Entry'? 'default_bank_account' : 'default_cash_account';\n            frappe.call({\n\t\t\t    method: \"frappe.client.get_value\",\n\t\t\t    args: {\n\t\t\t\t    doctype: \"Branch\",\n\t\t\t\t    filters: {\"name\": frm.doc.selco_branch},\n\t\t\t\t    fieldname: field\n\t\t\t    },\n\t\t\t    callback: function(r){\n\t\t\t\t    if(r.message){\n\t\t\t\t\t    $.each(frm.doc.accounts || [], function(i, jvd) {\n\t\t\t\t\t\t    frappe.model.set_value(jvd.doctype, jvd.name, \"account\", r.message[field]);\n\t\t\t\t\t    });\n\t\t\t\t    }\n\t\t\t    }\n\t\t    });\n            \n        }\n    }\n});\n\nfrappe.ui.form.on(\"Journal Entry\", \"validate\", function(frm) {\n\tif (frappe.user_roles.indexOf(\"SELCO Lead Accountant\")!=-1 && cur_frm.doc.voucher_type==\"Write Off Entry\") {\n\t\tfrappe.throw(\"You are not allowed to raise the journal entry of type write off!!\");\n\t}\n});\n\n\nfrappe.ui.form.on(\"Journal Entry\", \"onload_post_render\", function(frm) {\n\tif (!cur_frm.doc.__islocal) {\n\t//frappe.model.add_child(cur_frm.doc, \"Journal Entry Account\", 'accounts')\n\t//refresh_field(\"accounts\");\n\t\tcur_frm.set_df_property(\"voucher_type\", \"read_only\", true);\n\t}\n});\n\nfrappe.ui.form.on(\"Journal Entry\", \"voucher_type\", function(frm, cdt, cdn) {\n\tconsole.log(\"voucher type\");\n\t\n\tif(cur_frm.doc.voucher_type == \"Payment Entry - HO - SBI\" && cur_frm.doc.selco_branch == \"Head Office\")\n\t{\n\tcur_frm.doc.naming_series = \"SBI/HOD/2021/\";\n\tconsole.log(\"SBI\");\n\trefresh_field(\"naming_series\");\n\t}\n\telse if (cur_frm.doc.voucher_type == \"Journal Entry - HO - FD\" && cur_frm.doc.selco_branch == \"Head Office\")   \n\t{\n\tcur_frm.doc.naming_series = \"FD/HOD/2021/\";\n\t} \n\telse if (cur_frm.doc.voucher_type == \"Opening Entry - HO - SELCO\" && cur_frm.doc.selco_branch == \"Head Office\")   \n\t{\n\tcur_frm.doc.naming_series = \"OPNS/HO/18-19/\";\n\t} \n\n\tif(cur_frm.doc.voucher_type == \"Commission Journal\" && cur_frm.doc.selco_branch == \"Head Office\")\n\t{\n\t\tcur_frm.doc.naming_series = \"CJ/HO/18-19/\";\n\t\trefresh_field(\"naming_series\");\n\t}\n\n\tif (frm.doc.voucher_type == \"Contra Entry\") {\n\t    frm.doc.naming_series = frappe.db.get_value(\"Branch\",frm.doc.selco_branch,\"selco_contra_naming_series\")\n\t}\n\tif (frm.doc.voucher_type == \"Cash Entry\") {\n\t    frm.doc.naming_series = frappe.db.get_value(\"Branch\",frm.doc.selco_branch,\"selco_cash_payment_naming_series\")\n\t}\n\tif (frm.doc.voucher_type == \"Debit Note\") {\n\t    frm.doc.naming_series = frappe.db.get_value(\"Branch\",frm.doc.selco_branch,\"selco_debit_note__naming_series\")\n\t}\n\tif (frm.doc.voucher_type == \"Credit Note\") {\n\t    frm.doc.naming_series = frappe.db.get_value(\"Branch\",frm.doc.selco_branch,\"selco_credit_note_naming_series\")\n\t}\n\tif (frm.doc.voucher_type == \"Journal Entry\") {\n\t    frm.doc.naming_series = frappe.db.get_value(\"Branch\",frm.doc.selco_branch,\"selco_journal_entry_naming_series\")\n\t}\n\tif (frm.doc.voucher_type == \"Write Off Entry\") {\n\t    frm.doc.naming_series = frappe.db.get_value(\"Branch\",frm.doc.selco_branch,\"selco_write_off_naming_series\")\n\t}\n\tif (frm.doc.voucher_type == \"Bank Entry\") {\n\t    frm.doc.naming_series = frappe.db.get_value(\"Branch\",frm.doc.selco_branch,\"selco_bank_payment_naming_series\")\n\t}\n\tif (frm.doc.voucher_type == \"Receipt\") {\n\t    frm.doc.naming_series = frappe.db.get_value(\"Branch\",frm.doc.selco_branch,\"selco_receipt_naming_series\")\n\t}\n\tif (frm.doc.voucher_type == \"Commission Journal\") {\n\t    frm.doc.naming_series = frappe.db.get_value(\"Branch\",frm.doc.selco_branch,\"selco_commission_journal_naming_series\")\n\t}\n});\t\n\n\n\nfrappe.ui.form.on(\"Journal Entry\", \"validate\", function(frm) {\nif (cur_frm.doc.voucher_type==\"Cash Entry\" &&cur_frm.doc.total_debit >=10000 )\n frappe.throw(\"Cash entry for more than Rs 10,000 is not allowed\");\n})\n\nfrappe.ui.form.on(\"Journal Entry\", { \n\tvalidate: function(frm) {\n\t\tif (!frm.is_new() && frm.doc.posting_date < frappe.datetime.add_days(frappe.datetime.nowdate(),-0) && frappe.user.has_role(['SELCO Service Branch Office Administrator' && 'SELCO Branch Office Administrator' && 'SELCO Godown Office Administrator' ]) ) {\n\t\t\tfrappe.throw(\"User don't have permission to submit the backdated Journal Entry, please contact Administrator\")\n\t\treturn false;\t\t\n\t\t}\n\t\telse if (!frm.is_new() && frm.doc.posting_date < frappe.datetime.add_days(frappe.datetime.nowdate(),-156) && frappe.user.has_role(['SELCO Lead Accountant' && 'System Manager']) ) {\n\t\t\tfrappe.throw(\"User don't have permission to submit the backdated Journal Entry, please contact Administrator\")\n\t\treturn false;\t\n\t\t\t\n\t\t\t\n\t\t}\n\n\t}\n})\n\n\n\n"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Lead",
  "modified": "2020-10-03 12:00:21.531002",
  "name": "Lead-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on(\"Lead\", \"refresh\", function(frm) {\ncur_frm.set_query(\"source\", function() {\n    return {\n        filters: [\n            ['Lead Source', 'name', 'in', 'Generated By Sales Person,Demo,Customers Visit To Branch,Service Camp,Others,Toll Free Number,Direct - Project Manager,Branch - Project Manager,SELCO Foundation,SKDRDP,Business Associate']\n        ]\n    }\n})\n});\n\nfrappe.ui.form.on(\"Lead\", \"selco_project_enquiry\",function(frm) \n{\ncur_frm.set_df_property(\"selco_area\", \"reqd\", true);\n})\n"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Purchase Order",
  "modified": "2020-10-03 11:44:36.545170",
  "name": "Purchase Order-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "cur_frm.add_fetch(\"supplier\", \"selco_gstin\", \"selco_supplier_gstin\"); \ncur_frm.add_fetch(\"supplier\", \"selco_terms_and_conditions\", \"tc_name\");\ncur_frm.add_fetch(\"supplier\", \"selco_is_micro_small_medium_enterprise\",\"selco_is_micro_small_medium_enterprise\"); \n\n\n\n\nfrappe.ui.form.on(\"Purchase Order\", \"refresh\",\n    function(frm) {\nif ( cur_frm.doc.workflow_state == \"AGM Approval Pending - PO\" || cur_frm.doc.workflow_state == \"Logistics Manager Approval Pending - PO\" || cur_frm.doc.workflow_state == \"Accounts Approval Pending - PO\")\n{\ncur_frm.fields.forEach(function(l){ cur_frm.set_df_property(l.df.fieldname, \"read_only\", 1); })\nvar df = frappe.meta.get_docfield(\"Purchase Order Item\", \"item_code\", cur_frm.doc.name);\ndf.read_only = 1;\nvar df = frappe.meta.get_docfield(\"Purchase Order Item\", \"item_name\", cur_frm.doc.name);\ndf.read_only = 1;\nvar df = frappe.meta.get_docfield(\"Purchase Order Item\", \"schedule_date\", cur_frm.doc.name);\ndf.read_only = 1;\nvar df = frappe.meta.get_docfield(\"Purchase Order Item\", \"expected_delivery_date\", cur_frm.doc.name);\ndf.read_only = 1;\nvar df = frappe.meta.get_docfield(\"Purchase Order Item\", \"description\", cur_frm.doc.name);\ndf.read_only = 1;\nvar df = frappe.meta.get_docfield(\"Purchase Order Item\", \"qty\", cur_frm.doc.name);\ndf.read_only = 1;\nvar df = frappe.meta.get_docfield(\"Purchase Order Item\", \"uom\", cur_frm.doc.name);\ndf.read_only = 1;\nvar df = frappe.meta.get_docfield(\"Purchase Order Item\", \"conversion_factor\", cur_frm.doc.name);\ndf.read_only = 1;\nvar df = frappe.meta.get_docfield(\"Purchase Order Item\", \"price_list_rate\", cur_frm.doc.name);\ndf.read_only = 1;\nvar df = frappe.meta.get_docfield(\"Purchase Order Item\", \"discount_percentage\", cur_frm.doc.name);\ndf.read_only = 1;\nvar df = frappe.meta.get_docfield(\"Purchase Order Item\", \"rate\", cur_frm.doc.name);\ndf.read_only = 1;\n}\n})\n\nfrappe.ui.form.on(\"Purchase Order\", \"refresh\", function(frm) {\n    cur_frm.set_query(\"selco_godown\", function() {\n        return {\n            \"filters\": {\n                \"selco_type\": \"Godown\"\n            }\n        };\n    });\n});\n\nfrappe.ui.form.on(\"Purchase Order Item\",\"item_code\",function(frm,cdt,cdn){\nvar d = locals[cdt][cdn];\nd.warehouse = cur_frm.doc.selco_godown;\nfrm.set_df_property(\"selco_godown\", \"read_only\",1);\n});\n\nfrappe.ui.form.on(\"Purchase Order\", \"selco_godown\", function(frm) {\n\tif (!frm.doc.selco_godown) { return 0; }\n\tfrappe.call({\n\t\tmethod: \"selco.selco.selco_customizations.get_default_address_name_and_display\",\n\t\targs: {\n\t\t\t\"doctype\": \"Warehouse\",\n\t\t\t\"docname\": cur_frm.doc.selco_godown\n\t\t}\n\t}).done(function(r){\n\t\tfrm.set_value(\"selco_godown_address\", r.message.address_name);\n\t\tfrm.set_value(\"selco_godown_address_details\", r.message.address_display)\n\t}).error(function(err) {\n\t\tfrappe.show_alert(err);\n\t});\n});\n\nfrappe.ui.form.on(\"Purchase Order\", { \n\tvalidate: function(frm) {\n\t\tif (!frm.is_new() && frm.doc.transaction_date < frappe.datetime.add_days(frappe.datetime.nowdate(),-0) && !frappe.user.has_role(['System Manager']) ) {\n\t\t\tfrappe.throw(\"User don't have permission to submit the backdated Purchase Order, Please contact Administrator\")\n\t\treturn false;\t\t\n\t\t}\n\t\telse if (!frm.is_new() && frm.doc.transaction_date < frappe.datetime.add_days(frappe.datetime.nowdate(),-0) && frappe.user.has_role(['System Manager']) ) {\n\t\t\tfrappe.throw(\"User don't have permission to submit the backdated Purchase Order, Please contact Administrator\")\n\t\treturn false;\t\n\t\t\t\n\t\t\t\n\t\t}\n\n\t}\n})\n"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Purchase Receipt",
  "modified": "2020-10-03 11:43:38.709601",
  "name": "Purchase Receipt-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "cur_frm.add_fetch(\"selco_godown\", \"selco_mrn_naming_series\", \"naming_series\");\n\nfrappe.ui.form.on(\"Purchase Receipt\", \"refresh\", function(frm) {\nconsole.log('hh');\n    cur_frm.set_query(\"selco_godown\", function() {\n        return {\n            \"filters\": {\n                \"selco_type\": [\"in\", [\"Godown\", \"Branch\"]]\n            }\n        };\n    });\n});\n\n\nfrappe.ui.form.on(\"Purchase Receipt\",\"validate\",function(frm,cdt,cdn){\n//This is required on client side also\nfor(var i=0; i < cur_frm.doc.items.length; i++) \n{\ncur_frm.doc.items[i].warehouse = cur_frm.doc.selco_godown; \n}\n})\n\n"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Delivery Note",
  "modified": "2020-10-03 11:34:16.435544",
  "name": "Delivery Note-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "/*To set naming series when branch is choosen for the first time */\ncur_frm.add_fetch(\"sales_person\", \"employee\", \"employee_number\");\ncur_frm.add_fetch(\"selco_branch\", \"selco_delivery_note_naming_series\", \"naming_series\"); \n\n/*To set naming series when the value in branch is changed*/\nfrappe.ui.form.on(\"Delivery Note\", \"selco_branch\", function(frm) {\n  if (cur_frm.doc.naming_series == null )   {\n    window.location.reload();\n    msgprint(\"Please set the correct naming series for the branch.\");\n           throw \"Not allowed\";\n  }\n});\n\nfrappe.ui.form.on(\"Delivery Note\", \"refresh\", function(frm) {\n   if (frm.doc.docstatus == 0){\n      cur_frm.add_custom_button(__(\"Get Items from BOM\"),\n      cur_frm.cscript.get_items_from_bom2);\n    }\n    \n     if(!frm.doc.naming_series && frm.doc.selco_branch && frm.is_new()) {\n        \n        frappe.call({\n\t\t\tmethod: \"frappe.client.get_value\",\n\t\t\targs: {\n\t\t\t\tdoctype: \"Branch\",\n\t\t\t\tfilters: {\"name\": frm.doc.selco_branch},\n\t\t\t\tfieldname: \"selco_delivery_note_naming_series\"\n\t\t\t},\n\t\t\tcallback: function(r){\n\t\t\t\tif(r.message){\n\t\t\t\t\tfrm.set_value(\"naming_series\", r.message.selco_delivery_note_naming_series)\n\t\t\t\t}\n\t\t\t}\n\t});\n    }\n});\n\ncur_frm.cscript.get_items_from_bom2 = function() {\n\nif (cur_frm.doc.items.length > 0 && !cur_frm.doc.items[0].item_code) {\n  cur_frm.clear_table(\"items\");\n}\n\n  var d = new frappe.ui.Dialog({\n    title: __(\"Get Items from BOM\"),\n    fields: [\n      {\"fieldname\":\"bom\", \"fieldtype\":\"Link\", \"label\":__(\"BOM\"),\n        options:\"Stock Entry\", reqd: 1, get_query: function(){\n          return {filters: { purpose:\"Repack\", docstatus: 1}}\n        }},\n      {fieldname:\"fetch\", \"label\":__(\"Get Items from BOM\"), \"fieldtype\":\"Button\"}\n    ]\n  });\n  d.get_input(\"fetch\").on(\"click\", function() {\n    var values = d.get_values();\n    cur_frm.doc.imported_system = values.bom;\n    if(!values) return;\n    frappe.call({\n      \"method\": \"frappe.client.get\",\n      args: {\n        doctype: \"Stock Entry\",\n        name:values.bom\n      },\n      callback: function (data) {\n        console.log(data);\n        if (data.message) {\n        for (var i=0;i<data.message.items.length;i++)\n        {\n          if (data.message.items[i].t_warehouse)\n          {\n        var newrow = frappe.model.add_child(cur_frm.doc,\"Delivery Note Item\", \"items\");\n        newrow.item_code=data.message.items[i].item_code;\n        newrow.item_name=data.message.items[i].item_name;\n        newrow.qty=data.message.items[i].qty;\n        newrow.stock_uom=data.message.items[i].stock_uom;\n        newrow.uom=data.message.items[i].uom;\n        newrow.description=data.message.items[i].description;\n        newrow.rate=data.message.items[i].basic_rate//11000;\n        newrow.amount=data.message.items[i].amount\n      }\n        //console.log(data.message.items[i]);\n        }\n\n        }\n        refresh_field(\"items\");\n        d.hide();\n    }\n    })\n\n  });\n  d.show();\n}\n\nfrappe.ui.form.on(\"Delivery Note\", { \n\tvalidate: function(frm) {\n\t\tif (!frm.is_new() && frm.doc.posting_date < frappe.datetime.add_days(frappe.datetime.nowdate(),-0) && frappe.user.has_role(['SELCO Service Branch Office Administrator' && 'SELCO Branch Office Administrator' && 'SELCO Service Basic' ]) ) {\n\t\t\tfrappe.throw(\"User don't have permission to submit the back dated Delivery Note, please contact to administrator\")\n\t\treturn false;\t\t\n\t\t}\n\t\telse if (!frm.is_new() && frm.doc.posting_date < frappe.datetime.add_days(frappe.datetime.nowdate(),-30) && frappe.user.has_role(['SELCO Lead Accountant']) ) {\n\t\t\tfrappe.throw(\"User don't have permission to submit the back dated Delivery Note, please contact to administrator\")\n\t\treturn false;\t\n\t\t\t\n\t\t\t\n\t\t}\n\n\t}\n})\n\nfrappe.ui.form.on('Delivery Note', {\n  refresh : function(frm) {\n    if (!has_common(frappe.user_roles, [\"System Manager\",\"SELCO Lead Accountant\"]))\n    {\n     setTimeout(() => {\n\n            cur_frm.page.remove_inner_button(__('Close'),  __(\"Status\"));  \n  \n     },100);\n\n  }\n  }\n});\n\n\n\n\n\n"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Sales Invoice",
  "modified": "2020-10-03 11:15:56.505249",
  "name": "Sales Invoice-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "//Made changes by frappe team\n\ncur_frm.add_fetch(\"sales_person\", \"employee\", \"employee_number\");\n\nfrappe.ui.form.on(\"Sales Invoice\", {\n    posting_date: function(frm) {\n        frm.set_value(\"start_date\", frm.doc.posting_date);\n        \n    }\n    \n})\n\n\ncur_frm.add_fetch(\"selco_sales_account\",\"selco_sales_tax_template\",\"taxes_and_charges\");\n\nfrappe.ui.form.on(\"Sales Invoice\", \"selco_type_of_invoice\",\n    function(frm) { console.log('tt');\nif ( cur_frm.doc.selco_type_of_invoice == \"System Sales Invoice\" )\n{\ncur_frm.set_df_property(\"selco_service_bill_no\", \"reqd\", true);\n} else if( cur_frm.doc.selco_type_of_invoice == \"Spare Sales Invoice\" )\n{\ncur_frm.set_df_property(\"selco_service_bill_no\", \"reqd\", false);\n}\nelse if (cur_frm.doc.selco_type_of_invoice == \"Service Bill\")\n{\ncur_frm.set_df_property(\"selco_service_bill_no\", \"reqd\", false);\n}\n});\n\nfrappe.ui.form.on(\"Sales Invoice\", \"refresh\", function(frm) {\n    cur_frm.set_query(\"selco_service_bill_no\", function() {\n        return {\n            \"filters\": {\n                \"customer\": frm.doc.customer,\n                \"selco_type_of_invoice\": \"Service Bill\",\n                \"docstatus\":1\n            }\n        };\n    });\n});\n\n\nfrappe.ui.form.on(\"Sales Invoice\", \"selco_type_of_invoice\", function(frm) {\n\nif ( cur_frm.doc.selco_type_of_invoice == \"Service Bill\") \t{\n\tcur_frm.fields_dict['items'].grid.get_field('item_code').get_query = function(doc) {\n\treturn {\n\t\tfilters: [\n\t            ['item_group', 'in', 'Installation Charges,AMC,Service Charges']\t\n\t\t\t]\n\t\t}\n\t}\n\trefresh_field(\"items\");\n} else {\n\tcur_frm.fields_dict['items'].grid.get_field('item_code').get_query = function(doc) {\n\t\treturn {\n\t\t\tfilters: [\n\t            ['item_group', 'not in', 'Installation Charges,AMC,Service Charges']\n\t\t\t]\n\t\t}\n\t}\n\trefresh_field(\"items\");\n}\n});\n\n\n\nfrappe.ui.form.on(\"Sales Invoice\", \"selco_type_of_invoice\", function(frm) {\n    if (cur_frm.doc.selco_type_of_invoice == \"Service Bill\") {\n        cur_frm.set_query(\"selco_sales_account\", function() {\n            return {\n                \"filters\": {\n                    \"parent_account\": [\"in\", [\"Karnataka Service - SELCO\", \"Tamilnadu Service - SELCO\", \"Interstate Service - SELCO\",\"Bihar Service - SELCO\",\"Maharashtra Service - SELCO\",\"Kerala Service - SELCO\",\"Other Income - SELCO\"]]\n\n                }\n            };\n        });\n    }\n\n else if ((cur_frm.doc.selco_type_of_invoice == \"System Sales Invoice\") || (cur_frm.doc.selco_type_of_invoice == \"Spare Sales Invoice\"))\n{\n        cur_frm.set_query(\"selco_sales_account\", function() {\n            return {\n                \"filters\": {\n                    \"parent_account\": [\"in\", [\"Karnataka Sales - SELCO\",\"Kerala Sales - SELCO\",\"Maharashtra Sales - SELCO\",\"Bihar Sales - SELCO\",\"Tamilnadu Sales - SELCO\"]]\n\n                }\n            };\n        });\n    }\n    \nelse if(cur_frm.doc.selco_type_of_invoice == \"Bill of Sale\")\n{\n        cur_frm.set_query(\"selco_sales_account\", function() {\n            return {\n                \"filters\": {\n                    \"parent_account\": [\"in\", [\"Interstate Sales - SELCO\",\"Stock Transfer(Outward) - SELCO\"]]\n                }\n            };\n        });\n    }\n\n});\n\n\n\n\n\nfrappe.ui.form.on(\"Sales Invoice\", \"refresh\", function(frm) {\nif (frm.doc.__islocal)\n{\nif (cur_frm.doc.is_return == 1)\n{\nfrm.set_value(\"selco_service_bill_no\", \"\");\nfrm.refresh_field(\"selco_service_bill_no\");\n}\n}\n})\n\n\nfrappe.ui.form.on(\"Sales Invoice\", \"refresh\", function(frm) {\ncur_frm.fields_dict.customer.new_doc = quick_entry_customer;\ncur_frm.fields_dict.customer_address.new_doc = quick_entry_address;\n})\n\n\nvar quick_entry_address = function(){\nconsole.log(\"Overrided\");\n\tfrappe._from_link = this;\n\tquick_entry(\"Address\", \n\tfunction(){}, \n\t{ \n\t\t\"address_type\": \"Billing\",\n                \"selco_branch\": cur_frm.doc.selco_branch,\n                \"customer\": cur_frm.doc.customer,\n                \"country\" : \"India\"\n\t});\n}\n\nvar quick_entry_customer = function(){\nconsole.log(\"Overrided\");\n\tfrappe._from_link = this;\n\tquick_entry(\"Customer\", \n\tfunction(){}, \n\t{ \n                \"selco_branch\": cur_frm.doc.selco_branch\n\t});\n}\n\nfrappe.ui.form.on(\"Sales Invoice\", \"refresh\", function(frm) {\nif (cur_frm.doc.__islocal == 1)\n{\nif (frappe.user_info().email == \"bangalore_service_center@selco-india.com\")\n{\ncur_frm.set_value(\"selco_branch\", \"Bangalore Service Branch\");\ncur_frm.set_df_property(\"branch\", \"read_only\", true);\n} else if (frappe.user_info().email == \"kundapura_service_center@selco-india.com\")\n{\ncur_frm.set_value(\"selco_branch\", \"Kundapur Service Branch\");\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"puttur_service_center@selco-india.com\")\n{\ncur_frm.set_value(\"selco_branch\", \"Puttur Service Branch\");\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"hassan_service_center@selco-india.com\")\n{\ncur_frm.set_value(\"selco_branch\", \"Hassan Service Branch\");\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"bellary_service_center@selco-india.com\")\n{\ncur_frm.set_value(\"selco_branch\", \"Ballari Service Branch\");\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"shimoga_service_center@selco-india.com\")\n{\ncur_frm.set_value(\"selco_branch\", \"Shivamogga Service Branch\");\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"chitradurga_service_center@selco-india.com\")\n{\ncur_frm.set_value(\"selco_branch\", \"Chitradurga Service Branch\");\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"dharwad_service_center@selco-india.com\")\n{\ncur_frm.set_value(\"selco_branch\", \"Dharwad Service Branch\");\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"vijayapura_service_center@selco-india.com\")\n{\ncur_frm.set_value(\"selco_branch\", \"Vijayapura Service Branch\");\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}else if (frappe.user_info().email == \"mysore_service_center@selco-india.com\")\n{\ncur_frm.set_value(\"selco_branch\", \"Mysore Service Branch\");\ncur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n}\n}\n})\n\nfrappe.ui.form.on(\"Sales Invoice\", \"refresh\", function (frm, cdt, cdn) {\n  cur_frm.set_query(\"customer\", function () {\n    return { \n      query: \"erpnext.controllers.queries.customer_query\",\n      searchfield: \"selco_customer_contact_number\"\n    }\n  });\n});\n\nvar quick_entry = function(doctype, success, fields_map={}) {\n\tfrappe.model.with_doctype(doctype, function() {\n\t\tvar mandatory = [];\n\n\t\tif (!fields_map == {}) {\n\t\t\t$.each(fields_map, function(k,v) {\n\t\t\t\tdoc_field = frappe.meta.get_docfield(doctype, k)\n\t\t\t\tmandatory.push(doc_field);\n\t\t\t});\n\t\t} else {\n\t\t\tmandatory = $.map(frappe.get_meta(doctype).fields,\n\t\t\tfunction(d) { return (d.reqd || d.bold && !d.read_only) ? d : null });\n\t\t}\n\n\t\tvar meta = frappe.get_meta(doctype);\n\t\tvar doc = frappe.model.get_new_doc(doctype, null, null, true);\n\n\t\t/*if(meta.quick_entry != 1) {\n\t\t\tvar d = frappe.model.make_new_doc_and_get_name(doctype);\n\t\t\td = locals[doctype][d];\n\t\t\t$.each(fields_map, function(fieldname, fieldvalue) {\n\t\t\t\td[fieldname] = fieldvalue;\n\t\t\t});\n\t\t\tfrappe.set_route('Form', doctype, d.name);\n\t\t\treturn;\n\t\t}*/\n\n\t\tvar dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"New {0}\", [doctype]),\n\t\t\tfields: mandatory,\n\t\t});\n\n\t\tvar update_doc = function() {\n\t\t\tvar data = dialog.get_values(true);\n\t\t\t$.each(data, function(key, value) {\n\t\t\t\tif(key==='__name') {\n\t\t\t\t\tdialog.doc.name = value;\n\t\t\t\t} else {\n\t\t\t\t\tif(!is_null(value)) {\n\t\t\t\t\t\tdialog.doc[key] = value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn dialog.doc;\n\t\t}\n\n\t\tvar open_doc = function() {\n\t\t\tdialog.hide();\n\t\t\tupdate_doc();\n\t\t\tfrappe.set_route('Form', doctype, doc.name);\n\t\t}\n\n\t\tdialog.doc = doc;\n\n\t\t// refresh dependencies etc\n\t\tdialog.refresh();\n\n\t\tdialog.set_primary_action(__('Save'), function() {\n\t\t\tif(dialog.working) return;\n\t\t\tvar data = dialog.get_values();\n\n\t\t\tif(data) {\n\t\t\t\tdialog.working = true;\n\t\t\t\tvalues = update_doc();\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"frappe.client.insert\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoc: values\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tdialog.hide();\n\t\t\t\t\t\t// delete the old doc\n\t\t\t\t\t\tfrappe.model.clear_doc(dialog.doc.doctype, dialog.doc.name);\n\t\t\t\t\t\tvar doc = r.message;\n\t\t\t\t\t\tif(success) {\n\t\t\t\t\t\t\tsuccess(doc);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfrappe.ui.form.update_calling_link(doc.name);\n\t\t\t\t\t},\n\t\t\t\t\terror: function() {\n\t\t\t\t\t\topen_doc();\n\t\t\t\t\t},\n\t\t\t\t\talways: function() {\n\t\t\t\t\t\tdialog.working = false;\n\t\t\t\t\t},\n\t\t\t\t\tfreeze: true\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tvar $link = $('<div class=\"text-muted small\" style=\"padding-left: 10px; padding-top: 15px;\">\\\n\t\t\tCtrl+enter to save | <a class=\"edit-full\">Edit in full page</a></div>').appendTo(dialog.body);\n\n\t\t$link.find('.edit-full').on('click', function() {\n\t\t\t// edit in form\n\t\t\topen_doc();\n\t\t});\n\n\t\t// ctrl+enter to save\n\t\tdialog.wrapper.keydown(function(e) {\n\t\t\tif((e.ctrlKey || e.metaKey) && e.which==13) {\n\t\t\t\tif(!frappe.request.ajax_count) {\n\t\t\t\t\t// not already working -- double entry\n\t\t\t\t\tdialog.get_primary_btn().trigger(\"click\");\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tdialog.show();\n\n\t\t//Set value and visibility if field map exists.\n\t\tif (fields_map != {}) {\n\t\t\t$.each(dialog.fields_dict, function(fieldname, field) {\n\t\t\t\tfield.set_input(fields_map[fieldname]);\n\t\t\t});\n\t\t} else {\n\t\t\t// set defaults\n\t\t\t$.each(dialog.fields_dict, function(fieldname, field) {\n\t\t\t\tfield.doctype = doc.doctype;\n\t\t\t\tfield.docname = doc.name;\n\t\t\t\tif(!is_null(doc[fieldname])) {\n\t\t\t\t\tfield.set_input(doc[fieldname]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n}\n\n\n\nfrappe.ui.form.on(\"Sales Invoice\", { \n\tvalidate: function(frm) {\n\t\tif (frm.doc.posting_date < frappe.datetime.add_days(frappe.datetime.nowdate(),-0) && frappe.user.has_role(['SELCO Service Branch Office Administrator' && 'SELCO Branch Office Administrator' && 'SELCO Service Basic' ]) ) {\n\t\t\tfrappe.throw(\"User don't have permission to submit the back dated sales invoice, please contact to administrator\")\n\t\treturn false;\t\t\n\t\t}\n\t\telse if (frm.doc.posting_date < frappe.datetime.add_days(frappe.datetime.nowdate(),-30) && frappe.user.has_role(['SELCO Lead Accountant']) ) {\n\t\t\tfrappe.throw(\"User don't have permission to submit the back dated sales invoice, please contact to administrator\")\n\t\treturn false;\t\n\t\t\t\n\t\t\t\n\t\t}\n\n\t}\n})\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Sales Order",
  "modified": "2018-10-16 13:56:24.344110",
  "name": "Sales Order-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "/*To set naming series when branch is choosen for the first time */\ncur_frm.add_fetch(\"selco_branch\", \"sales_order_naming_series\", \"naming_series\"); \n\n/*To set naming series when the value in branch is changed*/\nfrappe.ui.form.on(\"Sales Order\", \"selco_branch\",\n    function(frm) {\ncur_frm.add_fetch(\"selco_branch\", \"sales_order_naming_series\", \"naming_series\");\n\nif ( cur_frm.doc.naming_series == null )\n{\nwindow.location.reload();\nmsgprint(\"Please set the correct naming series for the branch.\");\n       throw \"Not allowed\";\n}\n})"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Opportunity",
  "modified": "2018-10-16 13:56:24.422160",
  "name": "Opportunity-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "/*To set naming series when branch is choosen for the first time */\ncur_frm.add_fetch(\"selco_branch\", \"opportunity_naming_series\", \"naming_series\"); \n\n/*To set naming series when the value in branch is changed*/\nfrappe.ui.form.on(\"Opportunity\", \"selco_branch\",\n    function(frm) {\ncur_frm.add_fetch(\"branch\", \"opportunity_naming_series\", \"naming_series\");\n\nif ( cur_frm.doc.naming_series == null )\n{\nwindow.location.reload();\nmsgprint(\"Please set the correct naming series for the branch.\");\n       throw \"Not allowed\";\n}\n})"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Quotation",
  "modified": "2018-10-16 13:56:23.928506",
  "name": "Quotation-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "/*To set naming series when branch is choosen for the first time */\ncur_frm.add_fetch(\"selco_branch\", \"quotation_naming_series\", \"naming_series\"); \n\n/*To set naming series when the value in branch is changed*/\nfrappe.ui.form.on(\"Quotation\", \"selco_branch\",\n    function(frm) {\ncur_frm.add_fetch(\"selco_branch\", \"quotation_naming_series\", \"naming_series\");\n\nif ( cur_frm.doc.naming_series == null )\n{\nwindow.location.reload();\nmsgprint(\"Please set the correct naming series for the branch.\");\n       throw \"Not allowed\";\n}\n})"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Warranty Claim",
  "modified": "2018-10-16 13:56:24.319644",
  "name": "Warranty Claim-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "cur_frm.add_fetch(\"selco_complaint_number\", \"selco_customer_id\", \"customer\");\ncur_frm.add_fetch(\"selco_complaint_number\", \"selco_customer_full_name\", \"customer_full_name\");\ncur_frm.add_fetch(\"selco_complaint_number\", \"selco_branch\", \"selco_branch\");\n\ncur_frm.add_fetch(\"selco_complaint_number\", \"selco_ics_number\", \"selco_ics_number\");\ncur_frm.add_fetch(\"selco_complaint_number\", \"selco_ics_date\", \"selco_ics_date\");\n\ncur_frm.add_fetch(\"selco_item_code\", \"item_name\", \"selco_item_name\");\ncur_frm.add_fetch(\"selco_item_code\", \"item_group\", \"item_group\");\ncur_frm.add_fetch(\"selco_item_code\", \"description\", \"item_description\");\n\ncur_frm.add_fetch(\"selco_panel_capacity\", \"item_name\", \"selco_panel_name\");\ncur_frm.add_fetch(\"selco_battery_capacity\", \"item_name\", \"selco_battery_name\"); \ncur_frm.add_fetch(\"selco_inverter_capacity\", \"item_name\", \"selco_inverter_name\"); \ncur_frm.add_fetch(\"selco_water_heater_capacity\", \"item_name\", \"selco_water_heater_name\"); \n\n\nfrappe.ui.form.on(\"Warranty Claim\", \"selco_panel\", function(frm) {\ncur_frm.set_query(\"selco_item_code\", function() {\n    return {\n        filters: [\n            ['Item', 'item_group', 'in', 'Modules, Common Item']\n        ]\n    }\n});\n\ncur_frm.set_query(\"selco_supplier\", function() {\n    return {\n        filters: [\n            ['Supplier', 'supplier_type', 'in', 'Module Manufacturer, Common Supplier']\n        ]\n    };\n});\n\n})\n\n\nfrappe.ui.form.on(\"Warranty Claim\", \"selco_battery\", function(frm) {\ncur_frm.set_query(\"selco_item_code\", function() {\n    return {\n        filters: [\n            ['Item', 'item_group', 'in', 'Batteries, Common Item']\n        ]\n    }\n});\n\ncur_frm.set_query(\"selco_supplier\", function() {\n    return {\n        filters: [\n            ['Supplier', 'supplier_type', 'in', 'Battery Manufacturer, Common Supplier']\n        ]\n    };\n});\n\n})\n\n\n\nfrappe.ui.form.on(\"Warranty Claim\", \"selco_inverter\", function(frm) {\ncur_frm.set_query(\"selco_item_code\", function() {\n    return {\n        filters: [\n            ['Item', 'item_group', 'in', 'Inverters, Common Item']\n        ]\n    }\n});\n\ncur_frm.set_query(\"selco_supplier\", function() {\n    return {\n        filters: [\n            ['Supplier', 'supplier_type', 'in', 'Inverter Manufacturer, Common Supplier']\n        ]\n    };\n});\n\n})\n\n\n\nfrappe.ui.form.on(\"Warranty Claim\", \"selco_water_heater\", function(frm) {\ncur_frm.set_query(\"selco_item_code\", function() {\n    return {\n        filters: [\n            ['Item', 'item_group', 'in', 'ETC Water Heater Systems, Common Item ,Water Heater Consumables,Water Heater Tanks Spare']\n        ]\n    }\n});\n\ncur_frm.set_query(\"selco_supplier\", function() {\n    return {\n        filters: [\n            ['Supplier', 'supplier_type', 'in', 'Solar Water Heater ETC Manufacturer, Common Supplier']\n        ]\n    };\n});\n\n})\n\n\n\nfrappe.ui.form.on(\"Warranty Claim\", \"validate\", function(frm) {\n        if ( cur_frm.doc.workflow_state==\"Warranty Claim Format Raised - WC\")\n        {\n        frappe.call({\n            \"method\": \"frappe.client.set_value\",\n            \"args\": {\n                \"doctype\": \"Issue\",\n                \"name\": frm.doc.selco_complaint_number,\n                \"fieldname\": \"workflow_state\",\n                \"value\": \"Warranty Claim Format Raised - WC\"\n            }\n        });\n        }\n});\n\nfrappe.ui.form.on(\"Warranty Claim\", \"validate\", function(frm) {\n        if ( cur_frm.doc.workflow_state==\"Warranty Claim Approved - WC\")\n        {\n        frappe.call({\n            \"method\": \"frappe.client.set_value\",\n            \"args\": {\n                \"doctype\": \"Issue\",\n                \"name\": frm.doc.selco_complaint_number,\n                \"fieldname\": \"workflow_state\",\n                \"value\": \"Dispatch Pending From Godown\"\n            }\n        });\n        }\n});\n\nfrappe.ui.form.on(\"Warranty Claim\", \"validate\", function(frm) {\n        if ( cur_frm.doc.workflow_state==\"Warranty Claim Rejected - WC\")\n        {\n        frappe.call({\n            \"method\": \"frappe.client.set_value\",\n            \"args\": {\n                \"doctype\": \"Issue\",\n                \"name\": frm.doc.selco_complaint_number,\n                \"fieldname\": \"workflow_state\",\n                \"value\": \"Complaint Attended By CSE - Still Open\"\n            }\n        });\n        }\n});\n\n\nfrappe.ui.form.on(\"Warranty Claim\", \"validate\", function(frm) {\n        if ( cur_frm.doc.workflow_state==\"Dispatched From Godown\")\n        {\n        frappe.call({\n            \"method\": \"frappe.client.set_value\",\n            \"args\": {\n                \"doctype\": \"Issue\",\n                \"name\": frm.doc.selco_complaint_number,\n                \"fieldname\": \"workflow_state\",\n                \"value\": \"Dispatched From Godown\"\n            }\n        });\n        }\n});\n\n\nfrappe.ui.form.on(\"Warranty Claim\", \"selco_branch\", function(frm, cdt, cdn) {\n\tvar d = locals[cdt][cdn];\n\tfrappe.call({\n\t\t\"method\": \"frappe.client.get\",\n\t\targs: {\n\t\t\tdoctype: \"Branch\",\n\t\t\tname: d.selco_branch\n\t\t},\n\t\tcallback: function (data) {\n\t\t\tfrappe.model.set_value(d.doctype, d.name, \"godown_email_id\", data.message.godown_email_id);\n\n\t\t}\n\t})\n});\n\nfrappe.ui.form.on(\"Warranty Claim\", \"selco_branch\", function(frm, cdt, cdn) {\n\tvar d = locals[cdt][cdn];\n\tfrappe.call({\n\t\t\"method\": \"frappe.client.get\",\n\t\targs: {\n\t\t\tdoctype: \"Branch\",\n\t\t\tname: d.selco_branch\n\t\t},\n\t\tcallback: function (data) {\n\t\t\tfrappe.model.set_value(d.doctype, d.name, \"senior_service_manager_email_id\",data.message.senior_service_manager_email_id);\n\n\t\t}\n\t})\n});\n\n\nfrappe.ui.form.on(\"Warranty Claim\", \"refresh\",\n    function(frm) {\nif ( cur_frm.doc.workflow_state == \"Warranty Claim Format Raised - WC\" || cur_frm.doc.workflow_state == \"Warranty Claim Approved - WC\" || cur_frm.doc.workflow_state == \"Warranty Claim Rejected - WC\" || cur_frm.doc.workflow_state == \"Dispatched From Godown\")\n{\ncur_frm.fields.forEach(function(l){ cur_frm.set_df_property(l.df.fieldname, \"read_only\", 1); })\nfrm.set_df_property(\"selco_dc_number\", \"read_only\",0);\nfrm.set_df_property(\"selco_remarks_by_godown\", \"read_only\",0);\nfrm.set_df_property(\"selco_docket_number_and_details_branch_to_godown\", \"read_only\",0);\nfrm.set_df_property(\"selco_docket_number_and_details_godown_to_branch\", \"read_only\",0);\nfrm.set_df_property(\"selco_docket_date_branch_to_godown\", \"read_only\",0);\nfrm.set_df_property(\"selco_docket_date_godown_to_branch\", \"read_only\",0);\n\n\n\n//frm.set_df_property(\"selco_item_code2\", \"read_only\",0);\n//frm.set_df_property(\"selco_item_name\", \"read_only\",0);\n//frm.set_df_property(\"item_serial_number\", \"read_only\",0);\n//frm.set_df_property(\"supplier\", \"read_only\",0);\n//frm.set_df_property(\"within_warranty\", \"read_only\",0);\n}\n})\n\n\n\n\n"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Material Request",
  "modified": "2019-12-21 11:10:26.568844",
  "name": "Material Request-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "/*To set naming series when branch is choosen for the first time */\n\ncur_frm.add_fetch(\"selco_branch\", \"selco_branch_credit_limit\", \"selco_branch_credit_limit\"); \ncur_frm.add_fetch(\"selco_branch\", \"selco_senior_sales_manager_email_id\", \"selco_senior_sales_manager_email_id\"); \ncur_frm.add_fetch(\"selco_branch\", \"selco_godown_email_id\", \"selco_godown_email_id\");\ncur_frm.add_fetch(\"selco_branch\", \"selco_agm_email_id\", \"selco_agms_email_id\"); \n\n\nfrappe.ui.form.on(\"Material Request\", \"onload_post_render\", function(frm) {\n\tcur_frm.remove_custom_button(\"Get Items from BOM\");\n});\n\nfrappe.ui.form.on(\"Material Request\", \"refresh\", function(frm) {\n\n\tcur_frm.set_value(\"material_request_type\",\"Material Transfer\");\n \n   if (!cur_frm.custom_buttons[__(\"Get Items from BOM SELCO\")]) {\n      cur_frm.add_custom_button(__(\"Get Items from BOM SELCO\"),\n        cur_frm.cscript.get_items_from_bom1);\n    }\n    frm.remove_custom_button(\"Get Items from BOM\");\n\n    cur_frm.fields_dict['items'].grid.get_field('item_code').get_query = function(doc) {\n\treturn {\n\t          \"filters\": {\n\t          \"is_stock_item\": \"1\"\n\t          }\n\t\t}\n\t}\n\n\tif ([\"Approval Pending by SM - IBM\",\"Approval Pending by AGM - IBM\",\"Approved - IBM\",\"Partially Dispatched From Godown - IBM\",\"Dispatched From Godown - IBM\"].indexOf(cur_frm.doc.workflow_state) > -1)\n\t{\n\t\tcur_frm.fields.forEach(function(l){ cur_frm.set_df_property(l.df.fieldname, \"read_only\", 1); })\n\t\tfrm.set_df_property(\"selco_dc_number\", \"read_only\",0);\n\t\tfrm.set_df_property(\"selco_dc_date\", \"read_only\",0);\n\t\tfrm.set_df_property(\"selco_godown_oa_comments\", \"read_only\",0);\n\t\tfrm.set_df_property(\"selco_logistics_manager_comments\", \"read_only\",0);\n\t\tfrm.set_df_property(\"selco_senior_manager_comments\", \"read_only\",0);\n\n\t\tvar df = frappe.meta.get_docfield(\"Material Request Item\", \"item_code\", cur_frm.doc.name);\n\t\tdf.read_only = 1;\n\t\tvar df = frappe.meta.get_docfield(\"Material Request Item\", \"item_name\", cur_frm.doc.name);\n\t\tdf.read_only = 1;\n\t\tvar df = frappe.meta.get_docfield(\"Material Request Item\", \"selco_rate\", cur_frm.doc.name);\n\t\tdf.read_only = 1;\n\t\tvar df = frappe.meta.get_docfield(\"Material Request Item\", \"qty\", cur_frm.doc.name);\n\t\tdf.read_only = 1;\n\t\tvar df = frappe.meta.get_docfield(\"Material Request Item\", \"warehouse\", cur_frm.doc.name);\n\t\tdf.read_only = 1;\n\t\tvar df = frappe.meta.get_docfield(\"Material Request Item\", \"description\", cur_frm.doc.name);\n\t\tdf.read_only = 1;\n\t}\n\tcur_frm.fields_dict['items'].grid.get_field('warehouse').get_query = function(doc) {\n\t\treturn {\n\t          \"filters\": {\n\t          \"selco_type\": \"Virtual\"\n\t          }\n\t\t}\n\t}\n\n\tset_branch_readonly(frm);\n\n\n})\n\n\nfrappe.ui.form.on(\"Material Request\", \"validate\", function(frm) {\n\tcur_frm.doc.selco_total_of_stock_and_debtors = cur_frm.doc.selco_present_debtors+cur_frm.doc.selco_stock_value\n\tcur_frm.doc.selco_present_limit = cur_frm.doc.selco_branch_credit_limit-cur_frm.doc.selco_total_of_stock_and_debtors\n\n\tcur_frm.clear_table(\"selco_items_print\");\n\tcur_frm.refresh()\n\tvar flag=0;\n\n\tvar newrow = frappe.model.add_child(cur_frm.doc,\"Material Request Item Print\", \"selco_items_print\");\n\tif (cur_frm.doc.items.length)\n\t{\n\tnewrow.item_code = cur_frm.doc.items[0].item_code\n\tnewrow.item_name = cur_frm.doc.items[0].item_name\n\tnewrow.quantity = cur_frm.doc.items[0].qty\n\t}\n\n\tfor (var i = 1; i < cur_frm.doc.items.length; i++) { \n\tfor (var j = 0; j < cur_frm.doc.selco_items_print.length; j++) { \n\tif (cur_frm.doc.items[i].item_code == cur_frm.doc.selco_items_print[j].item_code && cur_frm.doc.items[i].item_name == cur_frm.doc.selco_items_print[j].item_name)\n\t{\n\tflag = 1;\n\tcur_frm.doc.selco_items_print[j].quantity = cur_frm.doc.selco_items_print[j].quantity +cur_frm.doc.items[i].qty;\n\trefresh_field(\"selco_items_print\");\n\t}\n\t}\n\tif(flag != 1)\n\t{\n\tvar newrow = frappe.model.add_child(cur_frm.doc,\"Material Request Item Print\", \"selco_items_print\");\n\tnewrow.item_code = cur_frm.doc.items[i].item_code\n\tnewrow.item_name = cur_frm.doc.items[i].item_name\n\tnewrow.quantity = cur_frm.doc.items[i].qty\n\t}\n\tflag=0;\n\t}\n\n\tfor (var j = 0; j < cur_frm.doc.items.length; j++) \n\t{ \n\tif (!cur_frm.doc.items[j].warehouse) \n\t{\n\tcur_frm.doc.items[j].warehouse = cur_frm.doc.selco_default_warehouse;\n\t}\n\t}\n\n\tfor (var j = 0; j < cur_frm.doc.items.length; j++) {\n        if ((cur_frm.doc.items[j].item_code == \"2009032\") || (cur_frm.doc.items[j].item_code == \"2009040\")) {\n            cur_frm.set_value('selco_is_it_eshala_ibm', \"YES\")\n        } else {\n            cur_frm.set_value('selco_is_it_eshala_ibm', \" \")\n\n        }\n\n    }\n});\n\n\ncur_frm.cscript.get_items_from_bom1 = function()\n{\n//console.log(\"Clicked Button\" + cur_frm.doc.items[0].item_code);\nif (cur_frm.doc.items.length == 0 || ((cur_frm.doc.items.length > 0) && (!cur_frm.doc.items[0].item_code)))\n{\nconsole.log(\"Inside\");\ncur_frm.clear_table(\"items\");\n}\n\n\t\tvar d = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Get Items from BOM\"),\n\t\t\tfields: [\n\t\t\t\t{\"fieldname\":\"bom\", \"fieldtype\":\"Link\", \"label\":__(\"BOM\"),\n\t\t\t\t\toptions:\"BOM\", reqd: 1, get_query: function(){\n\t\t\t\t\t\treturn {filters: { docstatus:1 }}\n\t\t\t\t\t}},\n\t\t\t\t{\"fieldname\":\"warehouse\", \"fieldtype\":\"Link\", \"label\":__(\"Warehouse\"),\n\t\t\t\t\toptions:\"Warehouse\", reqd: 1, label:\"For Warehouse\"},\n//Start of code added by Basawaraj for quantity field in 'Get Items from BOM' screen\n\t\t\t\t{fieldname:\"Quantity\", \"label\":__(\"Quantity\"), \"fieldtype\":\"Int\",reqd: 1},\n//End of code added by Basawaraj for quantity field in 'Get Items from BOM' screen\n\t\t\t\t{\"fieldname\":\"fetch_exploded\", \"fieldtype\":\"Check\",\n\t\t\t\t\t\"label\":__(\"Fetch exploded BOM (including sub-assemblies)\"), \"default\":1},\n\t\t\t\t{fieldname:\"fetch\", \"label\":__(\"Get Items from BOM\"), \"fieldtype\":\"Button\"}\n\t\t\t]\n\t\t});\n\t\td.get_input(\"fetch\").on(\"click\", function() {\n\t\t\tvar values = d.get_values();\n\t\t\tif(!values) return;\n\t\t\tvalues[\"company\"] = cur_frm.doc.company;\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.manufacturing.doctype.bom.bom.get_bom_items\",\n\t\t\t\targs: values,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tconsole.log(\"MR BOM ITEMS\", r);\n\t\t\t\t\t$.each(r.message, function(i, item) {\n\t\t\t\t\t\tvar d = frappe.model.add_child(cur_frm.doc, \"Material Request Item\", \"items\");\n\t\t\t\t\t\td.item_code = item.item_code;\n\t\t\t\t\t\td.description = item.description;\n\t\t\t\t\t\td.warehouse = values.warehouse;\n\t\t\t\t\t\td.uom = item.stock_uom;\n//End of code added by Basawaraj for quantity field calculation\n\t\t\t\t\t\td.qty = item.qty * values.Quantity;\n//End of code added by Basawaraj for quantity field calculation\n//\t\t\t\t\t\td.qty = item.qty;\n\t\t\t\t\t\td.conversion_factor = 1;\n\t\t\t\t\t});\n\t\t\t\t\td.hide();\n\t\t\t\t\trefresh_field(\"items\");\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\td.show();\n\t}\nfunction set_branch_readonly(frm) {\n\tif (cur_frm.doc.__islocal == 1)\n\t{\n\tif (frappe.user_info().email == \"bangalore_service_center@selco-india.com\")\n\t{\n\tcur_frm.set_value(\"selco_branch\", \"Bangalore Service Branch\");\n\tcur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n\t} else if (frappe.user_info().email == \"kundapura_service_center@selco-india.com\")\n\t{\n\tcur_frm.set_value(\"selco_branch\", \"Kundapur Service Branch\");\n\tcur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n\t}else if (frappe.user_info().email == \"puttur_service_center@selco-india.com\")\n\t{\n\tcur_frm.set_value(\"selco_branch\", \"Puttur Service Branch\");\n\tcur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n\t}else if (frappe.user_info().email == \"hassan_service_center@selco-india.com\")\n\t{\n\tcur_frm.set_value(\"selco_branch\", \"Hassan Service Branch\");\n\tcur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n\t}else if (frappe.user_info().email == \"bellary_service_center@selco-india.com\")\n\t{\n\tcur_frm.set_value(\"selco_branch\", \"Ballari Service Branch\");\n\tcur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n\t}else if (frappe.user_info().email == \"shimoga_service_center@selco-india.com\")\n\t{\n\tcur_frm.set_value(\"selco_branch\", \"Shivamogga Service Branch\");\n\tcur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n\t}else if (frappe.user_info().email == \"chitradurga_service_center@selco-india.com\")\n\t{\n\tcur_frm.set_value(\"selco_branch\", \"Chitradurga Service Branch\");\n\tcur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n\t}else if (frappe.user_info().email == \"dharwad_service_center@selco-india.com\")\n\t{\n\tcur_frm.set_value(\"selco_branch\", \"Dharwad Service Branch\");\n\tcur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n\t}else if (frappe.user_info().email == \"vijayapura_service_center@selco-india.com\")\n\t{\n\tcur_frm.set_value(\"selco_branch\", \"Vijayapura Service Branch\");\n\tcur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n\t}else if (frappe.user_info().email == \"mysore_service_center@selco-india.com\")\n\t{\n\tcur_frm.set_value(\"selco_branch\", \"Mysore Service Branch\");\n\tcur_frm.set_df_property(\"selco_branch\", \"read_only\", true);\n\t}\n\t}\n}\n\nif ( cur_frm.doc.workflow_state == \"Content Dispatch Pending\" )\n{\ncur_frm.set_value('selco_content_dispatched', \"NO\")\n}\nelse if ( cur_frm.doc.workflow_state == \"Content Dispatched\" )\n{\ncur_frm.set_value('selco_content_dispatched', \"YES\")\n}\nif ( cur_frm.doc.workflow_state == \"Dispatched From Godown - IBM\" )\n{\nif (cur_frm.doc.selco_is_it_eshala_ibm == \"YES\" && cur_frm.doc.selco_content_dispatched == \"NO\")\n{\nfrappe.msgprint(\"Please request content\");\nvalidated = false;\n}\n}"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Bank Payment",
  "modified": "2018-10-16 13:56:24.283875",
  "name": "Bank Payment-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Bank Payment', {\n\trefresh: function(frm) {\n\n\t\tif(frm.doc.docstatus==1) {\n\t\t\t\t\tfrm.add_custom_button(__('Ledger'), function() {\n\t\t\t\t\t\tfrappe.route_options = {\n\t\t\t\t\t\t\t\"voucher_no\": \"J\" + frm.doc.name,\n\t\t\t\t\t\t\t\"from_date\": frm.doc.posting_date,\n\t\t\t\t\t\t\t\"to_date\": frm.doc.posting_date,\n\t\t\t\t\t\t\t\"company\": frm.doc.company,\n\t\t\t\t\t\t\tgroup_by_voucher: 0\n\t\t\t\t\t\t};\n\t\t\t\t\t\tfrappe.set_route(\"query-report\", \"General Ledger\");\n\t\t\t\t\t}, \"fa fa-table\");\n\t\t\t\t}\n\n\t}\n});\n"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Customer",
  "modified": "2018-10-16 13:56:24.447566",
  "name": "Customer-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "//cur_frm.add_fetch(\"branch\", \"customer_naming_series\", \"naming_series\"); "
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "SELCO Courier Tracking",
  "modified": "2019-11-26 11:49:44.292286",
  "name": "SELCO Courier Tracking-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": ""
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Installation Note",
  "modified": "2020-10-05 17:26:02.828015",
  "name": "Installation Note-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "cur_frm.add_fetch(\"selco_warranty_terms1\", \"terms\", \"selco_terms_and_conditions\");\n//cur_frm.add_fetch(\"selco_branch\", \"selco_maintenance_schedule_naming_series\", \"naming_series\");\n\nfrappe.ui.form.on(\"Installation Note\", {\n    onload: function(frm) {\n        debugger\n        if (frm.doc.selco_branch && !frm.doc.naming_series) {\n            frappe.db.get_value(\"Branch\", {\"name\": frm.doc.selco_branch}, \"selco_installation_note_naming_series\", (r) => {\n\t\t\t\tfrm.set_value(\"naming_series\", r.selco_installation_note_naming_series);\n\t\t\t});\n        }\n    }\n});\n\n//From Here\nfrappe.ui.form.on(\"Installation Note\",\"validate\",function(frm,cdt,cdn){\n\n    var d = locals[cdt][cdn];\n    \n        frappe.call({\n        method: 'frappe.client.get_value',\n        args: {\n            'doctype': 'Delivery Note',\n            'filters': {'name': frm.doc.items[0].prevdoc_docname},\n            'fieldname': [\n                'posting_date'\n            ]\n        },\n        callback: function(data) {\n            if (!data.exc) {\n                frappe.model.set_value(d.doctype,d.name,\"selco_delivery_note_date\", data.message.posting_date);\n                frm.refresh_field('selco_delivery_note_date');\n                \n            }\n        }\n    });\n\n\n});\n\n\nfrappe.ui.form.on(\"Installation Note\",\"selco_warranty_terms1\",function(frm,cdt,cdn){\n    cur_frm.set_value(\"selco_tick16\",0);\n    cur_frm.set_value(\"selco_tick15\",0);\n    cur_frm.set_value(\"selco_tick14\",0);\n    cur_frm.set_value(\"selco_tick12\",0);\n    cur_frm.set_value(\"selco_tick11\",0);\n    cur_frm.set_value(\"selco_tick10\",0);\n    cur_frm.set_value(\"selco_tick5\",0);\n    cur_frm.set_value(\"selco_tick_9\",0);\n    cur_frm.set_value(\"selco_tick1\",0);\n    cur_frm.set_value(\"selco_tick2\",0);\n    cur_frm.set_value(\"selco_tick3\",0);\n    cur_frm.set_value(\"selco_tick13\",0);\n    cur_frm.set_value(\"selco_tick81\",0);\n    cur_frm.set_value(\"selco_tick86\",0);\n    cur_frm.set_value(\"selco_tick87\",0);\n    cur_frm.set_value(\"selco_tick88\",0);\n    cur_frm.set_value(\"selco_tick89\",0);\n    cur_frm.set_value(\"selco_tick90\",0);\n    cur_frm.set_value(\"selco_tick91\",0);\n    cur_frm.set_value(\"selco_tick\",0);\n\n\n    \nif ( cur_frm.doc.selco_warranty_terms1 == \"Solar Home Lighting Systems\" )\n  {\n    cur_frm.set_value(\"selco_tick1\",1);\n    cur_frm.set_value(\"selco_tick2\",1);\n    cur_frm.set_value(\"selco_tick3\",1);\n    cur_frm.set_value(\"selco_tick\",1);\n    cur_frm.set_value(\"selco_tick13\",1);\n    cur_frm.set_value(\"selco_tick10\",1);\n    cur_frm.set_value(\"selco_tick16\",0);\n    cur_frm.set_value(\"selco_tick15\",0);\n    cur_frm.set_value(\"selco_tick14\",0);\n    cur_frm.set_value(\"selco_tick12\",0);\n    cur_frm.set_value(\"selco_tick11\",0);\n    cur_frm.set_value(\"selco_tick5\",0);\n    cur_frm.set_value(\"selco_tick_9\",0);\n    cur_frm.set_value(\"selco_tick81\",0);\n    cur_frm.set_value(\"selco_tick86\",0);\n    cur_frm.set_value(\"selco_tick87\",0);\n    cur_frm.set_value(\"selco_tick88\",0);\n    cur_frm.set_value(\"selco_tick89\",0);\n    cur_frm.set_value(\"selco_tick90\",0);\n    cur_frm.set_value(\"selco_tick91\",0);\n\n    \n  \n } \n\n  else if (cur_frm.doc.selco_warranty_terms1 == \"Solar Inverter Based Systems\")\n  {\n      \n    cur_frm.set_value(\"selco_tick1\",1);\n    cur_frm.set_value(\"selco_tick3\",1);\n    cur_frm.set_value(\"selco_tick_9\",1);\n    cur_frm.set_value(\"selco_tick13\",0);\n    cur_frm.set_value(\"selco_tick16\",0);\n    cur_frm.set_value(\"selco_tick15\",0);\n    cur_frm.set_value(\"selco_tick14\",0);\n    cur_frm.set_value(\"selco_tick12\",0);\n    cur_frm.set_value(\"selco_tick11\",0);\n    cur_frm.set_value(\"selco_tick10\",0);\n    cur_frm.set_value(\"selco_tick5\",0);\n    cur_frm.set_value(\"selco_tick2\",0);\n    cur_frm.set_value(\"selco_tick91\",0);\n    cur_frm.set_value(\"selco_tick\",0);\n\n\n\n  }\n  else if (cur_frm.doc.selco_warranty_terms1 == \"Domestic Solar Water Heaters - ETC - SS Outer Cladding\")\n  {\n    cur_frm.set_value(\"selco_tick5\",1);\n    cur_frm.set_value(\"selco_tick12\",1);\n    cur_frm.set_value(\"selco_tick16\",1);\n    cur_frm.set_value(\"selco_tick15\",0);\n    cur_frm.set_value(\"selco_tick14\",0);\n    cur_frm.set_value(\"selco_tick11\",0);\n    cur_frm.set_value(\"selco_tick10\",0);\n    cur_frm.set_value(\"selco_tick_9\",0);\n    cur_frm.set_value(\"selco_tick2\",0);\n    cur_frm.set_value(\"selco_tick3\",0);\n    cur_frm.set_value(\"selco_tick13\",0);\n    cur_frm.set_value(\"selco_tick81\",0);\n    cur_frm.set_value(\"selco_tick86\",0);\n    cur_frm.set_value(\"selco_tick87\",0);\n    cur_frm.set_value(\"selco_tick88\",0);\n    cur_frm.set_value(\"selco_tick89\",0);\n    cur_frm.set_value(\"selco_tick90\",0);\n    cur_frm.set_value(\"selco_tick91\",0);\n    cur_frm.set_value(\"selco_tick1\",0);\n    cur_frm.set_value(\"selco_tick\",0);\n\n    \n  }\n  \n  else if (cur_frm.doc.selco_warranty_terms1 == \"Livelihood Systems\")\n  {\n    cur_frm.set_value(\"selco_tick1\",1);\n    cur_frm.set_value(\"selco_tick2\",1);\n    cur_frm.set_value(\"selco_tick3\",1);\n    cur_frm.set_value(\"selco_tick\",1);\n    cur_frm.set_value(\"selco_tick13\",1);\n    cur_frm.set_value(\"selco_tick10\",1);\n    cur_frm.set_value(\"selco_tick81\",1);\n    cur_frm.set_value(\"selco_tick86\",1);\n    cur_frm.set_value(\"selco_tick87\",1);\n    cur_frm.set_value(\"selco_tick88\",1);\n    cur_frm.set_value(\"selco_tick89\",1);\n    cur_frm.set_value(\"selco_tick90\",1);\n    cur_frm.set_value(\"selco_tick91\",1);\n    cur_frm.set_value(\"selco_tick16\",0);\n    cur_frm.set_value(\"selco_tick15\",0);\n    cur_frm.set_value(\"selco_tick14\",0);\n    cur_frm.set_value(\"selco_tick12\",0);\n    cur_frm.set_value(\"selco_tick11\",0);\n    cur_frm.set_value(\"selco_tick5\",0);\n    cur_frm.set_value(\"selco_tick_9\",0);\n \n }\n   \n   cur_frm.refresh_field(\"selco_warranty_terms1\"); \n});\n\n    \n//From here    \n    \nfrappe.ui.form.on(\"Installation Note\", \"validate\", function(frm, cdt, cdn) {\n\n    var d = locals[cdt][cdn];\n    for (var i = 0; i < cur_frm.doc.packed_items.length; i++) {\n        console.log(cur_frm.doc.packed_items[i].item_code);\n        const item_doc_name = cur_frm.doc.packed_items[i].name\n        frappe.db.get_value(\"Item\", cur_frm.doc.packed_items[i].item_code, \"selco_warranty_period\", function(data) {\n            frappe.model.set_value(\"Packed Item\", item_doc_name, \"selco_number_of_years\", data.selco_warranty_period)\n        });\n    }\n    frm.refresh_field(\"packed_items\");\n});\n\n\n"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Service Record",
  "modified": "2020-10-04 18:24:34.410664",
  "name": "Service Record-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "cur_frm.add_fetch(\"selco_complaint_number\", \"selco_customer_id\", \"selco_customer_id\");\ncur_frm.add_fetch(\"selco_complaint_number\", \"selco_customer_full_name\", \"selco_customer_full_name\");\ncur_frm.add_fetch(\"selco_complaint_number\", \"selco_branch\", \"selco_branch\");\ncur_frm.add_fetch(\"selco_complaint_number\", \"selco_ics_number\", \"selco_ics_number\");\ncur_frm.add_fetch(\"selco_complaint_number\", \"selco_ics_date\", \"selco_ics_date\");\ncur_frm.add_fetch(\"selco_complaint_number\", \"selco_ics_date\", \"selco_ics_date\");\ncur_frm.add_fetch(\"selco_complaint_number\", \"selco_customer_contact_number\", \"selco_customer_contact_number\");\ncur_frm.add_fetch(\"selco_complaint_number\", \"selco_customer_contact_number_landline\", \"selco_landline_mobile_2\");\ncur_frm.add_fetch(\"selco_complaint_number\", \"selco_customer_address\", \"selco_customer_address\");\ncur_frm.add_fetch(\"selco_complaint_number\", \"selco_detail_address\", \"selco_detail_address\");\ncur_frm.add_fetch(\"selco_complaint_number\", \"selco_complaint_received_date\", \"selco_complaint_date\");\n\n\n\n\n\n\n"
 }
]